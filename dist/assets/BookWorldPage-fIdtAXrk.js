import{u as B,a as A,b as F,r as u,j as e,A as O,ae as g,X as S,af as b}from"./index-BR52Rtky.js";import{M as z}from"./MusicControls-B3aDTWZG.js";import{g as j,f as E,a as L,b as P,c as $,d as G,C as v,A as M}from"./bookService-DUIqEW-r.js";import{B as f}from"./book-open-B6uaPslY.js";import{F as T}from"./funnel-Dwkof49d.js";import{H as N}from"./heart-1g7TFKtV.js";import{C as w}from"./check-Ch5beXFI.js";import"./volume-x-CFQy3J5n.js";function q(){const l=B(),{currentStudent:a}=A(),{updateStudent:i}=F(),[t,r]=u.useState(!1);if(!a)return l("/"),null;const c=a.libraryFilter||j(a.grade),o=a.favoriteBookIds||[],d=L(),x=u.useMemo(()=>E(d,c,o),[d,c,o]),s=()=>{l("/library")},m=n=>{l(`/library/books/${n}`)},y=(n,h)=>{n.stopPropagation();const C=o.includes(h)?o.filter(k=>k!==h):[...o,h];i({...a,favoriteBookIds:C})},p=n=>{i({...a,libraryFilter:n}),r(!1)};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-emerald-50 via-teal-50 to-cyan-50 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("button",{onClick:s,className:"flex items-center gap-2 px-4 py-2 bg-white/80 hover:bg-white text-slate-600 hover:text-slate-800 rounded-xl shadow-sm hover:shadow-md transition-all font-semibold",children:[e.jsx(O,{size:20}),e.jsx("span",{className:"hidden sm:inline",children:"Thư viện"})]}),e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-emerald-700 flex items-center gap-2",children:[e.jsx(f,{size:28}),"Book World"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>r(!0),className:"flex items-center gap-2 px-4 py-2 bg-emerald-100 hover:bg-emerald-200 text-emerald-700 rounded-xl shadow-sm transition-all font-semibold",children:[e.jsx(T,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Lọc"})]}),e.jsx(z,{})]})]}),x.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx(f,{size:64,className:"mx-auto text-slate-300 mb-4"}),e.jsx("p",{className:"text-slate-500 text-lg",children:"Không có sách nào phù hợp với bộ lọc"}),e.jsx("button",{onClick:()=>p(j(a.grade)),className:"mt-4 px-4 py-2 bg-emerald-500 text-white rounded-xl hover:bg-emerald-600 transition-colors",children:"Xóa bộ lọc"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:x.map(n=>e.jsx(I,{book:n,isFavorite:o.includes(n.id),progress:P(a.readingProgress,n.id),onClick:()=>m(n.id),onToggleFavorite:h=>y(h,n.id)},n.id))}),t&&e.jsx(R,{currentFilter:c,onApply:p,onClose:()=>r(!1)})]})}function I({book:l,isFavorite:a,progress:i,onClick:t,onToggleFavorite:r}){const[c,o]=u.useState(!1),[d,x]=u.useState(!1),s=$(i,l.totalPages);return e.jsxs("div",{onClick:t,className:"group bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden cursor-pointer hover:scale-105",children:[e.jsxs("div",{className:"relative aspect-video bg-slate-100",children:[!c&&!d&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-emerald-500 border-t-transparent rounded-full animate-spin"})}),d?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-emerald-100 to-teal-100",children:e.jsx(f,{size:48,className:"text-emerald-300"})}):e.jsx("img",{src:G(l.id),alt:l.title,className:`w-full h-full object-cover transition-opacity duration-300 ${c?"opacity-100":"opacity-0"}`,onLoad:()=>o(!0),onError:()=>x(!0)}),e.jsx("button",{onClick:r,className:`absolute top-2 right-2 p-2 rounded-full transition-all ${a?"bg-red-500 text-white":"bg-white/80 text-slate-400 hover:text-red-500"}`,children:e.jsx(N,{size:16,fill:a?"currentColor":"none"})}),i&&s>0&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1.5 bg-black/20",children:e.jsx("div",{className:`h-full transition-all ${i.isCompleted?"bg-emerald-500":"bg-yellow-500"}`,style:{width:`${s}%`}})}),(i==null?void 0:i.isCompleted)&&e.jsxs("div",{className:"absolute top-2 left-2 bg-emerald-500 text-white px-2 py-0.5 rounded-full text-xs font-bold flex items-center gap-1",children:[e.jsx(w,{size:12}),"Đã đọc"]})]}),e.jsxs("div",{className:"p-3",children:[e.jsx("h3",{className:"font-bold text-slate-800 text-sm line-clamp-2 group-hover:text-emerald-600 transition-colors",children:l.title}),l.author&&e.jsx("p",{className:"text-slate-500 text-xs mt-1 line-clamp-1",children:l.author}),e.jsx("p",{className:"text-slate-400 text-xs mt-1 line-clamp-2 min-h-[2.5em]",children:l.description}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:`inline-block px-2 py-0.5 rounded-full text-xs font-semibold ${l.category===g.STORY?"bg-purple-100 text-purple-700":l.category===g.SCIENCE?"bg-blue-100 text-blue-700":"bg-orange-100 text-orange-700"}`,children:v[l.category]})})]})]})}function R({currentFilter:l,onApply:a,onClose:i}){const[t,r]=u.useState({...l}),c=s=>{t.categories.includes(s)?r({...t,categories:t.categories.filter(m=>m!==s)}):r({...t,categories:[...t.categories,s]})},o=s=>{t.ageGroups.includes(s)?r({...t,ageGroups:t.ageGroups.filter(m=>m!==s)}):r({...t,ageGroups:[...t.ageGroups,s]})},d=()=>{r({...t,categories:Object.values(g)})},x=()=>{r({...t,ageGroups:Object.values(b)})};return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:i,children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[80vh] overflow-y-auto",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"sticky top-0 bg-white p-4 border-b flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Bộ lọc"}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-slate-100 rounded-full",children:e.jsx(S,{size:20})})]}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-slate-700",children:"Thể loại"}),e.jsx("button",{onClick:d,className:"text-sm text-emerald-600 hover:underline",children:"Chọn tất cả"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.values(g).map(s=>e.jsx("button",{onClick:()=>c(s),className:`px-3 py-2 rounded-xl text-sm font-medium transition-all ${t.categories.includes(s)?"bg-emerald-500 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:v[s]},s))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-slate-700",children:"Độ tuổi"}),e.jsx("button",{onClick:x,className:"text-sm text-emerald-600 hover:underline",children:"Chọn tất cả"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.values(b).map(s=>e.jsx("button",{onClick:()=>o(s),className:`px-3 py-2 rounded-xl text-sm font-medium transition-all ${t.ageGroups.includes(s)?"bg-emerald-500 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:M[s]},s))})]}),e.jsx("div",{children:e.jsxs("button",{onClick:()=>r({...t,favoritesOnly:!t.favoritesOnly}),className:`w-full flex items-center justify-between px-4 py-3 rounded-xl transition-all ${t.favoritesOnly?"bg-red-100 text-red-700":"bg-slate-100 text-slate-600"}`,children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(N,{size:18,fill:t.favoritesOnly?"currentColor":"none"}),"Chỉ hiện sách yêu thích"]}),e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${t.favoritesOnly?"bg-red-500 border-red-500":"border-slate-300"}`,children:t.favoritesOnly&&e.jsx(w,{size:12,className:"text-white"})})]})})]}),e.jsx("div",{className:"sticky bottom-0 bg-white p-4 border-t",children:e.jsx("button",{onClick:()=>a(t),className:"w-full py-3 bg-emerald-500 text-white rounded-xl font-bold hover:bg-emerald-600 transition-colors",children:"Áp dụng"})})]})})}export{q as BookWorldPage,q as default};
