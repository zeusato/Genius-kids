import{r as e,j as s,$ as _,a0 as o,a1 as j,o as $,u as P,a as F,b as T}from"./index-BR52Rtky.js";import{g as I,c as H,m as L,b as V,d as X,e as q,l as Y,f as K,h as W}from"./rewardService-Dd-pxHpI.js";import{M as Q}from"./MusicControls-B3aDTWZG.js";import"./volume-x-CFQy3J5n.js";const U="/Genius-kids/assets/Question_modal-DPliGkXi.png",z="/Genius-kids/assets/Correct_modal-I2Ye2IVE.png",O="/Genius-kids/assets/Wrong_modal-CKWBEe49.png",J=({riddle:a,student:c,difficulty:u,onClose:p,onProfileUpdate:r,onGachaReward:h,onSolveRiddle:m})=>{const[i,f]=e.useState(""),[S,y]=e.useState(!1),[l,b]=e.useState(!1),[M,E]=e.useState(""),[A,N]=e.useState(""),[t,w]=e.useState(null),[v,R]=e.useState(null),[k,G]=e.useState(!1);e.useEffect(()=>{E(I("invitation"))},[]);const C=n=>{switch(n){case o.EASY:return 3;case o.MEDIUM:return 4;case o.HARD:return 5;default:return 5}},B=()=>{const n=C(u);if(c.stars<n){alert(`Báº¡n cáº§n ${n} sao Ä‘á»ƒ xem Ä‘Ã¡p Ã¡n!`);return}const g={...c,stars:c.stars-n};r&&r(g),G(!0)},D=()=>{if(!i.trim()){alert("Vui lÃ²ng nháº­p cÃ¢u tráº£ lá»i!");return}const n=H(i,a.answer);if(b(n),n){L(c.id,a.rID);const{updatedProfile:g,reward:d}=V(c,u,c.id);r&&r(g),m&&m(a.category,u),w({stars:d.stars,card:d.card}),console.log("ðŸŽ Reward Info:",{stars:d.stars,hasCard:!!d.card,cardData:d.card}),N(I("success"))}else{const{updatedProfile:g,penaltyType:d}=X(c,c.id);r&&r(g),R(d),N(I("failure"))}y(!0)},x=()=>{const n=l&&(t==null?void 0:t.card);console.log("ðŸŽ° Gacha Check:",{isCorrect:l,hasRewardInfo:!!t,hasCard:!!(t!=null&&t.card),shouldShowGacha:n}),p(),n&&h&&setTimeout(()=>{console.log("ðŸŽ° Calling onGachaReward with card:",t.card),h(t.card)},300)};return s.jsx("div",{className:"riddle-modal-overlay",children:s.jsx("div",{className:"riddle-modal-content",children:S?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"riddle-result-sphinx",children:[s.jsx("img",{src:l?z:O,alt:l?"Sphinx Correct":"Sphinx Wrong",className:`sphinx-modal-image ${l?"correct":"wrong"}`}),s.jsx("div",{className:`result-aura ${l?"success-aura":"fail-aura"}`})]}),s.jsx("div",{className:"riddle-result-title",children:s.jsx("h3",{className:l?"correct":"wrong",children:l?"âœ… ChÃ­nh xÃ¡c!":"âŒ ChÆ°a Ä‘Ãºng!"})}),s.jsx("div",{className:"riddle-result-dialogue",children:s.jsx("p",{children:A})}),s.jsxs("div",{className:`riddle-result-content ${l?"correct":"wrong"}`,children:[(l||k)&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"correct-answer",children:[s.jsx("strong",{children:"ÄÃ¡p Ã¡n:"})," ",a.answer]}),s.jsxs("div",{className:"answer-explanation",children:[s.jsx("strong",{children:"Giáº£i thÃ­ch:"}),s.jsx("p",{children:a.answer_explain})]})]}),!l&&!k&&s.jsxs("div",{className:"wrong-message",children:[s.jsx("p",{children:"HÃ£y thá»­ suy nghÄ© ká»¹ hÆ¡n vÃ  thá»­ láº¡i nhÃ©!"}),s.jsxs("div",{className:"unlock-answer-section",style:{marginTop:"15px",textAlign:"center"},children:[s.jsx("p",{style:{fontSize:"0.9em",marginBottom:"10px"},children:"Báº¡n cÃ³ muá»‘n xem Ä‘Ã¡p Ã¡n khÃ´ng?"}),s.jsxs("button",{className:"unlock-answer-btn",onClick:B,style:{background:"linear-gradient(45deg, #FFD700, #FFA500)",border:"none",borderRadius:"20px",padding:"8px 16px",color:"#fff",fontWeight:"bold",cursor:"pointer",boxShadow:"0 2px 5px rgba(0,0,0,0.2)"},children:["ðŸ”“ Xem Ä‘Ã¡p Ã¡n (",C(u)," â­)"]})]})]}),l&&t&&s.jsx("div",{className:"reward-display",children:s.jsxs("div",{className:"stars-reward",children:["â­ +",t.stars," sao"]})}),l&&t&&t.stars===0&&s.jsx("div",{className:"penalty-notice",children:s.jsx("p",{children:"âš ï¸ Báº¡n Ä‘ang bá»‹ pháº¡t nÃªn khÃ´ng nháº­n Ä‘Æ°á»£c thÆ°á»Ÿng láº§n nÃ y!"})}),!l&&v&&s.jsx("div",{className:"penalty-display",children:v===_.LOSE_STAR?s.jsx("div",{className:"penalty-stars",children:"â­ -1 sao"}):s.jsx("div",{className:"penalty-skip",children:"ðŸš« Bá» qua pháº§n thÆ°á»Ÿng káº¿ tiáº¿p"})})]}),s.jsx("div",{className:"riddle-result-actions",children:s.jsx("button",{className:"riddle-confirm-btn",onClick:x,children:"XÃ¡c nháº­n"})})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"riddle-sphinx-image",children:[s.jsx("img",{src:U,alt:"Sphinx Question",className:"sphinx-modal-image"}),s.jsx("div",{className:"mystical-aura"})]}),s.jsx("div",{className:"riddle-dialogue",children:s.jsx("p",{children:M})}),s.jsxs("div",{className:"riddle-question",children:[s.jsx("h3",{children:"CÃ¢u Ä‘á»‘:"}),s.jsx("p",{children:a.question})]}),a.note&&s.jsx("div",{className:"riddle-hint",children:s.jsxs("small",{children:["ðŸ’¡ ",a.note]})}),s.jsx("div",{className:"riddle-input-section",children:s.jsx("input",{type:"text",className:"riddle-input",placeholder:"Nháº­p cÃ¢u tráº£ lá»i cá»§a báº¡n...",value:i,onChange:n=>f(n.target.value),onKeyPress:n=>{n.key==="Enter"&&D()},autoFocus:!0})}),s.jsxs("div",{className:"riddle-actions",children:[s.jsx("button",{className:"riddle-cancel-btn",onClick:p,children:"Há»§y"}),s.jsx("button",{className:"riddle-submit-btn",onClick:D,children:"Tráº£ lá»i"})]})]})})})},Z="/Genius-kids/assets/riddle_page-BKqA5Xyi.png",ss=({student:a,onBack:c,onProfileUpdate:u,onSolveRiddle:p,onSaveCard:r})=>{const[h,m]=e.useState(j.VN_RIDDLE),[i,f]=e.useState(o.EASY),[S,y]=e.useState(null),[l,b]=e.useState(!1),[M,E]=e.useState(""),[A,N]=e.useState(!1),[t,w]=e.useState(!1),[v,R]=e.useState(null);e.useEffect(()=>{E(I("challenge"))},[]);const k=async()=>{const x=await q(h),n=Y(a.id),g=K(x,i,n.answeredRiddleIds),d=W(g);d?(y(d),b(!0),N(!1)):N(!0)},G=()=>{b(!1),y(null)},C=()=>{N(!1)},B=x=>{console.log("ðŸŽ Triggering gacha with card:",x),R(x),w(!0)},D=()=>{w(!1),R(null)};return s.jsxs("div",{className:"sphinx-riddle-screen",children:[s.jsxs("div",{className:"sphinx-header",children:[s.jsx("button",{className:"back-button",onClick:c,children:"â† Quay láº¡i"}),s.jsxs("div",{className:"student-info",children:[s.jsx("span",{className:"student-name",children:a.name}),s.jsxs("span",{className:"student-stars",children:["â­ ",a.stars]})]}),s.jsx(Q,{})]}),s.jsxs("div",{className:"sphinx-main-content",children:[s.jsxs("div",{className:"sphinx-image-container",children:[s.jsx("img",{src:Z,alt:"Sphinx",className:"sphinx-main-image"}),s.jsx("div",{className:"mystical-glow"})]}),s.jsx("div",{className:"sphinx-dialogue",children:s.jsx("p",{children:M})}),s.jsxs("div",{className:"selection-container",children:[s.jsxs("div",{className:"difficulty-section",children:[s.jsx("h3",{children:"Chá»n Ä‘á»™ khÃ³:"}),s.jsxs("div",{className:"difficulty-buttons",children:[s.jsx("button",{className:`difficulty-btn ${i===o.EASY?"active":""}`,onClick:()=>f(o.EASY),children:"Dá»… (1â­)"}),s.jsx("button",{className:`difficulty-btn ${i===o.MEDIUM?"active":""}`,onClick:()=>f(o.MEDIUM),children:"Trung bÃ¬nh (2â­)"}),s.jsx("button",{className:`difficulty-btn ${i===o.HARD?"active":""}`,onClick:()=>f(o.HARD),children:"KhÃ³ (3â­)"})]})]}),s.jsxs("div",{className:"category-section",children:[s.jsx("h3",{children:"Chá»n loáº¡i cÃ¢u Ä‘á»‘:"}),s.jsxs("div",{className:"category-buttons",children:[s.jsx("button",{className:`category-btn ${h===j.VN_RIDDLE?"active":""}`,onClick:()=>m(j.VN_RIDDLE),children:"Viá»‡t Nam"}),s.jsx("button",{className:`category-btn ${h===j.EN_RIDDLE?"active":""}`,onClick:()=>m(j.EN_RIDDLE),children:"NÆ°á»›c ngoÃ i"}),s.jsx("button",{className:`category-btn ${h===j.MIX?"active":""}`,onClick:()=>m(j.MIX),children:"Há»—n há»£p"})]})]})]}),s.jsx("button",{className:"start-button",onClick:k,children:"Báº¯t Ä‘áº§u giáº£i Ä‘á»‘!"})]}),l&&S&&s.jsx(J,{riddle:S,student:a,difficulty:i,onClose:G,onProfileUpdate:u,onGachaReward:B,onSolveRiddle:p}),t&&v&&s.jsx($,{image:v,isNew:!a.ownedImageIds.includes(v.id),onClose:D,onSaveCard:r}),A&&s.jsx("div",{className:"modal-overlay",onClick:C,children:s.jsxs("div",{className:"congrat-modal",onClick:x=>x.stopPropagation(),children:[s.jsx("div",{className:"congrat-icon",children:"ðŸŽ‰"}),s.jsx("h2",{children:"ChÃºc má»«ng!"}),s.jsxs("p",{children:["Báº¡n Ä‘Ã£ giáº£i háº¿t táº¥t cáº£ cÃ¡c cÃ¢u Ä‘á»‘ á»Ÿ má»©c Ä‘á»™ ",s.jsx("strong",{children:i}),"!"]}),s.jsx("p",{className:"congrat-subtitle",children:"HÃ£y thá»­ má»©c Ä‘á»™ khÃ¡c hoáº·c loáº¡i cÃ¢u Ä‘á»‘ khÃ¡c nhÃ©!"}),s.jsx("button",{className:"congrat-close-btn",onClick:C,children:"ÄÃ³ng"})]})})]})},ts=()=>{const a=P(),{currentStudent:c}=F(),{updateStudent:u,solveRiddle:p,saveGachaCard:r}=T(),h=()=>{a("/mode")},m=i=>{u(i)};return c?s.jsx(ss,{student:c,onBack:h,onProfileUpdate:m,onSolveRiddle:p,onSaveCard:r}):(a("/"),null)};export{ts as SphinxRiddlePage};
