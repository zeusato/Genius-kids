import{r as e,j as s,P as _,K as P,L as o,N as j,n as $,u as F,a as T,b as H}from"./index-DvBuJBKP.js";import{g as k,c as L,m as V,b as X,d as q,e as K,l as Y,f as W,h as Q}from"./rewardService-DmJUM4df.js";import{M as U}from"./MusicControls-BHSVUUmP.js";import"./volume-x-BANQlRe3.js";const z="/Genius-kids/assets/Question_modal-DPliGkXi.png",O="/Genius-kids/assets/Correct_modal-I2Ye2IVE.png",J="/Genius-kids/assets/Wrong_modal-CKWBEe49.png",Z=({riddle:a,student:c,difficulty:u,onClose:p,onProfileUpdate:i,onGachaReward:m,onSolveRiddle:r})=>{const[x,C]=e.useState(""),[y,D]=e.useState(!1),[n,I]=e.useState(!1),[M,E]=e.useState(""),[N,S]=e.useState(""),[t,v]=e.useState(null),[f,A]=e.useState(null),[b,w]=e.useState(!1);e.useEffect(()=>{E(k("invitation"))},[]);const R=l=>{switch(l){case o.EASY:return 3;case o.MEDIUM:return 4;case o.HARD:return 5;default:return 5}},G=()=>{const l=R(u);if(c.stars<l){alert(`Báº¡n cáº§n ${l} sao Ä‘á»ƒ xem Ä‘Ã¡p Ã¡n!`);return}const d={...c,stars:c.stars-l};P(d),i&&i(d),w(!0)},h=()=>{if(!x.trim()){alert("Vui lÃ²ng nháº­p cÃ¢u tráº£ lá»i!");return}const l=L(x,a.answer);if(I(l),l){V(c.id,a.rID);const{updatedProfile:d,reward:g}=X(c,u,c.id);P(d),i&&i(d),r&&r(a.category,u),v({stars:g.stars,card:g.card}),console.log("ðŸŽ Reward Info:",{stars:g.stars,hasCard:!!g.card,cardData:g.card}),S(k("success"))}else{const{updatedProfile:d,penaltyType:g}=q(c,c.id);P(d),i&&i(d),A(g),S(k("failure"))}D(!0)},B=()=>{const l=n&&(t==null?void 0:t.card);console.log("ðŸŽ° Gacha Check:",{isCorrect:n,hasRewardInfo:!!t,hasCard:!!(t!=null&&t.card),shouldShowGacha:l}),p(),l&&m&&setTimeout(()=>{console.log("ðŸŽ° Calling onGachaReward with card:",t.card),m(t.card)},300)};return s.jsx("div",{className:"riddle-modal-overlay",children:s.jsx("div",{className:"riddle-modal-content",children:y?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"riddle-result-sphinx",children:[s.jsx("img",{src:n?O:J,alt:n?"Sphinx Correct":"Sphinx Wrong",className:`sphinx-modal-image ${n?"correct":"wrong"}`}),s.jsx("div",{className:`result-aura ${n?"success-aura":"fail-aura"}`})]}),s.jsx("div",{className:"riddle-result-title",children:s.jsx("h3",{className:n?"correct":"wrong",children:n?"âœ… ChÃ­nh xÃ¡c!":"âŒ ChÆ°a Ä‘Ãºng!"})}),s.jsx("div",{className:"riddle-result-dialogue",children:s.jsx("p",{children:N})}),s.jsxs("div",{className:`riddle-result-content ${n?"correct":"wrong"}`,children:[(n||b)&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"correct-answer",children:[s.jsx("strong",{children:"ÄÃ¡p Ã¡n:"})," ",a.answer]}),s.jsxs("div",{className:"answer-explanation",children:[s.jsx("strong",{children:"Giáº£i thÃ­ch:"}),s.jsx("p",{children:a.answer_explain})]})]}),!n&&!b&&s.jsxs("div",{className:"wrong-message",children:[s.jsx("p",{children:"HÃ£y thá»­ suy nghÄ© ká»¹ hÆ¡n vÃ  thá»­ láº¡i nhÃ©!"}),s.jsxs("div",{className:"unlock-answer-section",style:{marginTop:"15px",textAlign:"center"},children:[s.jsx("p",{style:{fontSize:"0.9em",marginBottom:"10px"},children:"Báº¡n cÃ³ muá»‘n xem Ä‘Ã¡p Ã¡n khÃ´ng?"}),s.jsxs("button",{className:"unlock-answer-btn",onClick:G,style:{background:"linear-gradient(45deg, #FFD700, #FFA500)",border:"none",borderRadius:"20px",padding:"8px 16px",color:"#fff",fontWeight:"bold",cursor:"pointer",boxShadow:"0 2px 5px rgba(0,0,0,0.2)"},children:["ðŸ”“ Xem Ä‘Ã¡p Ã¡n (",R(u)," â­)"]})]})]}),n&&t&&s.jsx("div",{className:"reward-display",children:s.jsxs("div",{className:"stars-reward",children:["â­ +",t.stars," sao"]})}),n&&t&&t.stars===0&&s.jsx("div",{className:"penalty-notice",children:s.jsx("p",{children:"âš ï¸ Báº¡n Ä‘ang bá»‹ pháº¡t nÃªn khÃ´ng nháº­n Ä‘Æ°á»£c thÆ°á»Ÿng láº§n nÃ y!"})}),!n&&f&&s.jsx("div",{className:"penalty-display",children:f===_.LOSE_STAR?s.jsx("div",{className:"penalty-stars",children:"â­ -1 sao"}):s.jsx("div",{className:"penalty-skip",children:"ðŸš« Bá» qua pháº§n thÆ°á»Ÿng káº¿ tiáº¿p"})})]}),s.jsx("div",{className:"riddle-result-actions",children:s.jsx("button",{className:"riddle-confirm-btn",onClick:B,children:"XÃ¡c nháº­n"})})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"riddle-sphinx-image",children:[s.jsx("img",{src:z,alt:"Sphinx Question",className:"sphinx-modal-image"}),s.jsx("div",{className:"mystical-aura"})]}),s.jsx("div",{className:"riddle-dialogue",children:s.jsx("p",{children:M})}),s.jsxs("div",{className:"riddle-question",children:[s.jsx("h3",{children:"CÃ¢u Ä‘á»‘:"}),s.jsx("p",{children:a.question})]}),a.note&&s.jsx("div",{className:"riddle-hint",children:s.jsxs("small",{children:["ðŸ’¡ ",a.note]})}),s.jsx("div",{className:"riddle-input-section",children:s.jsx("input",{type:"text",className:"riddle-input",placeholder:"Nháº­p cÃ¢u tráº£ lá»i cá»§a báº¡n...",value:x,onChange:l=>C(l.target.value),onKeyPress:l=>{l.key==="Enter"&&h()},autoFocus:!0})}),s.jsxs("div",{className:"riddle-actions",children:[s.jsx("button",{className:"riddle-cancel-btn",onClick:p,children:"Há»§y"}),s.jsx("button",{className:"riddle-submit-btn",onClick:h,children:"Tráº£ lá»i"})]})]})})})},ss="/Genius-kids/assets/riddle_page-BKqA5Xyi.png",es=({student:a,onBack:c,onProfileUpdate:u,onSolveRiddle:p})=>{const[i,m]=e.useState(j.VN_RIDDLE),[r,x]=e.useState(o.EASY),[C,y]=e.useState(null),[D,n]=e.useState(!1),[I,M]=e.useState(""),[E,N]=e.useState(!1),[S,t]=e.useState(!1),[v,f]=e.useState(null);e.useEffect(()=>{M(k("challenge"))},[]);const A=async()=>{const h=await K(i),B=Y(a.id),l=W(h,r,B.answeredRiddleIds),d=Q(l);d?(y(d),n(!0),N(!1)):N(!0)},b=()=>{n(!1),y(null)},w=()=>{N(!1)},R=h=>{console.log("ðŸŽ Triggering gacha with card:",h),f(h),t(!0)},G=()=>{t(!1),f(null)};return s.jsxs("div",{className:"sphinx-riddle-screen",children:[s.jsxs("div",{className:"sphinx-header",children:[s.jsx("button",{className:"back-button",onClick:c,children:"â† Quay láº¡i"}),s.jsxs("div",{className:"student-info",children:[s.jsx("span",{className:"student-name",children:a.name}),s.jsxs("span",{className:"student-stars",children:["â­ ",a.stars]})]}),s.jsx(U,{})]}),s.jsxs("div",{className:"sphinx-main-content",children:[s.jsxs("div",{className:"sphinx-image-container",children:[s.jsx("img",{src:ss,alt:"Sphinx",className:"sphinx-main-image"}),s.jsx("div",{className:"mystical-glow"})]}),s.jsx("div",{className:"sphinx-dialogue",children:s.jsx("p",{children:I})}),s.jsxs("div",{className:"selection-container",children:[s.jsxs("div",{className:"difficulty-section",children:[s.jsx("h3",{children:"Chá»n Ä‘á»™ khÃ³:"}),s.jsxs("div",{className:"difficulty-buttons",children:[s.jsx("button",{className:`difficulty-btn ${r===o.EASY?"active":""}`,onClick:()=>x(o.EASY),children:"Dá»… (1â­)"}),s.jsx("button",{className:`difficulty-btn ${r===o.MEDIUM?"active":""}`,onClick:()=>x(o.MEDIUM),children:"Trung bÃ¬nh (2â­)"}),s.jsx("button",{className:`difficulty-btn ${r===o.HARD?"active":""}`,onClick:()=>x(o.HARD),children:"KhÃ³ (3â­)"})]})]}),s.jsxs("div",{className:"category-section",children:[s.jsx("h3",{children:"Chá»n loáº¡i cÃ¢u Ä‘á»‘:"}),s.jsxs("div",{className:"category-buttons",children:[s.jsx("button",{className:`category-btn ${i===j.VN_RIDDLE?"active":""}`,onClick:()=>m(j.VN_RIDDLE),children:"Viá»‡t Nam"}),s.jsx("button",{className:`category-btn ${i===j.EN_RIDDLE?"active":""}`,onClick:()=>m(j.EN_RIDDLE),children:"NÆ°á»›c ngoÃ i"}),s.jsx("button",{className:`category-btn ${i===j.MIX?"active":""}`,onClick:()=>m(j.MIX),children:"Há»—n há»£p"})]})]})]}),s.jsx("button",{className:"start-button",onClick:A,children:"Báº¯t Ä‘áº§u giáº£i Ä‘á»‘!"})]}),D&&C&&s.jsx(Z,{riddle:C,student:a,difficulty:r,onClose:b,onProfileUpdate:u,onGachaReward:R,onSolveRiddle:p}),S&&v&&s.jsx($,{image:v,isNew:!a.ownedImageIds.includes(v.id),onClose:G}),E&&s.jsx("div",{className:"modal-overlay",onClick:w,children:s.jsxs("div",{className:"congrat-modal",onClick:h=>h.stopPropagation(),children:[s.jsx("div",{className:"congrat-icon",children:"ðŸŽ‰"}),s.jsx("h2",{children:"ChÃºc má»«ng!"}),s.jsxs("p",{children:["Báº¡n Ä‘Ã£ giáº£i háº¿t táº¥t cáº£ cÃ¡c cÃ¢u Ä‘á»‘ á»Ÿ má»©c Ä‘á»™ ",s.jsx("strong",{children:r}),"!"]}),s.jsx("p",{className:"congrat-subtitle",children:"HÃ£y thá»­ má»©c Ä‘á»™ khÃ¡c hoáº·c loáº¡i cÃ¢u Ä‘á»‘ khÃ¡c nhÃ©!"}),s.jsx("button",{className:"congrat-close-btn",onClick:w,children:"ÄÃ³ng"})]})})]})},cs=()=>{const a=F(),{currentStudent:c}=T(),{setStudent:u,solveRiddle:p}=H(),i=()=>{a("/mode")},m=r=>{u(r)};return c?s.jsx(es,{student:c,onBack:i,onProfileUpdate:m,onSolveRiddle:p}):(a("/"),null)};export{cs as SphinxRiddlePage};
