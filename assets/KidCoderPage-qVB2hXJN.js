import{a as be,b as Te,r as y,j as e,S as fe,X as Ke,f as De,C as Be,u as We}from"./index-DvBuJBKP.js";import{p as T}from"./sound-T8L9Tr_t.js";import{A as Se}from"./arrow-left-gwNZngz_.js";import{F as qe,K as Ne,S as Fe,a as he,B as Ae,D as He,C as ue,b as pe,c as ge}from"./sword-CAnFMUGD.js";import{T as ye}from"./trash-2-DdDbwsYf.js";import{T as Oe}from"./triangle-alert-Kr4WgPik.js";import{A as Q}from"./arrow-up-2bf7cEXd.js";import{I as ve}from"./info-BZFZaFSx.js";import{P as Ue}from"./play-DkBcaNvX.js";import{L as Ge}from"./lock-DITny_Vo.js";const xe=(b,P,o=1)=>{switch(P){case"N":return{row:b.row-o,col:b.col};case"S":return{row:b.row+o,col:b.col};case"E":return{row:b.row,col:b.col+o};case"W":return{row:b.row,col:b.col-o}}},se=(b,P)=>b.row>=0&&b.row<P&&b.col>=0&&b.col<P,we=[{id:1,title:"Táº­p sá»± (Novice)",description:"LÃ m quen vá»›i cÃ¡c lá»‡nh cÆ¡ báº£n",lessons:5,color:"bg-blue-500"},{id:2,title:"ThÃ¡m hiá»ƒm (Explorer)",description:"Há»c cÃ¡ch ráº½ trÃ¡i vÃ  pháº£i",lessons:10,color:"bg-green-500"},{id:3,title:"Thá»­ thÃ¡ch (Challenger)",description:"Chiáº¿n Ä‘áº¥u vá»›i quÃ¡i váº­t",lessons:10,color:"bg-purple-500"},{id:4,title:"Giáº£i Ä‘á»‘ (Puzzle Master)",description:"TÃ¬m khÃ³a má»Ÿ cá»­a",lessons:10,color:"bg-orange-500"},{id:5,title:"Ká»¹ sÆ° (Engineer)",description:"Äáº©y há»™p láº¥p báº«y",lessons:10,color:"bg-red-500"}],_e=(b,P)=>{let o=6,E=0,C=5,f=["forward"],u=1,d=!1,$=!1,k=!1,B=!1,l=!1;b===1?(o=6,f=["forward"],C=P<=2?5:6):b===2?(o=6,f=["forward","left","right","jump"],u=2,P<=3?C=6:P<=6?(C=7,d=!0):(C=8,d=!0)):b===3?(o=7,f=["forward","left","right","jump","fight"],u=3,d=!0,$=!0,C=P<=5?8:10,E=P<=5?2:3):b===4?(o=8,f=["forward","left","right","jump","fight"],u=4,d=!0,$=!0,k=!0,C=P<=5?10:12,E=2):(o=8,f=["forward","left","right","jump","fight","push"],u=5,d=!0,$=!0,k=!0,B=!0,l=!0,C=P<=5?12:14,E=2);const x=Array.from({length:o},()=>Array(o).fill("empty"));let W={row:0,col:0},A={row:0,col:0},_="E",m=[],H=[],V=[],q,O=[],Y=0,L=0;const oe=o===8?20:Math.floor(o*o*.3);for(;Y<100;){Y++;for(let g=0;g<o;g++)for(let v=0;v<o;v++)x[g][v]="empty";L=0;const n=u>1?1:0;W={row:Math.floor(Math.random()*(o-2*n))+n,col:Math.floor(Math.random()*(o-2*n))+n},_=["N","E","S","W"][Math.floor(Math.random()*4)],m=[W],H=[];let r=W,s=_,p=0,w=0;for(;p<C*2;){let g="forward";const v=Math.random();if(u===1?g="forward":u>1&&v<.3?g="turn":d&&v>.8&&L<oe?g="jump":$&&v>.6&&v<=.8&&w<2&&(g="fight"),g==="turn")(Math.random()<.5?"left":"right")==="left"?s=s==="N"?"W":s==="W"?"S":s==="S"?"E":"N":s=s==="N"?"E":s==="E"?"S":s==="S"?"W":"N";else if(g==="jump"){const h=xe(r,s,2),j=xe(r,s,1);se(h,o)&&!m.some(K=>K.row===h.row&&K.col===h.col)&&(r=h,m.push(r),p++,x[j.row][j.col]==="empty"&&(x[j.row][j.col]="water",L++))}else if(g==="fight"){const h=xe(r,s,1);se(h,o)&&!m.some(j=>j.row===h.row&&j.col===h.col)&&(H.push(h),r=h,m.push(r),p+=2,w++)}else{const h=xe(r,s);if(se(h,o)&&!m.some(j=>j.row===h.row&&j.col===h.col))r=h,m.push(r),p++;else break}if(m.length>=C&&Math.random()>.8)break}if(m.length>=C){A=m[m.length-1];break}}x[W.row][W.col]="start",x[A.row][A.col]="end";const X=o===8?10:Math.floor(o*o*.15);if(d&&L<X){const n=X-L;let i=0;for(let r=0;r<200&&i<n;r++){const s=Math.floor(Math.random()*o),p=Math.floor(Math.random()*o);!m.some(g=>g.row===s&&g.col===p)&&x[s][p]==="empty"&&(x[s][p]="water",i++,L++)}}if(H.forEach(n=>{x[n.row][n.col]==="empty"&&(x[n.row][n.col]="monster")}),k){for(let n=0;n<100;n++){const i=Math.floor(Math.random()*o),r=Math.floor(Math.random()*o);if(!m.some(p=>p.row===i&&p.col===r)&&x[i][r]==="empty"){x[i][r]="key",q={row:i,col:r};break}}if(!q)for(let n=0;n<o;n++){for(let i=0;i<o;i++)if(!m.some(s=>s.row===n&&s.col===i)&&x[n][i]==="empty"){x[n][i]="key",q={row:n,col:i};break}if(q)break}}let Z=0;if(B&&l){const n=1+Math.floor(Math.random()*2);for(let i=0;i<n;i++)for(let r=0;r<100;r++){const s=Math.floor(Math.random()*o),p=Math.floor(Math.random()*o);if(x[s][p]==="empty"&&!m.some(w=>w.row===s&&w.col===p)){const w=[{dr:-1,dc:0},{dr:1,dc:0},{dr:0,dc:-1},{dr:0,dc:1}];for(let v=w.length-1;v>0;v--){const h=Math.floor(Math.random()*(v+1));[w[v],w[h]]=[w[h],w[v]]}let g=!1;for(const v of w){const h=s+v.dr,j=p+v.dc,K=s+v.dr*2,ae=p+v.dc*2,ne=m.some(I=>I.row===h&&I.col===j),ce=m.some(I=>I.row===K&&I.col===ae);if(se({row:h,col:j},o)&&se({row:K,col:ae},o)&&!ne&&!ce&&x[h][j]==="empty"&&x[K][ae]==="empty"){x[s][p]="trap",x[h][j]="box",O.push({row:h,col:j}),Z++,g=!0;break}}if(g)break}}}let U=0;if(m.length>3){const n=[];for(let r=1;r<m.length-1;r++){const s=m[r];x[s.row][s.col]==="empty"&&n.push(r)}for(let r=n.length-1;r>0;r--){const s=Math.floor(Math.random()*(r+1));[n[r],n[s]]=[n[s],n[r]]}const i=Math.min(3-Z,n.length);for(let r=0;r<i;r++){const s=m[n[r]];x[s.row][s.col]="star",U++}}if(U+=Z,O.forEach(n=>{const i=[{dr:-1,dc:0},{dr:1,dc:0},{dr:0,dc:-1},{dr:0,dc:1}];for(const r of i){const s=n.row-r.dr,p=n.col-r.dc,w=n.row+r.dr,g=n.col+r.dc;if(se({row:s,col:p},o)&&se({row:w,col:g},o)&&x[s][p]==="trap"){x[w][g]!=="empty"&&x[w][g]!=="start"&&x[w][g]!=="end"&&(x[w][g]="empty");break}}}),u>=2){let n=0,i=0;for(;n<E&&i<200;){i++;const r=Math.floor(Math.random()*o),s=Math.floor(Math.random()*o);!m.some(w=>w.row===r&&w.col===s)&&x[r][s]==="empty"&&(x[r][s]="wall",n++)}}return{id:`${b}-${P}-${Date.now()}`,grid:x,startPos:W,endPos:A,startDir:_,optimalSteps:m.length-1+H.length,allowedCommands:f,gridSize:o,requiredStars:U,gatePositions:V.length>0?V:void 0,keyPosition:q,boxPositions:O.length>0?O:void 0}},Ve=({initialLevel:b,initialLesson:P,onExit:o,onComplete:E})=>{const{currentStudent:C}=be(),{updateStudent:f,addGameResult:u}=Te(),[d,$]=y.useState(b),[k,B]=y.useState(P),[l,x]=y.useState(null),W=y.useMemo(()=>{if(!(C!=null&&C.gameHistory))return!1;const a=`${d}-${k}`;return C.gameHistory.some(c=>c.gameType==="kidcoder"&&c.difficulty===a)},[C,d,k]),[A,_]=y.useState({row:0,col:0}),[m,H]=y.useState("E"),[V,q]=y.useState([]),[O,Y]=y.useState([]),[L,oe]=y.useState(!1),[X,Z]=y.useState([]),[U,n]=y.useState([]),[i,r]=y.useState([]),[s,p]=y.useState(!1),[w,g]=y.useState(-1),[v,h]=y.useState(null),[j,K]=y.useState("playing"),[ae,ne]=y.useState(!1),ce=y.useRef(null);y.useEffect(()=>{window.scrollTo(0,0),I(d,k)},[d,k]);const I=(a,c)=>{const t=_e(a,c);x(t),_(t.startPos),H(t.startDir),r([]),p(!1),g(-1),h(null),K("playing"),q([]),Y([]),oe(!1),Z(t.boxPositions||[]),n([])},G=y.useRef({robotPos:A,robotDir:m,program:i,currentStep:w,collectedLocations:V,defeatedMonsters:O,collectedKeys:L,boxPositions:X,filledTraps:U});y.useEffect(()=>{G.current={robotPos:A,robotDir:m,program:i,currentStep:w,collectedLocations:V,defeatedMonsters:O,collectedKeys:L,boxPositions:X,filledTraps:U}},[A,m,i,w,V,O,L,X,U]);const Ce=a=>{const{robotPos:c,robotDir:t,collectedLocations:M,defeatedMonsters:R,collectedKeys:F,boxPositions:ee,filledTraps:ie}=G.current;let D=t,N={...c},J=!1;if(a==="left")t==="N"?D="W":t==="W"?D="S":t==="S"?D="E":D="N",H(D);else if(a==="right")t==="N"?D="E":t==="E"?D="S":t==="S"?D="W":D="N",H(D);else if(a==="push"){let S={...c};t==="N"?S.row--:t==="S"?S.row++:t==="E"?S.col++:t==="W"&&S.col--;const te=ee.findIndex(z=>z.row===S.row&&z.col===S.col);if(te>=0){let z={...S};if(t==="N"?z.row--:t==="S"?z.row++:t==="E"?z.col++:t==="W"&&z.col--,l&&z.row>=0&&z.row<l.gridSize&&z.col>=0&&z.col<l.gridSize){const re=l.grid[z.row][z.col],de=`${z.row}-${z.col}`;if(re==="empty"||re==="water"||re==="trap"){const je=[...ee];je[te]=z,Z(je),(re==="water"||re==="trap")&&!ie.includes(de)&&(n(me=>[...me,de]),re==="trap"&&!M.includes(de)&&!W&&(q(me=>[...me,de]),T("ding"))),T("click");return}}}T("buzz");return}else if(a==="forward")t==="N"?N.row--:t==="S"?N.row++:t==="E"?N.col++:t==="W"&&N.col--;else if(a==="jump")J=!0,t==="N"?N.row-=2:t==="S"?N.row+=2:t==="E"?N.col+=2:t==="W"&&(N.col-=2);else if(a==="fight"){let S={...c};if(t==="N"?S.row--:t==="S"?S.row++:t==="E"?S.col++:t==="W"&&S.col--,l&&S.row>=0&&S.row<l.gridSize&&S.col>=0&&S.col<l.gridSize&&l.grid[S.row][S.col]==="monster"){const te=`${S.row}-${S.col}`;if(!R.includes(te)){Y(z=>[...z,te]),T("click");return}}T("click");return}if(!ke(N)){Pe();return}if(_(N),T("click"),l&&l.grid[N.row][N.col]==="star"){const S=`${N.row}-${N.col}`;!M.includes(S)&&!W&&(q(te=>[...te,S]),T("ding"))}l&&l.grid[N.row][N.col]==="key"&&!F&&(oe(!0),T("ding"))},ke=(a,c)=>{if(!l||a.row<0||a.row>=l.gridSize||a.col<0||a.col>=l.gridSize)return!1;const t=l.grid[a.row][a.col];if(t==="wall")return!1;if(t==="water"){const R=`${a.row}-${a.col}`;if(!G.current.filledTraps.includes(R))return!1}if(t==="trap"){const R=`${a.row}-${a.col}`;if(!G.current.filledTraps.includes(R))return!1}if(t==="monster"){const R=`${a.row}-${a.col}`;if(!G.current.defeatedMonsters.includes(R))return!1}return!G.current.boxPositions.some(R=>R.row===a.row&&R.col===a.col)},Pe=()=>{p(!1),h(G.current.currentStep),K("lost"),T("buzz")};y.useEffect(()=>(s&&j==="playing"&&(ce.current=setInterval(()=>{const{currentStep:a,program:c}=G.current,t=a+1;if(t>=c.length){p(!1);const{robotPos:M,collectedKeys:R}=G.current,F=l==null?void 0:l.endPos,ee=M.row===(F==null?void 0:F.row)&&M.col===(F==null?void 0:F.col),ie=l!=null&&l.keyPosition?R:!0;ee&&ie?(K("won"),T("complete")):(K("lost"),T("buzz"));return}g(t),Ce(c[t])},600)),()=>clearInterval(ce.current)),[s,j]);const le=a=>{s||j!=="playing"||(r([...i,a]),h(null),T("ding"))},ze=a=>{if(s||j!=="playing")return;const c=[...i];c.splice(a,1),r(c),h(null)},$e=()=>{s||j!=="playing"||(r([]),h(null),T("click"))},Me=()=>{if(s||j!=="playing"||i.length===0)return;const a=[...i];a.pop(),r(a),h(null),T("click")},Re=()=>{i.length!==0&&(p(!0),h(null),K("playing"),l&&(_(l.startPos),H(l.startDir),q([]),Y([]),g(-1)))},Ee=()=>{p(!1),g(-1),K("playing"),l&&(_(l.startPos),H(l.startDir),q([]),Y([]),oe(!1),Z(l.boxPositions||[]),n([]))},Le=()=>{u({id:Date.now().toString(),date:new Date().toISOString(),durationSeconds:0,gameType:"kidcoder",score:100,maxScore:100,difficulty:`${d}-${k}`,starsEarned:3}),E(d,k);const a=we.find(t=>t.id===d),c=a?a.lessons:10;k<c?B(k+1):(B(1),$(d+1))};return l?e.jsxs("div",{className:"min-h-screen bg-slate-900 z-50 flex flex-col items-center justify-start md:justify-center p-4",children:[e.jsxs("div",{className:"w-full max-w-4xl flex justify-between items-center mb-4 bg-slate-800 p-4 rounded-xl border border-slate-700 sticky top-0 z-30 shadow-lg",children:[e.jsx("button",{onClick:o,className:"p-2 bg-slate-700 rounded-lg text-white hover:bg-slate-600",children:e.jsx(Se,{})}),e.jsxs("div",{className:"text-white font-bold text-xl flex flex-col items-center",children:[e.jsxs("span",{children:["Level ",d," - BÃ i ",k]}),l.requiredStars>0&&e.jsx("div",{className:"flex gap-1 mt-1",children:Array.from({length:l.requiredStars}).map((a,c)=>e.jsx(fe,{size:16,className:c<V.length?"text-yellow-400 fill-yellow-400":"text-slate-600"},c))})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"bg-slate-900 px-3 py-1 rounded text-cyan-400 font-mono",children:[i.length," / ",l.optimalSteps+5," Blocks"]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 w-full max-w-5xl h-auto md:h-[80vh]",children:[e.jsxs("div",{className:"w-full md:flex-1 bg-slate-800 rounded-2xl p-4 shadow-2xl flex items-center justify-center border-4 border-slate-700 relative overflow-hidden min-h-[350px]",children:[e.jsx("div",{className:"grid gap-1 bg-slate-900 p-2 rounded-xl",style:{gridTemplateColumns:`repeat(${l.gridSize}, 1fr)`,gridTemplateRows:`repeat(${l.gridSize}, 1fr)`,width:"min(100%, 500px)",aspectRatio:"1/1"},children:l.grid.map((a,c)=>a.map((t,M)=>{const R=V.includes(`${c}-${M}`),F=O.includes(`${c}-${M}`),ee=U.includes(`${c}-${M}`),ie=X.some(J=>J.row===c&&J.col===M);c===l.endPos.row&&l.endPos.col;const D=t==="key"&&!L;let N="";return t==="wall"?N="TÆ°á»ng - khÃ´ng thá»ƒ Ä‘i qua":t==="water"?N=ee?"NÆ°á»›c Ä‘Ã£ láº¥p - cÃ³ thá»ƒ Ä‘i qua":"NÆ°á»›c - cáº§n nháº£y qua hoáº·c Ä‘áº©y há»™p vÃ o":t==="end"?N=l.keyPosition&&!L?"ÄÃ­ch - cáº§n chÃ¬a khÃ³a Ä‘á»ƒ hoÃ n thÃ nh! ðŸ”‘":"ÄÃ­ch - vá» Ä‘Ã¢y Ä‘á»ƒ hoÃ n thÃ nh! ðŸ":t==="star"&&!R&&!W?N="Sao - Ä‘iá»ƒm thÆ°á»Ÿng â­":t==="monster"&&!F?N='QuÃ¡i váº­t - dÃ¹ng lá»‡nh "Chiáº¿n Ä‘áº¥u" Ä‘á»ƒ Ä‘Ã¡nh báº¡i ðŸ’€':D?N="ChÃ¬a khÃ³a - cáº§n Ä‘á»ƒ má»Ÿ Ä‘Ã­ch ðŸ”‘":ie?N='Há»™p - dÃ¹ng lá»‡nh "Äáº©y" Ä‘á»ƒ di chuyá»ƒn ðŸ“¦':t==="trap"&&(N=ee?"NÆ°á»›c Ä‘Ã£ láº¥p - cÃ³ thá»ƒ Ä‘i qua vÃ  láº¥y sao":"NÆ°á»›c cÃ³ sao - Ä‘áº©y há»™p vÃ o Ä‘á»ƒ láº¥p nÆ°á»›c ðŸ’§â­"),e.jsxs("div",{title:N,className:`
                                            relative rounded-lg flex items-center justify-center w-full h-full cursor-help
                                            ${t==="wall"?"bg-slate-700 shadow-inner":t==="water"||t==="trap"?"bg-blue-500/30 border border-blue-500/50":"bg-slate-800/50 border border-slate-700/50"}
                                        `,children:[t==="wall"&&e.jsx("div",{className:"w-full h-full bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-20"}),t==="water"&&e.jsx("div",{className:"w-full h-full animate-pulse opacity-50",children:"ðŸŒŠ"}),t==="end"&&e.jsxs("div",{className:"relative",children:[e.jsx(qe,{className:"text-green-500 w-8 h-8 animate-bounce"}),l.keyPosition&&!L&&e.jsx("div",{className:"absolute -top-2 -right-2 bg-yellow-400 rounded-full p-1",children:e.jsx(Ne,{className:"w-4 h-4 text-slate-900"})})]}),t==="star"&&!R&&!W&&e.jsx(fe,{className:"text-yellow-400 w-6 h-6 animate-spin-slow"}),t==="monster"&&!F&&e.jsx(Fe,{className:"text-red-500 w-6 h-6 animate-pulse"}),t==="key"&&!L&&e.jsx(Ne,{className:"text-yellow-400 w-6 h-6 animate-bounce"}),t==="trap"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full h-full animate-pulse opacity-50",children:"ðŸŒŠ"}),!U.includes(`${c}-${M}`)&&e.jsx(fe,{className:"absolute text-yellow-400 w-6 h-6 animate-spin-slow"})]}),X.some(J=>J.row===c&&J.col===M)&&e.jsx(he,{className:"text-amber-600 w-6 h-6"}),A.row===c&&A.col===M&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center transition-all duration-500 z-10",style:{transform:`rotate(${m==="N"?0:m==="E"?90:m==="S"?180:270}deg)`},children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2",children:e.jsx("div",{className:"w-0 h-0 border-l-[6px] border-l-transparent border-r-[6px] border-r-transparent border-b-[8px] border-b-yellow-400 filter drop-shadow"})}),e.jsx("div",{className:"bg-cyan-500 p-2 rounded-full shadow-[0_0_15px_rgba(6,182,212,0.6)]",children:e.jsx(Ae,{className:"text-white w-6 h-6 md:w-8 md:h-8"})})]})})]},`${c}-${M}`)}))}),j!=="playing"&&e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-20 animate-in zoom-in",children:e.jsx("div",{className:"bg-white p-8 rounded-3xl text-center max-w-sm",children:j==="won"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸŽ‰"}),e.jsx("h2",{className:"text-3xl font-bold text-slate-800 mb-2",children:"HoÃ n thÃ nh!"}),e.jsx("p",{className:"text-slate-600 mb-6",children:"Báº¡n Ä‘Ã£ láº­p trÃ¬nh thÃ nh cÃ´ng."}),e.jsx("button",{onClick:Le,className:"w-full py-3 bg-green-500 text-white rounded-xl font-bold text-lg hover:bg-green-600 shadow-lg",children:"MÃ n tiáº¿p theo"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ’¥"}),e.jsx("h2",{className:"text-3xl font-bold text-slate-800 mb-2",children:"Tháº¥t báº¡i!"}),e.jsx("p",{className:"text-slate-600 mb-6",children:j==="lost"&&v!==null?"Robot Ä‘Ã£ gáº·p sá»± cá»‘.":"ChÆ°a vá» Ä‘áº¿n Ä‘Ã­ch!"}),e.jsx("button",{onClick:Ee,className:"w-full py-3 bg-slate-500 text-white rounded-xl font-bold text-lg hover:bg-slate-600 shadow-lg",children:"Thá»­ láº¡i"})]})})})]}),e.jsxs("div",{className:"w-full md:w-80 flex flex-col gap-4 h-auto md:h-full",children:[e.jsxs("div",{className:"flex-1 bg-slate-800 rounded-2xl p-4 border border-slate-700 flex flex-col min-h-0",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-slate-400 font-bold text-sm uppercase tracking-wider",children:"ChÆ°Æ¡ng trÃ¬nh chÃ­nh"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:Me,disabled:s||i.length===0,className:"text-slate-500 hover:text-yellow-400 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"XÃ³a lá»‡nh cuá»‘i",children:e.jsx(He,{size:18})}),e.jsx("button",{onClick:$e,disabled:s||i.length===0,className:"text-slate-500 hover:text-red-400 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"XÃ³a táº¥t cáº£",children:e.jsx(ye,{size:18})})]})]}),e.jsxs("div",{className:"flex-1 bg-slate-900/50 rounded-xl p-2 overflow-y-auto md:overflow-y-auto overflow-x-auto flex md:flex-col gap-2 min-h-[80px] md:min-h-[200px]",children:[i.length===0&&e.jsx("div",{className:"text-slate-600 text-center mt-4 md:mt-10 text-sm italic w-full",children:"Chá»n lá»‡nh bÃªn dÆ°á»›i..."}),i.map((a,c)=>e.jsxs("div",{className:`
                                        flex items-center justify-center md:justify-start gap-3 p-2 md:p-3 rounded-lg border-l-4 transition-all min-w-[60px] md:min-w-0
                                        ${c===v?"bg-red-500/30 border-red-500 text-red-200":c===w?"bg-yellow-500/20 border-yellow-500 text-yellow-200":"bg-slate-700 border-slate-500 text-white"}
                                    `,children:[e.jsx("span",{className:"font-mono text-slate-500 text-xs w-4 hidden md:inline",children:c+1}),c===v&&e.jsx(Oe,{size:16,className:"text-red-500"}),a==="forward"&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{size:18})," ",e.jsx("span",{className:"hidden md:inline",children:"Äi tháº³ng"})]}),a==="left"&&e.jsxs(e.Fragment,{children:[e.jsx(ue,{size:18})," ",e.jsx("span",{className:"hidden md:inline",children:"Ráº½ trÃ¡i"})]}),a==="right"&&e.jsxs(e.Fragment,{children:[e.jsx(pe,{size:18})," ",e.jsx("span",{className:"hidden md:inline",children:"Ráº½ pháº£i"})]}),a==="jump"&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{size:18,className:"text-orange-400"})," ",e.jsx("span",{className:"hidden md:inline",children:"Nháº£y"})]}),a==="fight"&&e.jsxs(e.Fragment,{children:[e.jsx(ge,{size:18,className:"text-red-400"})," ",e.jsx("span",{className:"hidden md:inline",children:"Chiáº¿n Ä‘áº¥u"})]}),a==="push"&&e.jsxs(e.Fragment,{children:[e.jsx(he,{size:18,className:"text-purple-400"})," ",e.jsx("span",{className:"hidden md:inline",children:"Äáº©y"})]}),!s&&e.jsx("button",{onClick:()=>ze(c),className:"ml-auto text-slate-500 hover:text-red-400 hidden md:block",children:e.jsx(ye,{size:16})})]},c))]})]}),e.jsxs("div",{className:"bg-slate-800 rounded-2xl p-4 border border-slate-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 md:hidden",children:[e.jsx("span",{className:"text-slate-400 text-xs font-bold uppercase",children:"Lá»‡nh"}),e.jsxs("button",{onClick:()=>ne(!0),className:"text-cyan-400 hover:text-cyan-300 flex items-center gap-1 text-xs font-bold",children:[e.jsx(ve,{size:14})," HÆ°á»›ng dáº«n"]})]}),e.jsxs("div",{className:"grid grid-cols-6 md:grid-cols-3 gap-2",children:[l.allowedCommands.includes("forward")&&e.jsxs("button",{onClick:()=>le("forward"),disabled:s,title:"Äi tháº³ng",className:"p-3 md:p-4 bg-blue-500 hover:bg-blue-600 active:translate-y-1 text-white rounded-xl shadow-lg shadow-blue-900/20 flex flex-col items-center gap-1 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Q,{size:24}),e.jsx("span",{className:"text-xs font-bold hidden md:inline",children:"Äi tháº³ng"})]}),l.allowedCommands.includes("left")&&e.jsxs("button",{onClick:()=>le("left"),disabled:s,title:"Ráº½ trÃ¡i",className:"p-3 md:p-4 bg-purple-500 hover:bg-purple-600 active:translate-y-1 text-white rounded-xl shadow-lg shadow-purple-900/20 flex flex-col items-center gap-1 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ue,{size:24}),e.jsx("span",{className:"text-xs font-bold hidden md:inline",children:"TrÃ¡i"})]}),l.allowedCommands.includes("right")&&e.jsxs("button",{onClick:()=>le("right"),disabled:s,title:"Ráº½ pháº£i",className:"p-3 md:p-4 bg-purple-500 hover:bg-purple-600 active:translate-y-1 text-white rounded-xl shadow-lg shadow-purple-900/20 flex flex-col items-center gap-1 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(pe,{size:24}),e.jsx("span",{className:"text-xs font-bold hidden md:inline",children:"Pháº£i"})]}),l.allowedCommands.includes("jump")&&e.jsxs("button",{onClick:()=>le("jump"),disabled:s,title:"Nháº£y",className:"p-3 md:p-4 bg-orange-500 hover:bg-orange-600 active:translate-y-1 text-white rounded-xl shadow-lg shadow-orange-900/20 flex flex-col items-center gap-1 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Q,{size:24,className:"mb-[-10px]"}),e.jsx(Q,{size:16}),e.jsx("span",{className:"text-xs font-bold mt-1 hidden md:inline",children:"Nháº£y"})]}),l.allowedCommands.includes("fight")&&e.jsxs("button",{onClick:()=>le("fight"),disabled:s,title:"Chiáº¿n Ä‘áº¥u",className:"p-3 md:p-4 bg-red-500 hover:bg-red-600 active:translate-y-1 text-white rounded-xl shadow-lg shadow-red-900/20 flex flex-col items-center gap-1 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ge,{size:24}),e.jsx("span",{className:"text-xs font-bold mt-1 hidden md:inline",children:"Chiáº¿n Ä‘áº¥u"})]}),l.allowedCommands.includes("push")&&e.jsxs("button",{onClick:()=>le("push"),disabled:s,className:"p-3 md:p-4 bg-purple-500 hover:bg-purple-600 active:translate-y-1 text-white rounded-xl shadow-lg shadow-purple-900/20 flex flex-col items-center gap-1 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(he,{size:24}),e.jsx("span",{className:"text-xs font-bold mt-1 hidden md:inline",children:"Äáº©y"})]})]})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:Re,disabled:s||i.length===0,className:"flex-1 py-4 bg-green-500 hover:bg-green-600 active:translate-y-1 text-white rounded-xl font-bold text-lg shadow-lg shadow-green-900/20 flex items-center justify-center gap-2 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ue,{fill:"currentColor"})," Cháº¡y"]})})]})]}),ae&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-[60] flex items-center justify-center p-4 animate-in fade-in",children:e.jsxs("div",{className:"bg-slate-800 rounded-2xl border border-slate-700 w-full max-w-md overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"p-4 border-b border-slate-700 flex justify-between items-center bg-slate-900/50",children:[e.jsxs("h3",{className:"text-white font-bold text-lg flex items-center gap-2",children:[e.jsx(ve,{className:"text-cyan-400",size:20}),"HÆ°á»›ng dáº«n lá»‡nh"]}),e.jsx("button",{onClick:()=>ne(!1),className:"text-slate-400 hover:text-white",children:e.jsx(Ke,{size:24})})]}),e.jsxs("div",{className:"p-4 space-y-3 max-h-[60vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-700/50 rounded-xl",children:[e.jsx("div",{className:"p-2 bg-blue-500 rounded-lg text-white",children:e.jsx(Q,{size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-bold",children:"Äi tháº³ng"}),e.jsx("div",{className:"text-slate-400 text-sm",children:"Robot tiáº¿n 1 bÆ°á»›c vá» phÃ­a trÆ°á»›c."})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-700/50 rounded-xl",children:[e.jsx("div",{className:"p-2 bg-purple-500 rounded-lg text-white",children:e.jsx(ue,{size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-bold",children:"Ráº½ trÃ¡i"}),e.jsx("div",{className:"text-slate-400 text-sm",children:"Robot quay sang trÃ¡i 90 Ä‘á»™."})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-700/50 rounded-xl",children:[e.jsx("div",{className:"p-2 bg-purple-500 rounded-lg text-white",children:e.jsx(pe,{size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-bold",children:"Ráº½ pháº£i"}),e.jsx("div",{className:"text-slate-400 text-sm",children:"Robot quay sang pháº£i 90 Ä‘á»™."})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-700/50 rounded-xl",children:[e.jsxs("div",{className:"p-2 bg-orange-500 rounded-lg text-white",children:[e.jsx(Q,{size:20,className:"mb-[-10px]"}),e.jsx(Q,{size:14})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-bold",children:"Nháº£y"}),e.jsx("div",{className:"text-slate-400 text-sm",children:"Nháº£y qua 1 Ã´ (dÃ¹ng Ä‘á»ƒ vÆ°á»£t nÆ°á»›c)."})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-700/50 rounded-xl",children:[e.jsx("div",{className:"p-2 bg-red-500 rounded-lg text-white",children:e.jsx(ge,{size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-bold",children:"Chiáº¿n Ä‘áº¥u"}),e.jsx("div",{className:"text-slate-400 text-sm",children:"ÄÃ¡nh báº¡i quÃ¡i váº­t Ä‘á»©ng trÆ°á»›c máº·t."})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-700/50 rounded-xl",children:[e.jsx("div",{className:"p-2 bg-purple-500 rounded-lg text-white",children:e.jsx(he,{size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-bold",children:"Äáº©y"}),e.jsx("div",{className:"text-slate-400 text-sm",children:"Äáº©y há»™p vá» phÃ­a trÆ°á»›c 1 Ã´."})]})]})]}),e.jsx("div",{className:"p-4 border-t border-slate-700 bg-slate-900/50 text-center",children:e.jsx("button",{onClick:()=>ne(!1),className:"px-6 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-bold transition-colors",children:"ÄÃ£ hiá»ƒu"})})]})})]}):e.jsx("div",{children:"Loading..."})},Xe=({onSelectLevel:b,onExit:P})=>{const{currentStudent:o}=be();De.useEffect(()=>{window.scrollTo(0,0)},[]);const E=y.useMemo(()=>{if(!(o!=null&&o.gameHistory))return new Set;const f=o.gameHistory.filter(d=>d.gameType==="kidcoder"),u=new Set;return f.forEach(d=>{d.difficulty&&u.add(d.difficulty)}),console.log("KidCoder Progress:",Array.from(u)),u},[o]),C=(f,u)=>{const d=`${f}-${u}`;if(E.has(d)||f===1&&u===1)return!0;if(u>1){const $=`${f}-${u-1}`,k=E.has($);return k||console.log(`${d} locked - need ${$}`),k}else{const $=we.find(l=>l.id===f-1);if(!$)return!1;const k=`${f-1}-${$.lessons}`,B=E.has(k);return B||console.log(`${d} locked - need ${k}`),B}};return e.jsx("div",{className:"min-h-screen bg-slate-900 p-4 md:p-8 overflow-y-auto",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx("button",{onClick:P,className:"p-3 bg-slate-800 rounded-xl text-white hover:bg-slate-700 transition-colors",children:e.jsx(Se,{})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Láº­p TrÃ¬nh NhÃ­"}),e.jsx("p",{className:"text-slate-400",children:"Chá»n cáº¥p Ä‘á»™ Ä‘á»ƒ báº¯t Ä‘áº§u"})]})]}),e.jsx("div",{className:"grid gap-8",children:we.map(f=>e.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl ${f.color} flex items-center justify-center text-white font-bold text-xl shadow-lg`,children:f.id}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:f.title}),e.jsx("p",{className:"text-slate-400 text-sm",children:f.description})]})]}),f.lessons>0?e.jsx("div",{className:"grid grid-cols-5 gap-2",children:Array.from({length:f.lessons},(u,d)=>d+1).map(u=>{const d=C(f.id,u),$=E.has(`${f.id}-${u}`);return e.jsxs("button",{onClick:()=>d&&b(f.id,u),disabled:!d,className:`
                                                    relative aspect-square rounded-xl flex flex-col items-center justify-center gap-1 transition-all
                                                    ${d?"bg-slate-700 hover:bg-slate-600 cursor-pointer border-2 border-transparent hover:border-cyan-400":"bg-slate-900/50 cursor-not-allowed opacity-50"}
                                                    ${$?"border-green-500/50":""}
                                                `,children:[$&&e.jsx("div",{className:"absolute top-1 right-1 text-green-500",children:e.jsx(Be,{size:14})}),!d&&e.jsx("div",{className:"absolute top-1 left-1",children:e.jsx(Ge,{className:"text-slate-500",size:14})}),e.jsx("span",{className:"text-[10px] text-slate-500 uppercase font-bold",children:"BÃ i"}),e.jsx("span",{className:`text-xl font-bold ${d?"text-white":"text-slate-600"}`,children:u})]},u)})}):e.jsx("div",{className:"text-slate-500 italic bg-slate-900/30 p-4 rounded-xl text-center",children:"Äang phÃ¡t triá»ƒn..."})]},f.id))})]})})};function ot(){const b=We(),{currentStudent:P}=be(),[o,E]=y.useState("menu"),[C,f]=y.useState({level:1,lesson:1});if(!P)return b("/"),null;const u=()=>{E("menu")},d=()=>{b("/mode")},$=(B,l)=>{f({level:B,lesson:l}),E("game")},k=(B,l)=>{};return o==="menu"?e.jsx(Xe,{onSelectLevel:$,onExit:d}):e.jsx(Ve,{initialLevel:C.level,initialLesson:C.lesson,onExit:u,onComplete:k})}export{ot as KidCoderPage};
