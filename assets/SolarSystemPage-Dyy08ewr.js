var $n=Object.defineProperty;var es=(o,e,t)=>e in o?$n(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var de=(o,e,t)=>es(o,typeof e!="symbol"?e+"":e,t);import{j as D,r as R,f as Et,X as Dr,u as ts}from"./index-kvI97k6j.js";import{R as rs,T as ns,a as er,b as Kr,M as Gt,I as ss,S as ht,D as Qr,L as lr,c as Ft,F as $e,d as Ne,V as jr,C as Oe,e as as,P as is,f as os,g as nt,h as ee,i as cs,Q as bt,j as ls,O as Xr,k as us,l as hs,B as It,m as As,n as Zr,N as ds,o as ms,p as fs,q as He,r as tr,s as rr,t as Bs,u as Qe,v as ps,w as jt,x as gs,y as Yr,z as ot,A as Cs,E as Wr,G as vs,H as Ms,J as Es,K as Fs,U as bs,W as Xt,X as Is,Y as xt,Z as zr,_ as xs,$ as Rs,a0 as Ts,a1 as Ds,a2 as Vr,a3 as ys,a4 as ze,a5 as yr,a6 as Gr,a7 as wr,a8 as Gs,a9 as ws,aa as ur,ab as qr,ac as $r,ad as Ie,ae as je,af as ct,ag as Dt,ah as Ss,ai as Hs,aj as _s,ak as st,al as Ve,am as xe,an as wt,ao as en,ap as hr,aq as At,ar as Jt,as as Ls,at as Us,au as nr,av as Os,aw as Ns,ax as Js,ay as ks,az as sr,aA as Ps,aB as Sr,aC as Ks,aD as Qs,aE as js,aF as Xs,aG as Zs,aH as tn,aI as Ys,aJ as Ws,aK as Hr,aL as zs,aM as rn,aN as Vs,aO as qs,aP as $s,aQ as ea}from"./Stars-Boh96qp3.js";import{M as _r,R as ta,Z as ra,a as na}from"./zoom-out-856F0IBK.js";import{T as sa}from"./thermometer-DimLX9Ui.js";import{Z as aa}from"./zap-BvJntsWY.js";import{M as ia}from"./MusicControls-9szBTmx4.js";import{A as oa}from"./arrow-left-nyKTrqkZ.js";import{C as ca}from"./chevron-down-SGQPC_Tj.js";import"./with-selector-D5GKWkkn.js";import"./volume-x-BkcTN7TK.js";const la={id:"sun",name:"Mặt Trời",color:"#FDB813",size:109,orbitDistance:0,orbitSpeed:0,description:"Ngôi sao ở trung tâm Hệ Mặt Trời. Nó chiếm 99,86% khối lượng của toàn bộ hệ thống và cung cấp năng lượng cho sự sống trên Trái Đất.",facts:["Ánh sáng từ Mặt Trời mất 8 phút để đến Trái Đất.","Nhiệt độ bề mặt khoảng 5.500°C, nhưng lõi lên tới 15 triệu °C.","Mặt Trời sẽ phình to thành Sao Đỏ khổng lồ trong 5 tỷ năm nữa."],temperature:"5.500°C (Bề mặt)",distanceFromSun:"0 km",diameter:"1.4 triệu km",gravity:"274 m/s²",gradientColors:["#FFF176","#FF9800","#E65100"]},ua={id:"asteroid-belt",name:"Vành Đai Tiểu Hành Tinh",color:"#8B7355",size:0,orbitDistance:320,orbitSpeed:0,description:"Vành đai tiểu hành tinh là vùng không gian giữa Sao Hỏa và Sao Mộc chứa hàng triệu mảnh đá và kim loại nhỏ quay quanh Mặt Trời.",facts:["Có hơn 1 triệu tiểu hành tinh trong vành đai này.","Ceres là thiên thể lớn nhất, chiếm 1/3 tổng khối lượng vành đai.","Tổng khối lượng vành đai chỉ bằng 4% khối lượng Mặt Trăng.","Khoảng cách giữa các tiểu hành tinh thực tế rất xa, không giống phim ảnh."],temperature:"-73°C đến -108°C",distanceFromSun:"329-478 triệu km",diameter:"Ceres: 939 km",gravity:"Ceres: 0.28 m/s²",gradientColors:["#D4A373","#8B7355","#5D4037"]},Rt=[{id:"mercury",name:"Sao Thủy",color:"#A5A5A5",size:12,orbitDistance:140,orbitSpeed:5,description:"Hành tinh nhỏ nhất và gần Mặt Trời nhất. Sao Thủy không có khí quyển để giữ nhiệt, nên ban ngày rất nóng còn ban đêm rất lạnh.",facts:["Một năm trên Sao Thủy chỉ dài 88 ngày Trái Đất.","Nó nhỏ hơn cả mặt trăng Titan của Sao Thổ.","Bề mặt đầy hố thiên thạch giống Mặt Trăng."],temperature:"-173°C đến 427°C",distanceFromSun:"58 triệu km",diameter:"4,880 km",gravity:"3.7 m/s²",gradientColors:["#E0E0E0","#A5A5A5","#757575"]},{id:"venus",name:"Sao Kim",color:"#E3BB76",size:20,orbitDistance:180,orbitSpeed:12,description:'Hành tinh nóng nhất hệ mặt trời do hiệu ứng nhà kính cực mạnh. Nó còn được gọi là "Sao Hôm" hoặc "Sao Mai".',facts:["Sao Kim quay ngược chiều so với hầu hết các hành tinh khác.","Một ngày ở đây dài hơn một năm (quay rất chậm).","Nó sáng thứ 3 trên bầu trời, chỉ sau Mặt Trời và Mặt Trăng."],temperature:"462°C",distanceFromSun:"108 triệu km",diameter:"12,104 km",gravity:"8.87 m/s²",gradientColors:["#FFF3E0","#E3BB76","#D84315"]},{id:"earth",name:"Trái Đất",color:"#4F83CC",size:22,orbitDistance:230,orbitSpeed:20,description:"Hành tinh duy nhất được biết đến là có sự sống. Bề mặt được bao phủ bởi 70% là nước.",facts:["Trái Đất không hoàn toàn hình cầu, nó hơi phình ra ở xích đạo.","Là hành tinh duy nhất có tên không đặt theo thần thoại Hy Lạp/La Mã.","Có một vệ tinh tự nhiên là Mặt Trăng."],temperature:"-88°C đến 58°C",distanceFromSun:"150 triệu km",diameter:"12,742 km",gravity:"9.8 m/s²",gradientColors:["#81D4FA","#29B6F6","#01579B","#4CAF50"]},{id:"mars",name:"Sao Hỏa",color:"#E57373",size:16,orbitDistance:280,orbitSpeed:38,description:"Hành tinh Đỏ, nổi tiếng với các cơn bão bụi khổng lồ và ngọn núi lửa cao nhất hệ mặt trời (Olympus Mons).",facts:["Màu đỏ là do oxit sắt (gỉ sắt) trên bề mặt.","Có hai mặt trăng nhỏ là Phobos và Deimos.","Các nhà khoa học đang tìm kiếm dấu hiệu sự sống cổ đại ở đây."],temperature:"-153°C đến 20°C",distanceFromSun:"228 triệu km",diameter:"6,779 km",gravity:"3.71 m/s²",gradientColors:["#FFCCBC","#FF7043","#BF360C"]},{id:"jupiter",name:"Sao Mộc",color:"#D4A373",size:50,orbitDistance:420,orbitSpeed:120,description:"Hành tinh lớn nhất hệ mặt trời, một khối khí khổng lồ. Vết Đỏ Lớn là một cơn bão đã tồn tại hàng trăm năm.",facts:["Sao Mộc có thể chứa 1.300 Trái Đất bên trong nó.","Nó có hơn 79 mặt trăng đã được xác nhận.","Quay nhanh nhất trong các hành tinh (1 ngày < 10 giờ)."],temperature:"-145°C",distanceFromSun:"778 triệu km",diameter:"139,820 km",gravity:"24.79 m/s²",gradientColors:["#FFE0B2","#D4A373","#8D6E63","#5D4037"]},{id:"saturn",name:"Sao Thổ",color:"#FDD835",size:45,orbitDistance:520,orbitSpeed:200,description:"Nổi tiếng với hệ thống vành đai lộng lẫy làm từ băng và đá. Là hành tinh nhẹ nhất, có thể nổi trên mặt nước.",facts:["Vành đai của nó rộng nhưng rất mỏng (chỉ dày khoảng 1km).","Gió trên Sao Thổ cực mạnh, lên tới 1.800 km/h.","Có mặt trăng Titan với khí quyển dày đặc."],temperature:"-178°C",distanceFromSun:"1.4 tỷ km",diameter:"116,460 km",gravity:"10.44 m/s²",gradientColors:["#FFF9C4","#FDD835","#FBC02D"],ring:{color:"rgba(253, 216, 53, 0.4)",size:1.6}},{id:"uranus",name:"Sao Thiên Vương",color:"#4DD0E1",size:30,orbitDistance:620,orbitSpeed:400,description:'Hành tinh băng khổng lồ, có màu xanh ngọc tuyệt đẹp nhờ khí Methane. Nó quay "nằm ngang" so với quỹ đạo.',facts:["Là hành tinh lạnh nhất hệ mặt trời (-224°C).","Quay nghiêng 98 độ, như đang lăn trên quỹ đạo.","Được phát hiện bằng kính thiên văn vào năm 1781."],temperature:"-224°C",distanceFromSun:"2.9 tỷ km",diameter:"50,724 km",gravity:"8.69 m/s²",gradientColors:["#E0F7FA","#4DD0E1","#0097A7"]},{id:"neptune",name:"Sao Hải Vương",color:"#304FFE",size:29,orbitDistance:720,orbitSpeed:600,description:"Hành tinh xa nhất, đầy gió bão và băng giá. Màu xanh thẫm bí ẩn của đại dương vũ trụ.",facts:["Một năm ở đây dài bằng 165 năm Trái Đất.","Có những cơn gió nhanh nhất hệ mặt trời (2.100 km/h).","Mặt trăng Triton của nó phun ra băng nitơ."],temperature:"-214°C",distanceFromSun:"4.5 tỷ km",diameter:"49,244 km",gravity:"11.15 m/s²",gradientColors:["#8C9EFF","#304FFE","#1A237E"]}],ha=({data:o,isSelected:e,onSelect:t})=>{const n=o.gradientColors.length>1?`radial-gradient(circle at 30% 30%, ${o.gradientColors[0]}, ${o.gradientColors[1]}, ${o.gradientColors[2]||o.gradientColors[1]})`:o.color;return D.jsxs("div",{className:`absolute rounded-full cursor-pointer transition-transform duration-300 hover:scale-125 ${e?"scale-150 ring-4 ring-white/50":""}`,style:{width:`${o.size}px`,height:`${o.size}px`,background:n,boxShadow:`inset -${o.size/3}px -${o.size/3}px ${o.size/2}px rgba(0,0,0,0.7), 0 0 ${o.size/2}px ${o.color}80`,top:"50%",left:"50%",marginTop:`-${o.size/2}px`,marginLeft:`-${o.size/2}px`,zIndex:10},onClick:r=>{r.stopPropagation(),t(o.id)},children:[o.ring&&D.jsx("div",{className:"absolute rounded-full border-[6px] border-double opacity-80",style:{borderColor:o.ring.color,width:`${o.size*o.ring.size}px`,height:`${o.size*o.ring.size}px`,top:"50%",left:"50%",transform:"translate(-50%, -50%) rotateX(70deg)",boxShadow:`0 0 10px ${o.ring.color}`}}),D.jsx("div",{className:"absolute -bottom-6 left-1/2 -translate-x-1/2 text-[10px] text-white/80 whitespace-nowrap font-medium opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:o.name})]})},Aa=({selectedPlanet:o,onPlanetSelect:e,zoomLevel:t,viewOffset:n})=>{const[r,a]=R.useState(0),s=.4,u=Et.useMemo(()=>{const A={};return Rt.forEach(d=>{A[d.id]=Math.random()*360}),A},[]),c=Et.useMemo(()=>{const A=[];for(let p=0;p<200;p++){const g=Math.random()*360,v=320+(Math.random()-.5)*40,x=2+Math.random()*3,F=.4+Math.random()*.4,H=(Math.random()-.5)*.05;A.push({id:p,angle:g,distance:v,size:x,opacity:F,speedOffset:H})}return A},[]);R.useEffect(()=>{let A;const d=()=>{a(m=>m+.0015),A=requestAnimationFrame(d)};return o||d(),()=>cancelAnimationFrame(A)},[o]);const l=()=>{if(o){const A=o,B=(r*10/A.orbitSpeed*360+u[A.id])%360*(Math.PI/180),p=Math.cos(B)*A.orbitDistance,g=Math.sin(B)*A.orbitDistance*s;return{transform:`scale(${t}) translate(${-p}px, ${-g}px)`,transition:"transform 1s ease-in-out"}}return{transform:`scale(${t}) translate(${n.x}px, ${n.y}px)`,transition:"none"}};return D.jsx("div",{className:"w-full h-full flex items-center justify-center overflow-hidden bg-black/0",children:D.jsxs("div",{className:"relative w-0 h-0 transition-transform duration-700 ease-in-out",style:l(),children:[D.jsx("svg",{className:"absolute overflow-visible pointer-events-none",style:{width:"2000px",height:"2000px",zIndex:0,left:"50%",top:"50%",transform:"translate(-50%, -50%)"},viewBox:"-1000 -1000 2000 2000",children:Rt.map(A=>D.jsx("ellipse",{cx:"0",cy:"0",rx:A.orbitDistance,ry:A.orbitDistance*s,fill:"none",stroke:"rgba(255, 255, 255, 0.3)",strokeWidth:"1"},A.id))}),D.jsx("div",{className:"absolute top-1/2 left-1/2 w-20 h-20 rounded-full bg-yellow-400 shadow-[0_0_60px_#ff9800] z-20 cursor-pointer hover:scale-110 transition-transform",style:{background:"radial-gradient(circle at 30% 30%, #FFF176, #FF9800, #E65100)",transform:"translate(-50%, -80%)"},onClick:()=>e("sun")}),D.jsx("div",{className:"absolute top-0 left-0 pointer-events-none",style:{zIndex:15},children:c.map(A=>{const m=(A.angle+r*10*(1+A.speedOffset))*(Math.PI/180),B=Math.cos(m)*A.distance,p=Math.sin(m)*A.distance*s,g=p>0?25:15;return D.jsx("div",{className:"absolute rounded-full bg-slate-400",style:{width:`${A.size}px`,height:`${A.size}px`,opacity:A.opacity,transform:`translate(calc(-50% + ${B}px), calc(-50% + ${p}px))`,boxShadow:"0 0 2px rgba(255,255,255,0.3)",zIndex:g}},A.id)})}),Rt.map(A=>{const B=(r*10/A.orbitSpeed*360+u[A.id])%360*(Math.PI/180),p=Math.cos(B)*A.orbitDistance,g=Math.sin(B)*A.orbitDistance*s,v=g>0?30:10;return D.jsx("div",{className:"absolute pointer-events-auto",style:{transform:`translate(calc(-50% + ${p}px), calc(-50% + ${g}px))`,zIndex:v},children:D.jsx(ha,{data:A,isSelected:(o==null?void 0:o.id)===A.id,onSelect:e})},A.id)})]})})},Ar=parseInt(rs.replace(/\D+/g,""));function Lr(o,e){if(e===ns)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),o;if(e===er||e===Kr){let t=o.getIndex();if(t===null){const s=[],u=o.getAttribute("position");if(u!==void 0){for(let c=0;c<u.count;c++)s.push(c);o.setIndex(s),t=o.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),o}const n=t.count-2,r=[];if(t)if(e===er)for(let s=1;s<=n;s++)r.push(t.getX(0)),r.push(t.getX(s)),r.push(t.getX(s+1));else for(let s=0;s<n;s++)s%2===0?(r.push(t.getX(s)),r.push(t.getX(s+1)),r.push(t.getX(s+2))):(r.push(t.getX(s+2)),r.push(t.getX(s+1)),r.push(t.getX(s)));r.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=o.clone();return a.setIndex(r),a.clearGroups(),a}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),o}var Se=Uint8Array,qe=Uint16Array,ar=Uint32Array,nn=new Se([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),sn=new Se([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),da=new Se([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),an=function(o,e){for(var t=new qe(31),n=0;n<31;++n)t[n]=e+=1<<o[n-1];for(var r=new ar(t[30]),n=1;n<30;++n)for(var a=t[n];a<t[n+1];++a)r[a]=a-t[n]<<5|n;return[t,r]},on=an(nn,2),cn=on[0],ma=on[1];cn[28]=258,ma[258]=28;var fa=an(sn,0),Ba=fa[0],ir=new qe(32768);for(var le=0;le<32768;++le){var Ye=(le&43690)>>>1|(le&21845)<<1;Ye=(Ye&52428)>>>2|(Ye&13107)<<2,Ye=(Ye&61680)>>>4|(Ye&3855)<<4,ir[le]=((Ye&65280)>>>8|(Ye&255)<<8)>>>1}var Tt=(function(o,e,t){for(var n=o.length,r=0,a=new qe(e);r<n;++r)++a[o[r]-1];var s=new qe(e);for(r=0;r<e;++r)s[r]=s[r-1]+a[r-1]<<1;var u;if(t){u=new qe(1<<e);var c=15-e;for(r=0;r<n;++r)if(o[r])for(var l=r<<4|o[r],A=e-o[r],d=s[o[r]-1]++<<A,m=d|(1<<A)-1;d<=m;++d)u[ir[d]>>>c]=l}else for(u=new qe(n),r=0;r<n;++r)o[r]&&(u[r]=ir[s[o[r]-1]++]>>>15-o[r]);return u}),St=new Se(288);for(var le=0;le<144;++le)St[le]=8;for(var le=144;le<256;++le)St[le]=9;for(var le=256;le<280;++le)St[le]=7;for(var le=280;le<288;++le)St[le]=8;var ln=new Se(32);for(var le=0;le<32;++le)ln[le]=5;var pa=Tt(St,9,1),ga=Tt(ln,5,1),Zt=function(o){for(var e=o[0],t=1;t<o.length;++t)o[t]>e&&(e=o[t]);return e},_e=function(o,e,t){var n=e/8|0;return(o[n]|o[n+1]<<8)>>(e&7)&t},Yt=function(o,e){var t=e/8|0;return(o[t]|o[t+1]<<8|o[t+2]<<16)>>(e&7)},Ca=function(o){return(o/8|0)+(o&7&&1)},va=function(o,e,t){(t==null||t>o.length)&&(t=o.length);var n=new(o instanceof qe?qe:o instanceof ar?ar:Se)(t-e);return n.set(o.subarray(e,t)),n},Ma=function(o,e,t){var n=o.length;if(!n||t&&!t.l&&n<5)return e||new Se(0);var r=!e||t,a=!t||t.i;t||(t={}),e||(e=new Se(n*3));var s=function(ne){var Je=e.length;if(ne>Je){var ke=new Se(Math.max(Je*2,ne));ke.set(e),e=ke}},u=t.f||0,c=t.p||0,l=t.b||0,A=t.l,d=t.d,m=t.m,B=t.n,p=n*8;do{if(!A){t.f=u=_e(o,c,1);var g=_e(o,c+1,3);if(c+=3,g)if(g==1)A=pa,d=ga,m=9,B=5;else if(g==2){var H=_e(o,c,31)+257,L=_e(o,c+10,15)+4,y=H+_e(o,c+5,31)+1;c+=14;for(var b=new Se(y),T=new Se(19),I=0;I<L;++I)T[da[I]]=_e(o,c+I*3,7);c+=L*3;for(var G=Zt(T),k=(1<<G)-1,j=Tt(T,G,1),I=0;I<y;){var X=j[_e(o,c,k)];c+=X&15;var v=X>>>4;if(v<16)b[I++]=v;else{var W=0,P=0;for(v==16?(P=3+_e(o,c,3),c+=2,W=b[I-1]):v==17?(P=3+_e(o,c,7),c+=3):v==18&&(P=11+_e(o,c,127),c+=7);P--;)b[I++]=W}}var $=b.subarray(0,H),Z=b.subarray(H);m=Zt($),B=Zt(Z),A=Tt($,m,1),d=Tt(Z,B,1)}else throw"invalid block type";else{var v=Ca(c)+4,x=o[v-4]|o[v-3]<<8,F=v+x;if(F>n){if(a)throw"unexpected EOF";break}r&&s(l+x),e.set(o.subarray(v,F),l),t.b=l+=x,t.p=c=F*8;continue}if(c>p){if(a)throw"unexpected EOF";break}}r&&s(l+131072);for(var Ce=(1<<m)-1,Re=(1<<B)-1,Ee=c;;Ee=c){var W=A[Yt(o,c)&Ce],re=W>>>4;if(c+=W&15,c>p){if(a)throw"unexpected EOF";break}if(!W)throw"invalid length/literal";if(re<256)e[l++]=re;else if(re==256){Ee=c,A=null;break}else{var ve=re-254;if(re>264){var I=re-257,ue=nn[I];ve=_e(o,c,(1<<ue)-1)+cn[I],c+=ue}var Be=d[Yt(o,c)&Re],Le=Be>>>4;if(!Be)throw"invalid distance";c+=Be&15;var Z=Ba[Le];if(Le>3){var ue=sn[Le];Z+=Yt(o,c)&(1<<ue)-1,c+=ue}if(c>p){if(a)throw"unexpected EOF";break}r&&s(l+131072);for(var dt=l+ve;l<dt;l+=4)e[l]=e[l-Z],e[l+1]=e[l+1-Z],e[l+2]=e[l+2-Z],e[l+3]=e[l+3-Z];l=dt}}t.l=A,t.p=Ee,t.b=l,A&&(u=1,t.m=m,t.d=d,t.n=B)}while(!u);return l==e.length?e:va(e,0,l)},Ea=new Se(0),Fa=function(o){if((o[0]&15)!=8||o[0]>>>4>7||(o[0]<<8|o[1])%31)throw"invalid zlib data";if(o[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Lt(o,e){return Ma((Fa(o),o.subarray(2,-4)),e)}var ba=typeof TextDecoder<"u"&&new TextDecoder,Ia=0;try{ba.decode(Ea,{stream:!0}),Ia=1}catch{}const xa=o=>o&&o.isCubeTexture;class Ra extends Gt{constructor(e,t){var n,r;const a=xa(e),u=((r=a?(n=e.image[0])==null?void 0:n.width:e.image.width)!=null?r:1024)/4,c=Math.floor(Math.log2(u)),l=Math.pow(2,c),A=3*Math.max(l,112),d=4*l,m=[a?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/A}`,`#define CUBEUV_TEXEL_HEIGHT ${1/d}`,`#define CUBEUV_MAX_MIP ${c}.0`],B=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,p=m.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${Ar>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,g={map:{value:e},height:{value:(t==null?void 0:t.height)||15},radius:{value:(t==null?void 0:t.radius)||100}},v=new ss(1,16),x=new ht({uniforms:g,fragmentShader:p,vertexShader:B,side:Qr});super(v,x)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}function kt(o){if(typeof TextDecoder<"u")return new TextDecoder().decode(o);let e="";for(let t=0,n=o.length;t<n;t++)e+=String.fromCharCode(o[t]);try{return decodeURIComponent(escape(e))}catch{return e}}const rt="srgb",Xe="srgb-linear",Ur=3001,Ta=3e3;class dr extends lr{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Sa(t)}),this.register(function(t){return new Ha(t)}),this.register(function(t){return new Ka(t)}),this.register(function(t){return new Qa(t)}),this.register(function(t){return new ja(t)}),this.register(function(t){return new La(t)}),this.register(function(t){return new Ua(t)}),this.register(function(t){return new Oa(t)}),this.register(function(t){return new Na(t)}),this.register(function(t){return new wa(t)}),this.register(function(t){return new Ja(t)}),this.register(function(t){return new _a(t)}),this.register(function(t){return new Pa(t)}),this.register(function(t){return new ka(t)}),this.register(function(t){return new ya(t)}),this.register(function(t){return new Xa(t)}),this.register(function(t){return new Za(t)})}load(e,t,n,r){const a=this;let s;if(this.resourcePath!=="")s=this.resourcePath;else if(this.path!==""){const l=Ft.extractUrlBase(e);s=Ft.resolveURL(l,this.path)}else s=Ft.extractUrlBase(e);this.manager.itemStart(e);const u=function(l){r?r(l):console.error(l),a.manager.itemError(e),a.manager.itemEnd(e)},c=new $e(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(l){try{a.parse(l,s,function(A){t(A),a.manager.itemEnd(e)},u)}catch(A){u(A)}},n,u)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let a;const s={},u={};if(typeof e=="string")a=JSON.parse(e);else if(e instanceof ArrayBuffer)if(kt(new Uint8Array(e.slice(0,4)))===un){try{s[V.KHR_BINARY_GLTF]=new Ya(e)}catch(A){r&&r(A);return}a=JSON.parse(s[V.KHR_BINARY_GLTF].content)}else a=JSON.parse(kt(new Uint8Array(e)));else a=e;if(a.asset===void 0||a.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new oi(a,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let l=0;l<this.pluginCallbacks.length;l++){const A=this.pluginCallbacks[l](c);A.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),u[A.name]=A,s[A.name]=!0}if(a.extensionsUsed)for(let l=0;l<a.extensionsUsed.length;++l){const A=a.extensionsUsed[l],d=a.extensionsRequired||[];switch(A){case V.KHR_MATERIALS_UNLIT:s[A]=new Ga;break;case V.KHR_DRACO_MESH_COMPRESSION:s[A]=new Wa(a,this.dracoLoader);break;case V.KHR_TEXTURE_TRANSFORM:s[A]=new za;break;case V.KHR_MESH_QUANTIZATION:s[A]=new Va;break;default:d.indexOf(A)>=0&&u[A]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+A+'".')}}c.setExtensions(s),c.setPlugins(u),c.parse(n,r)}parseAsync(e,t){const n=this;return new Promise(function(r,a){n.parse(e,t,r,a)})}}function Da(){let o={};return{get:function(e){return o[e]},add:function(e,t){o[e]=t},remove:function(e){delete o[e]},removeAll:function(){o={}}}}const V={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class ya{constructor(e){this.parser=e,this.name=V.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const a=t[n];a.extensions&&a.extensions[this.name]&&a.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,a.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;const a=t.json,c=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e];let l;const A=new Oe(16777215);c.color!==void 0&&A.setRGB(c.color[0],c.color[1],c.color[2],Xe);const d=c.range!==void 0?c.range:0;switch(c.type){case"directional":l=new os(A),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new is(A),l.distance=d;break;case"spot":l=new as(A),l.distance=d,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,l.angle=c.spot.outerConeAngle,l.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return l.position.set(0,0,0),l.decay=2,Ke(l,c),c.intensity!==void 0&&(l.intensity=c.intensity),l.name=t.createUniqueName(c.name||"light_"+e),r=Promise.resolve(l),t.cache.add(n,r),r}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,a=n.json.nodes[e],u=(a.extensions&&a.extensions[this.name]||{}).light;return u===void 0?null:this._loadLight(u).then(function(c){return n._getNodeRef(t.cache,u,c)})}}class Ga{constructor(){this.name=V.KHR_MATERIALS_UNLIT}getMaterialType(){return ot}extendParams(e,t,n){const r=[];e.color=new Oe(1,1,1),e.opacity=1;const a=t.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){const s=a.baseColorFactor;e.color.setRGB(s[0],s[1],s[2],Xe),e.opacity=s[3]}a.baseColorTexture!==void 0&&r.push(n.assignTexture(e,"map",a.baseColorTexture,rt))}return Promise.all(r)}}class wa{constructor(e){this.parser=e,this.name=V.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=r.extensions[this.name].emissiveStrength;return a!==void 0&&(t.emissiveIntensity=a),Promise.resolve()}}class Sa{constructor(e){this.parser=e,this.name=V.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ne}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[],s=r.extensions[this.name];if(s.clearcoatFactor!==void 0&&(t.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&a.push(n.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&a.push(n.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(a.push(n.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){const u=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new jr(u,u)}return Promise.all(a)}}class Ha{constructor(e){this.parser=e,this.name=V.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ne}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=r.extensions[this.name];return t.dispersion=a.dispersion!==void 0?a.dispersion:0,Promise.resolve()}}class _a{constructor(e){this.parser=e,this.name=V.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ne}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[],s=r.extensions[this.name];return s.iridescenceFactor!==void 0&&(t.iridescence=s.iridescenceFactor),s.iridescenceTexture!==void 0&&a.push(n.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),s.iridescenceIor!==void 0&&(t.iridescenceIOR=s.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),s.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),s.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),s.iridescenceThicknessTexture!==void 0&&a.push(n.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(a)}}class La{constructor(e){this.parser=e,this.name=V.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ne}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[];t.sheenColor=new Oe(0,0,0),t.sheenRoughness=0,t.sheen=1;const s=r.extensions[this.name];if(s.sheenColorFactor!==void 0){const u=s.sheenColorFactor;t.sheenColor.setRGB(u[0],u[1],u[2],Xe)}return s.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=s.sheenRoughnessFactor),s.sheenColorTexture!==void 0&&a.push(n.assignTexture(t,"sheenColorMap",s.sheenColorTexture,rt)),s.sheenRoughnessTexture!==void 0&&a.push(n.assignTexture(t,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(a)}}class Ua{constructor(e){this.parser=e,this.name=V.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ne}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[],s=r.extensions[this.name];return s.transmissionFactor!==void 0&&(t.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&a.push(n.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(a)}}class Oa{constructor(e){this.parser=e,this.name=V.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ne}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[],s=r.extensions[this.name];t.thickness=s.thicknessFactor!==void 0?s.thicknessFactor:0,s.thicknessTexture!==void 0&&a.push(n.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||1/0;const u=s.attenuationColor||[1,1,1];return t.attenuationColor=new Oe().setRGB(u[0],u[1],u[2],Xe),Promise.all(a)}}class Na{constructor(e){this.parser=e,this.name=V.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ne}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=r.extensions[this.name];return t.ior=a.ior!==void 0?a.ior:1.5,Promise.resolve()}}class Ja{constructor(e){this.parser=e,this.name=V.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ne}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[],s=r.extensions[this.name];t.specularIntensity=s.specularFactor!==void 0?s.specularFactor:1,s.specularTexture!==void 0&&a.push(n.assignTexture(t,"specularIntensityMap",s.specularTexture));const u=s.specularColorFactor||[1,1,1];return t.specularColor=new Oe().setRGB(u[0],u[1],u[2],Xe),s.specularColorTexture!==void 0&&a.push(n.assignTexture(t,"specularColorMap",s.specularColorTexture,rt)),Promise.all(a)}}class ka{constructor(e){this.parser=e,this.name=V.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ne}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[],s=r.extensions[this.name];return t.bumpScale=s.bumpFactor!==void 0?s.bumpFactor:1,s.bumpTexture!==void 0&&a.push(n.assignTexture(t,"bumpMap",s.bumpTexture)),Promise.all(a)}}class Pa{constructor(e){this.parser=e,this.name=V.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ne}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[],s=r.extensions[this.name];return s.anisotropyStrength!==void 0&&(t.anisotropy=s.anisotropyStrength),s.anisotropyRotation!==void 0&&(t.anisotropyRotation=s.anisotropyRotation),s.anisotropyTexture!==void 0&&a.push(n.assignTexture(t,"anisotropyMap",s.anisotropyTexture)),Promise.all(a)}}class Ka{constructor(e){this.parser=e,this.name=V.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const a=r.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,a.source,s)}}class Qa{constructor(e){this.parser=e,this.name=V.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,a=r.textures[e];if(!a.extensions||!a.extensions[t])return null;const s=a.extensions[t],u=r.images[s.source];let c=n.textureLoader;if(u.uri){const l=n.options.manager.getHandler(u.uri);l!==null&&(c=l)}return this.detectSupport().then(function(l){if(l)return n.loadTextureImage(e,s.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class ja{constructor(e){this.parser=e,this.name=V.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,a=r.textures[e];if(!a.extensions||!a.extensions[t])return null;const s=a.extensions[t],u=r.images[s.source];let c=n.textureLoader;if(u.uri){const l=n.options.manager.getHandler(u.uri);l!==null&&(c=l)}return this.detectSupport().then(function(l){if(l)return n.loadTextureImage(e,s.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Xa{constructor(e){this.name=V.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const r=n.extensions[this.name],a=this.parser.getDependency("buffer",r.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return a.then(function(u){const c=r.byteOffset||0,l=r.byteLength||0,A=r.count,d=r.byteStride,m=new Uint8Array(u,c,l);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(A,d,m,r.mode,r.filter).then(function(B){return B.buffer}):s.ready.then(function(){const B=new ArrayBuffer(A*d);return s.decodeGltfBuffer(new Uint8Array(B),A,d,m,r.mode,r.filter),B})})}else return null}}class Za{constructor(e){this.name=V.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const r=t.meshes[n.mesh];for(const l of r.primitives)if(l.mode!==we.TRIANGLES&&l.mode!==we.TRIANGLE_STRIP&&l.mode!==we.TRIANGLE_FAN&&l.mode!==void 0)return null;const s=n.extensions[this.name].attributes,u=[],c={};for(const l in s)u.push(this.parser.getDependency("accessor",s[l]).then(A=>(c[l]=A,c[l])));return u.length<1?null:(u.push(this.parser.createNodeMesh(e)),Promise.all(u).then(l=>{const A=l.pop(),d=A.isGroup?A.children:[A],m=l[0].count,B=[];for(const p of d){const g=new nt,v=new ee,x=new bt,F=new ee(1,1,1),H=new cs(p.geometry,p.material,m);for(let L=0;L<m;L++)c.TRANSLATION&&v.fromBufferAttribute(c.TRANSLATION,L),c.ROTATION&&x.fromBufferAttribute(c.ROTATION,L),c.SCALE&&F.fromBufferAttribute(c.SCALE,L),H.setMatrixAt(L,g.compose(v,x,F));for(const L in c)if(L==="_COLOR_0"){const y=c[L];H.instanceColor=new ls(y.array,y.itemSize,y.normalized)}else L!=="TRANSLATION"&&L!=="ROTATION"&&L!=="SCALE"&&p.geometry.setAttribute(L,c[L]);Xr.prototype.copy.call(H,p),this.parser.assignFinalMaterial(H),B.push(H)}return A.isGroup?(A.clear(),A.add(...B),A):B[0]}))}}const un="glTF",Ct=12,Or={JSON:1313821514,BIN:5130562};class Ya{constructor(e){this.name=V.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Ct);if(this.header={magic:kt(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==un)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-Ct,r=new DataView(e,Ct);let a=0;for(;a<n;){const s=r.getUint32(a,!0);a+=4;const u=r.getUint32(a,!0);if(a+=4,u===Or.JSON){const c=new Uint8Array(e,Ct+a,s);this.content=kt(c)}else if(u===Or.BIN){const c=Ct+a;this.body=e.slice(c,c+s)}a+=s}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Wa{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=V.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,a=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,u={},c={},l={};for(const A in s){const d=or[A]||A.toLowerCase();u[d]=s[A]}for(const A in e.attributes){const d=or[A]||A.toLowerCase();if(s[A]!==void 0){const m=n.accessors[e.attributes[A]],B=lt[m.componentType];l[d]=B.name,c[d]=m.normalized===!0}}return t.getDependency("bufferView",a).then(function(A){return new Promise(function(d,m){r.decodeDracoFile(A,function(B){for(const p in B.attributes){const g=B.attributes[p],v=c[p];v!==void 0&&(g.normalized=v)}d(B)},u,l,Xe,m)})})}}class za{constructor(){this.name=V.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Va{constructor(){this.name=V.KHR_MESH_QUANTIZATION}}class hn extends ws{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,a=e*r*3+r;for(let s=0;s!==r;s++)t[s]=n[a+s];return t}interpolate_(e,t,n,r){const a=this.resultBuffer,s=this.sampleValues,u=this.valueSize,c=u*2,l=u*3,A=r-t,d=(n-t)/A,m=d*d,B=m*d,p=e*l,g=p-l,v=-2*B+3*m,x=B-m,F=1-v,H=x-m+d;for(let L=0;L!==u;L++){const y=s[g+L+u],b=s[g+L+c]*A,T=s[p+L+u],I=s[p+L]*A;a[L]=F*y+H*b+v*T+x*I}return a}}const qa=new bt;class $a extends hn{interpolate_(e,t,n,r){const a=super.interpolate_(e,t,n,r);return qa.fromArray(a).normalize().toArray(a),a}}const we={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},lt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Nr={9728:tr,9729:He,9984:fs,9985:ms,9986:ds,9987:Zr},Jr={33071:Qe,33648:Bs,10497:rr},Wt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},or={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...Ar>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},We={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ei={CUBICSPLINE:void 0,LINEAR:Vr,STEP:Ds},zt={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function ti(o){return o.DefaultMaterial===void 0&&(o.DefaultMaterial=new Yr({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Gs})),o.DefaultMaterial}function tt(o,e,t){for(const n in t.extensions)o[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function Ke(o,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(o.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function ri(o,e,t){let n=!1,r=!1,a=!1;for(let l=0,A=e.length;l<A;l++){const d=e[l];if(d.POSITION!==void 0&&(n=!0),d.NORMAL!==void 0&&(r=!0),d.COLOR_0!==void 0&&(a=!0),n&&r&&a)break}if(!n&&!r&&!a)return Promise.resolve(o);const s=[],u=[],c=[];for(let l=0,A=e.length;l<A;l++){const d=e[l];if(n){const m=d.POSITION!==void 0?t.getDependency("accessor",d.POSITION):o.attributes.position;s.push(m)}if(r){const m=d.NORMAL!==void 0?t.getDependency("accessor",d.NORMAL):o.attributes.normal;u.push(m)}if(a){const m=d.COLOR_0!==void 0?t.getDependency("accessor",d.COLOR_0):o.attributes.color;c.push(m)}}return Promise.all([Promise.all(s),Promise.all(u),Promise.all(c)]).then(function(l){const A=l[0],d=l[1],m=l[2];return n&&(o.morphAttributes.position=A),r&&(o.morphAttributes.normal=d),a&&(o.morphAttributes.color=m),o.morphTargetsRelative=!0,o})}function ni(o,e){if(o.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)o.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(o.morphTargetInfluences.length===t.length){o.morphTargetDictionary={};for(let n=0,r=t.length;n<r;n++)o.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function si(o){let e;const t=o.extensions&&o.extensions[V.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+Vt(t.attributes):e=o.indices+":"+Vt(o.attributes)+":"+o.mode,o.targets!==void 0)for(let n=0,r=o.targets.length;n<r;n++)e+=":"+Vt(o.targets[n]);return e}function Vt(o){let e="";const t=Object.keys(o).sort();for(let n=0,r=t.length;n<r;n++)e+=t[n]+":"+o[t[n]]+";";return e}function cr(o){switch(o){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function ai(o){return o.search(/\.jpe?g($|\?)/i)>0||o.search(/^data\:image\/jpeg/)===0?"image/jpeg":o.search(/\.webp($|\?)/i)>0||o.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const ii=new nt;class oi{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Da,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,r=!1,a=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,a=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||r&&a<98?this.textureLoader=new us(this.options.manager):this.textureLoader=new hs(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new $e(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,a=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(s){const u={scene:s[0][r.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:r.asset,parser:n,userData:{}};return tt(a,u,r),Ke(u,r),Promise.all(n._invokeAll(function(c){return c.afterRoot&&c.afterRoot(u)})).then(function(){for(const c of u.scenes)c.updateMatrixWorld();e(u)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let r=0,a=t.length;r<a;r++){const s=t[r].joints;for(let u=0,c=s.length;u<c;u++)e[s[u]].isBone=!0}for(let r=0,a=e.length;r<a;r++){const s=e[r];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(n[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone(),a=(s,u)=>{const c=this.associations.get(s);c!=null&&this.associations.set(u,c);for(const[l,A]of s.children.entries())a(A,u.children[l])};return a(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const a=e(t[r]);a&&n.push(a)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(a){return a.loadNode&&a.loadNode(t)});break;case"mesh":r=this._invokeOne(function(a){return a.loadMesh&&a.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(a){return a.loadBufferView&&a.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(a){return a.loadMaterial&&a.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(a){return a.loadTexture&&a.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(a){return a.loadAnimation&&a.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(a){return a!=this&&a.getDependency&&a.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(a,s){return n.getDependency(e,s)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[V.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(a,s){n.load(Ft.resolveURL(t.uri,r.path),a,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const r=t.byteLength||0,a=t.byteOffset||0;return n.slice(a,a+r)})}loadAccessor(e){const t=this,n=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const s=Wt[r.type],u=lt[r.componentType],c=r.normalized===!0,l=new u(r.count*s);return Promise.resolve(new It(l,s,c))}const a=[];return r.bufferView!==void 0?a.push(this.getDependency("bufferView",r.bufferView)):a.push(null),r.sparse!==void 0&&(a.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(a).then(function(s){const u=s[0],c=Wt[r.type],l=lt[r.componentType],A=l.BYTES_PER_ELEMENT,d=A*c,m=r.byteOffset||0,B=r.bufferView!==void 0?n.bufferViews[r.bufferView].byteStride:void 0,p=r.normalized===!0;let g,v;if(B&&B!==d){const x=Math.floor(m/B),F="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+x+":"+r.count;let H=t.cache.get(F);H||(g=new l(u,x*B,r.count*B/A),H=new As(g,B/A),t.cache.add(F,H)),v=new ys(H,c,m%B/A,p)}else u===null?g=new l(r.count*c):g=new l(u,m,r.count*c),v=new It(g,c,p);if(r.sparse!==void 0){const x=Wt.SCALAR,F=lt[r.sparse.indices.componentType],H=r.sparse.indices.byteOffset||0,L=r.sparse.values.byteOffset||0,y=new F(s[1],H,r.sparse.count*x),b=new l(s[2],L,r.sparse.count*c);u!==null&&(v=new It(v.array.slice(),v.itemSize,v.normalized));for(let T=0,I=y.length;T<I;T++){const G=y[T];if(v.setX(G,b[T*c]),c>=2&&v.setY(G,b[T*c+1]),c>=3&&v.setZ(G,b[T*c+2]),c>=4&&v.setW(G,b[T*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return v})}loadTexture(e){const t=this.json,n=this.options,a=t.textures[e].source,s=t.images[a];let u=this.textureLoader;if(s.uri){const c=n.manager.getHandler(s.uri);c!==null&&(u=c)}return this.loadTextureImage(e,a,u)}loadTextureImage(e,t,n){const r=this,a=this.json,s=a.textures[e],u=a.images[t],c=(u.uri||u.bufferView)+":"+s.sampler;if(this.textureCache[c])return this.textureCache[c];const l=this.loadImageSource(t,n).then(function(A){A.flipY=!1,A.name=s.name||u.name||"",A.name===""&&typeof u.uri=="string"&&u.uri.startsWith("data:image/")===!1&&(A.name=u.uri);const m=(a.samplers||{})[s.sampler]||{};return A.magFilter=Nr[m.magFilter]||He,A.minFilter=Nr[m.minFilter]||Zr,A.wrapS=Jr[m.wrapS]||rr,A.wrapT=Jr[m.wrapT]||rr,r.associations.set(A,{textures:e}),A}).catch(function(){return null});return this.textureCache[c]=l,l}loadImageSource(e,t){const n=this,r=this.json,a=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const s=r.images[e],u=self.URL||self.webkitURL;let c=s.uri||"",l=!1;if(s.bufferView!==void 0)c=n.getDependency("bufferView",s.bufferView).then(function(d){l=!0;const m=new Blob([d],{type:s.mimeType});return c=u.createObjectURL(m),c});else if(s.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const A=Promise.resolve(c).then(function(d){return new Promise(function(m,B){let p=m;t.isImageBitmapLoader===!0&&(p=function(g){const v=new ze(g);v.needsUpdate=!0,m(v)}),t.load(Ft.resolveURL(d,a.path),p,void 0,B)})}).then(function(d){return l===!0&&u.revokeObjectURL(c),Ke(d,s),d.userData.mimeType=s.mimeType||ai(s.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),d});return this.sourceCache[e]=A,A}assignTexture(e,t,n,r){const a=this;return this.getDependency("texture",n.index).then(function(s){if(!s)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(s=s.clone(),s.channel=n.texCoord),a.extensions[V.KHR_TEXTURE_TRANSFORM]){const u=n.extensions!==void 0?n.extensions[V.KHR_TEXTURE_TRANSFORM]:void 0;if(u){const c=a.associations.get(s);s=a.extensions[V.KHR_TEXTURE_TRANSFORM].extendTexture(s,u),a.associations.set(s,c)}}return r!==void 0&&(typeof r=="number"&&(r=r===Ur?rt:Xe),"colorSpace"in s?s.colorSpace=r:s.encoding=r===rt?Ur:Ta),e[t]=s,s})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const r=t.attributes.tangent===void 0,a=t.attributes.color!==void 0,s=t.attributes.normal===void 0;if(e.isPoints){const u="PointsMaterial:"+n.uuid;let c=this.cache.get(u);c||(c=new ps,jt.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,c.sizeAttenuation=!1,this.cache.add(u,c)),n=c}else if(e.isLine){const u="LineBasicMaterial:"+n.uuid;let c=this.cache.get(u);c||(c=new gs,jt.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,this.cache.add(u,c)),n=c}if(r||a||s){let u="ClonedMaterial:"+n.uuid+":";r&&(u+="derivative-tangents:"),a&&(u+="vertex-colors:"),s&&(u+="flat-shading:");let c=this.cache.get(u);c||(c=n.clone(),a&&(c.vertexColors=!0),s&&(c.flatShading=!0),r&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(u,c),this.associations.set(c,this.associations.get(n))),n=c}e.material=n}getMaterialType(){return Yr}loadMaterial(e){const t=this,n=this.json,r=this.extensions,a=n.materials[e];let s;const u={},c=a.extensions||{},l=[];if(c[V.KHR_MATERIALS_UNLIT]){const d=r[V.KHR_MATERIALS_UNLIT];s=d.getMaterialType(),l.push(d.extendParams(u,a,t))}else{const d=a.pbrMetallicRoughness||{};if(u.color=new Oe(1,1,1),u.opacity=1,Array.isArray(d.baseColorFactor)){const m=d.baseColorFactor;u.color.setRGB(m[0],m[1],m[2],Xe),u.opacity=m[3]}d.baseColorTexture!==void 0&&l.push(t.assignTexture(u,"map",d.baseColorTexture,rt)),u.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,u.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(u,"metalnessMap",d.metallicRoughnessTexture)),l.push(t.assignTexture(u,"roughnessMap",d.metallicRoughnessTexture))),s=this._invokeOne(function(m){return m.getMaterialType&&m.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(m){return m.extendMaterialParams&&m.extendMaterialParams(e,u)})))}a.doubleSided===!0&&(u.side=Qr);const A=a.alphaMode||zt.OPAQUE;if(A===zt.BLEND?(u.transparent=!0,u.depthWrite=!1):(u.transparent=!1,A===zt.MASK&&(u.alphaTest=a.alphaCutoff!==void 0?a.alphaCutoff:.5)),a.normalTexture!==void 0&&s!==ot&&(l.push(t.assignTexture(u,"normalMap",a.normalTexture)),u.normalScale=new jr(1,1),a.normalTexture.scale!==void 0)){const d=a.normalTexture.scale;u.normalScale.set(d,d)}if(a.occlusionTexture!==void 0&&s!==ot&&(l.push(t.assignTexture(u,"aoMap",a.occlusionTexture)),a.occlusionTexture.strength!==void 0&&(u.aoMapIntensity=a.occlusionTexture.strength)),a.emissiveFactor!==void 0&&s!==ot){const d=a.emissiveFactor;u.emissive=new Oe().setRGB(d[0],d[1],d[2],Xe)}return a.emissiveTexture!==void 0&&s!==ot&&l.push(t.assignTexture(u,"emissiveMap",a.emissiveTexture,rt)),Promise.all(l).then(function(){const d=new s(u);return a.name&&(d.name=a.name),Ke(d,a),t.associations.set(d,{materials:e}),a.extensions&&tt(r,d,a),d})}createUniqueName(e){const t=Cs.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,r=this.primitiveCache;function a(u){return n[V.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(u,t).then(function(c){return kr(c,u,t)})}const s=[];for(let u=0,c=e.length;u<c;u++){const l=e[u],A=si(l),d=r[A];if(d)s.push(d.promise);else{let m;l.extensions&&l.extensions[V.KHR_DRACO_MESH_COMPRESSION]?m=a(l):m=kr(new Wr,l,t),r[A]={primitive:l,promise:m},s.push(m)}}return Promise.all(s)}loadMesh(e){const t=this,n=this.json,r=this.extensions,a=n.meshes[e],s=a.primitives,u=[];for(let c=0,l=s.length;c<l;c++){const A=s[c].material===void 0?ti(this.cache):this.getDependency("material",s[c].material);u.push(A)}return u.push(t.loadGeometries(s)),Promise.all(u).then(function(c){const l=c.slice(0,c.length-1),A=c[c.length-1],d=[];for(let B=0,p=A.length;B<p;B++){const g=A[B],v=s[B];let x;const F=l[B];if(v.mode===we.TRIANGLES||v.mode===we.TRIANGLE_STRIP||v.mode===we.TRIANGLE_FAN||v.mode===void 0)x=a.isSkinnedMesh===!0?new vs(g,F):new Gt(g,F),x.isSkinnedMesh===!0&&x.normalizeSkinWeights(),v.mode===we.TRIANGLE_STRIP?x.geometry=Lr(x.geometry,Kr):v.mode===we.TRIANGLE_FAN&&(x.geometry=Lr(x.geometry,er));else if(v.mode===we.LINES)x=new Ms(g,F);else if(v.mode===we.LINE_STRIP)x=new Es(g,F);else if(v.mode===we.LINE_LOOP)x=new Fs(g,F);else if(v.mode===we.POINTS)x=new bs(g,F);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);Object.keys(x.geometry.morphAttributes).length>0&&ni(x,a),x.name=t.createUniqueName(a.name||"mesh_"+e),Ke(x,a),v.extensions&&tt(r,x,v),t.assignFinalMaterial(x),d.push(x)}for(let B=0,p=d.length;B<p;B++)t.associations.set(d[B],{meshes:e,primitives:B});if(d.length===1)return a.extensions&&tt(r,d[0],a),d[0];const m=new Xt;a.extensions&&tt(r,m,a),t.associations.set(m,{meshes:e});for(let B=0,p=d.length;B<p;B++)m.add(d[B]);return m})}loadCamera(e){let t;const n=this.json.cameras[e],r=n[n.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new Is(xt.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):n.type==="orthographic"&&(t=new zr(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Ke(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let r=0,a=t.joints.length;r<a;r++)n.push(this._loadNodeShallow(t.joints[r]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(r){const a=r.pop(),s=r,u=[],c=[];for(let l=0,A=s.length;l<A;l++){const d=s[l];if(d){u.push(d);const m=new nt;a!==null&&m.fromArray(a.array,l*16),c.push(m)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[l])}return new xs(u,c)})}loadAnimation(e){const t=this.json,n=this,r=t.animations[e],a=r.name?r.name:"animation_"+e,s=[],u=[],c=[],l=[],A=[];for(let d=0,m=r.channels.length;d<m;d++){const B=r.channels[d],p=r.samplers[B.sampler],g=B.target,v=g.node,x=r.parameters!==void 0?r.parameters[p.input]:p.input,F=r.parameters!==void 0?r.parameters[p.output]:p.output;g.node!==void 0&&(s.push(this.getDependency("node",v)),u.push(this.getDependency("accessor",x)),c.push(this.getDependency("accessor",F)),l.push(p),A.push(g))}return Promise.all([Promise.all(s),Promise.all(u),Promise.all(c),Promise.all(l),Promise.all(A)]).then(function(d){const m=d[0],B=d[1],p=d[2],g=d[3],v=d[4],x=[];for(let F=0,H=m.length;F<H;F++){const L=m[F],y=B[F],b=p[F],T=g[F],I=v[F];if(L===void 0)continue;L.updateMatrix&&L.updateMatrix();const G=n._createAnimationTracks(L,y,b,T,I);if(G)for(let k=0;k<G.length;k++)x.push(G[k])}return new Rs(a,void 0,x)})}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return r.mesh===void 0?null:n.getDependency("mesh",r.mesh).then(function(a){const s=n._getNodeRef(n.meshCache,r.mesh,a);return r.weights!==void 0&&s.traverse(function(u){if(u.isMesh)for(let c=0,l=r.weights.length;c<l;c++)u.morphTargetInfluences[c]=r.weights[c]}),s})}loadNode(e){const t=this.json,n=this,r=t.nodes[e],a=n._loadNodeShallow(e),s=[],u=r.children||[];for(let l=0,A=u.length;l<A;l++)s.push(n.getDependency("node",u[l]));const c=r.skin===void 0?Promise.resolve(null):n.getDependency("skin",r.skin);return Promise.all([a,Promise.all(s),c]).then(function(l){const A=l[0],d=l[1],m=l[2];m!==null&&A.traverse(function(B){B.isSkinnedMesh&&B.bind(m,ii)});for(let B=0,p=d.length;B<p;B++)A.add(d[B]);return A})}_loadNodeShallow(e){const t=this.json,n=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const a=t.nodes[e],s=a.name?r.createUniqueName(a.name):"",u=[],c=r._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return c&&u.push(c),a.camera!==void 0&&u.push(r.getDependency("camera",a.camera).then(function(l){return r._getNodeRef(r.cameraCache,a.camera,l)})),r._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){u.push(l)}),this.nodeCache[e]=Promise.all(u).then(function(l){let A;if(a.isBone===!0?A=new Ts:l.length>1?A=new Xt:l.length===1?A=l[0]:A=new Xr,A!==l[0])for(let d=0,m=l.length;d<m;d++)A.add(l[d]);if(a.name&&(A.userData.name=a.name,A.name=s),Ke(A,a),a.extensions&&tt(n,A,a),a.matrix!==void 0){const d=new nt;d.fromArray(a.matrix),A.applyMatrix4(d)}else a.translation!==void 0&&A.position.fromArray(a.translation),a.rotation!==void 0&&A.quaternion.fromArray(a.rotation),a.scale!==void 0&&A.scale.fromArray(a.scale);return r.associations.has(A)||r.associations.set(A,{}),r.associations.get(A).nodes=e,A}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],r=this,a=new Xt;n.name&&(a.name=r.createUniqueName(n.name)),Ke(a,n),n.extensions&&tt(t,a,n);const s=n.nodes||[],u=[];for(let c=0,l=s.length;c<l;c++)u.push(r.getDependency("node",s[c]));return Promise.all(u).then(function(c){for(let A=0,d=c.length;A<d;A++)a.add(c[A]);const l=A=>{const d=new Map;for(const[m,B]of r.associations)(m instanceof jt||m instanceof ze)&&d.set(m,B);return A.traverse(m=>{const B=r.associations.get(m);B!=null&&d.set(m,B)}),d};return r.associations=l(a),a})}_createAnimationTracks(e,t,n,r,a){const s=[],u=e.name?e.name:e.uuid,c=[];We[a.path]===We.weights?e.traverse(function(m){m.morphTargetInfluences&&c.push(m.name?m.name:m.uuid)}):c.push(u);let l;switch(We[a.path]){case We.weights:l=Gr;break;case We.rotation:l=wr;break;case We.position:case We.scale:l=yr;break;default:switch(n.itemSize){case 1:l=Gr;break;case 2:case 3:default:l=yr;break}break}const A=r.interpolation!==void 0?ei[r.interpolation]:Vr,d=this._getArrayFromAccessor(n);for(let m=0,B=c.length;m<B;m++){const p=new l(c[m]+"."+We[a.path],t.array,d,A);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(p),s.push(p)}return s}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const n=cr(t.constructor),r=new Float32Array(t.length);for(let a=0,s=t.length;a<s;a++)r[a]=t[a]*n;t=r}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const r=this instanceof wr?$a:hn;return new r(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function ci(o,e,t){const n=e.attributes,r=new ur;if(n.POSITION!==void 0){const u=t.json.accessors[n.POSITION],c=u.min,l=u.max;if(c!==void 0&&l!==void 0){if(r.set(new ee(c[0],c[1],c[2]),new ee(l[0],l[1],l[2])),u.normalized){const A=cr(lt[u.componentType]);r.min.multiplyScalar(A),r.max.multiplyScalar(A)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const a=e.targets;if(a!==void 0){const u=new ee,c=new ee;for(let l=0,A=a.length;l<A;l++){const d=a[l];if(d.POSITION!==void 0){const m=t.json.accessors[d.POSITION],B=m.min,p=m.max;if(B!==void 0&&p!==void 0){if(c.setX(Math.max(Math.abs(B[0]),Math.abs(p[0]))),c.setY(Math.max(Math.abs(B[1]),Math.abs(p[1]))),c.setZ(Math.max(Math.abs(B[2]),Math.abs(p[2]))),m.normalized){const g=cr(lt[m.componentType]);c.multiplyScalar(g)}u.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(u)}o.boundingBox=r;const s=new qr;r.getCenter(s.center),s.radius=r.min.distanceTo(r.max)/2,o.boundingSphere=s}function kr(o,e,t){const n=e.attributes,r=[];function a(s,u){return t.getDependency("accessor",s).then(function(c){o.setAttribute(u,c)})}for(const s in n){const u=or[s]||s.toLowerCase();u in o.attributes||r.push(a(n[s],u))}if(e.indices!==void 0&&!o.index){const s=t.getDependency("accessor",e.indices).then(function(u){o.setIndex(u)});r.push(s)}return Ke(o,e),ci(o,e,t),Promise.all(r).then(function(){return e.targets!==void 0?ri(o,e.targets,t):o})}const li={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},ui={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `};class hi extends $r{constructor(e){super(e),this.type=Ie}parse(e){const s=function(I,G){switch(I){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(G||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(G||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(G||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(G||""))}},d=function(I,G,k){G=G||1024;let X=I.pos,W=-1,P=0,$="",Z=String.fromCharCode.apply(null,new Uint16Array(I.subarray(X,X+128)));for(;0>(W=Z.indexOf(`
`))&&P<G&&X<I.byteLength;)$+=Z,P+=Z.length,X+=128,Z+=String.fromCharCode.apply(null,new Uint16Array(I.subarray(X,X+128)));return-1<W?(I.pos+=P+W+1,$+Z.slice(0,W)):!1},m=function(I){const G=/^#\?(\S+)/,k=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,j=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,X=/^\s*FORMAT=(\S+)\s*$/,W=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,P={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let $,Z;for((I.pos>=I.byteLength||!($=d(I)))&&s(1,"no header found"),(Z=$.match(G))||s(3,"bad initial token"),P.valid|=1,P.programtype=Z[1],P.string+=$+`
`;$=d(I),$!==!1;){if(P.string+=$+`
`,$.charAt(0)==="#"){P.comments+=$+`
`;continue}if((Z=$.match(k))&&(P.gamma=parseFloat(Z[1])),(Z=$.match(j))&&(P.exposure=parseFloat(Z[1])),(Z=$.match(X))&&(P.valid|=2,P.format=Z[1]),(Z=$.match(W))&&(P.valid|=4,P.height=parseInt(Z[1],10),P.width=parseInt(Z[2],10)),P.valid&2&&P.valid&4)break}return P.valid&2||s(3,"missing format specifier"),P.valid&4||s(3,"missing image size specifier"),P},B=function(I,G,k){const j=G;if(j<8||j>32767||I[0]!==2||I[1]!==2||I[2]&128)return new Uint8Array(I);j!==(I[2]<<8|I[3])&&s(3,"wrong scanline width");const X=new Uint8Array(4*G*k);X.length||s(4,"unable to allocate buffer space");let W=0,P=0;const $=4*j,Z=new Uint8Array(4),Ce=new Uint8Array($);let Re=k;for(;Re>0&&P<I.byteLength;){P+4>I.byteLength&&s(1),Z[0]=I[P++],Z[1]=I[P++],Z[2]=I[P++],Z[3]=I[P++],(Z[0]!=2||Z[1]!=2||(Z[2]<<8|Z[3])!=j)&&s(3,"bad rgbe scanline format");let Ee=0,re;for(;Ee<$&&P<I.byteLength;){re=I[P++];const ue=re>128;if(ue&&(re-=128),(re===0||Ee+re>$)&&s(3,"bad scanline data"),ue){const Be=I[P++];for(let Le=0;Le<re;Le++)Ce[Ee++]=Be}else Ce.set(I.subarray(P,P+re),Ee),Ee+=re,P+=re}const ve=j;for(let ue=0;ue<ve;ue++){let Be=0;X[W]=Ce[ue+Be],Be+=j,X[W+1]=Ce[ue+Be],Be+=j,X[W+2]=Ce[ue+Be],Be+=j,X[W+3]=Ce[ue+Be],W+=4}Re--}return X},p=function(I,G,k,j){const X=I[G+3],W=Math.pow(2,X-128)/255;k[j+0]=I[G+0]*W,k[j+1]=I[G+1]*W,k[j+2]=I[G+2]*W,k[j+3]=1},g=function(I,G,k,j){const X=I[G+3],W=Math.pow(2,X-128)/255;k[j+0]=ct.toHalfFloat(Math.min(I[G+0]*W,65504)),k[j+1]=ct.toHalfFloat(Math.min(I[G+1]*W,65504)),k[j+2]=ct.toHalfFloat(Math.min(I[G+2]*W,65504)),k[j+3]=ct.toHalfFloat(1)},v=new Uint8Array(e);v.pos=0;const x=m(v),F=x.width,H=x.height,L=B(v.subarray(v.pos),F,H);let y,b,T;switch(this.type){case je:T=L.length/4;const I=new Float32Array(T*4);for(let k=0;k<T;k++)p(L,k*4,I,k*4);y=I,b=je;break;case Ie:T=L.length/4;const G=new Uint16Array(T*4);for(let k=0;k<T;k++)g(L,k*4,G,k*4);y=G,b=Ie;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:F,height:H,data:y,header:x.string,gamma:x.gamma,exposure:x.exposure,type:b}}setDataType(e){return this.type=e,this}load(e,t,n,r){function a(s,u){switch(s.type){case je:case Ie:"colorSpace"in s?s.colorSpace="srgb-linear":s.encoding=3e3,s.minFilter=He,s.magFilter=He,s.generateMipmaps=!1,s.flipY=!0;break}t&&t(s,u)}return super.load(e,a,n,r)}}const vt=Ar>=152;class Ai extends $r{constructor(e){super(e),this.type=Ie}parse(e){const G=Math.pow(2.7182818,2.2);function k(i,h){for(var f=0,C=0;C<65536;++C)(C==0||i[C>>3]&1<<(C&7))&&(h[f++]=C);for(var M=f-1;f<65536;)h[f++]=0;return M}function j(i){for(var h=0;h<16384;h++)i[h]={},i[h].len=0,i[h].lit=0,i[h].p=null}const X={l:0,c:0,lc:0};function W(i,h,f,C,M){for(;f<i;)h=h<<8|Rr(C,M),f+=8;f-=i,X.l=h>>f&(1<<i)-1,X.c=h,X.lc=f}const P=new Array(59);function $(i){for(var h=0;h<=58;++h)P[h]=0;for(var h=0;h<65537;++h)P[i[h]]+=1;for(var f=0,h=58;h>0;--h){var C=f+P[h]>>1;P[h]=f,f=C}for(var h=0;h<65537;++h){var M=i[h];M>0&&(i[h]=M|P[M]++<<6)}}function Z(i,h,f,C,M,E,S){for(var w=f,O=0,U=0;M<=E;M++){if(w.value-f.value>C)return!1;W(6,O,U,i,w);var N=X.l;if(O=X.c,U=X.lc,S[M]=N,N==63){if(w.value-f.value>C)throw"Something wrong with hufUnpackEncTable";W(8,O,U,i,w);var _=X.l+6;if(O=X.c,U=X.lc,M+_>E+1)throw"Something wrong with hufUnpackEncTable";for(;_--;)S[M++]=0;M--}else if(N>=59){var _=N-59+2;if(M+_>E+1)throw"Something wrong with hufUnpackEncTable";for(;_--;)S[M++]=0;M--}}$(S)}function Ce(i){return i&63}function Re(i){return i>>6}function Ee(i,h,f,C){for(;h<=f;h++){var M=Re(i[h]),E=Ce(i[h]);if(M>>E)throw"Invalid table entry";if(E>14){var S=C[M>>E-14];if(S.len)throw"Invalid table entry";if(S.lit++,S.p){var w=S.p;S.p=new Array(S.lit);for(var O=0;O<S.lit-1;++O)S.p[O]=w[O]}else S.p=new Array(1);S.p[S.lit-1]=h}else if(E)for(var U=0,O=1<<14-E;O>0;O--){var S=C[(M<<14-E)+U];if(S.len||S.p)throw"Invalid table entry";S.len=E,S.lit=h,U++}}return!0}const re={c:0,lc:0};function ve(i,h,f,C){i=i<<8|Rr(f,C),h+=8,re.c=i,re.lc=h}const ue={c:0,lc:0};function Be(i,h,f,C,M,E,S,w,O,U){if(i==h){C<8&&(ve(f,C,M,S),f=re.c,C=re.lc),C-=8;var N=f>>C,N=new Uint8Array([N])[0];if(O.value+N>U)return!1;for(var _=w[O.value-1];N-- >0;)w[O.value++]=_}else if(O.value<U)w[O.value++]=i;else return!1;ue.c=f,ue.lc=C}function Le(i){return i&65535}function dt(i){var h=Le(i);return h>32767?h-65536:h}const ne={a:0,b:0};function Je(i,h){var f=dt(i),C=dt(h),M=C,E=f+(M&1)+(M>>1),S=E,w=E-M;ne.a=S,ne.b=w}function ke(i,h){var f=Le(i),C=Le(h),M=f-(C>>1)&65535,E=C+M-32768&65535;ne.a=E,ne.b=M}function Fn(i,h,f,C,M,E,S){for(var w=S<16384,O=f>M?M:f,U=1,N;U<=O;)U<<=1;for(U>>=1,N=U,U>>=1;U>=1;){for(var _=0,Ae=_+E*(M-N),K=E*U,Q=E*N,Y=C*U,z=C*N,se,ie,me,Me;_<=Ae;_+=Q){for(var oe=_,Ue=_+C*(f-N);oe<=Ue;oe+=z){var ce=oe+Y,fe=oe+K,Pe=fe+Y;w?(Je(i[oe+h],i[fe+h]),se=ne.a,me=ne.b,Je(i[ce+h],i[Pe+h]),ie=ne.a,Me=ne.b,Je(se,ie),i[oe+h]=ne.a,i[ce+h]=ne.b,Je(me,Me),i[fe+h]=ne.a,i[Pe+h]=ne.b):(ke(i[oe+h],i[fe+h]),se=ne.a,me=ne.b,ke(i[ce+h],i[Pe+h]),ie=ne.a,Me=ne.b,ke(se,ie),i[oe+h]=ne.a,i[ce+h]=ne.b,ke(me,Me),i[fe+h]=ne.a,i[Pe+h]=ne.b)}if(f&U){var fe=oe+K;w?Je(i[oe+h],i[fe+h]):ke(i[oe+h],i[fe+h]),se=ne.a,i[fe+h]=ne.b,i[oe+h]=se}}if(M&U)for(var oe=_,Ue=_+C*(f-N);oe<=Ue;oe+=z){var ce=oe+Y;w?Je(i[oe+h],i[ce+h]):ke(i[oe+h],i[ce+h]),se=ne.a,i[ce+h]=ne.b,i[oe+h]=se}N=U,U>>=1}return _}function bn(i,h,f,C,M,E,S,w,O,U){for(var N=0,_=0,Ae=w,K=Math.trunc(M.value+(E+7)/8);M.value<K;)for(ve(N,_,f,M),N=re.c,_=re.lc;_>=14;){var Q=N>>_-14&16383,Y=h[Q];if(Y.len)_-=Y.len,Be(Y.lit,S,N,_,f,C,M,O,U,Ae),N=ue.c,_=ue.lc;else{if(!Y.p)throw"hufDecode issues";var z;for(z=0;z<Y.lit;z++){for(var se=Ce(i[Y.p[z]]);_<se&&M.value<K;)ve(N,_,f,M),N=re.c,_=re.lc;if(_>=se&&Re(i[Y.p[z]])==(N>>_-se&(1<<se)-1)){_-=se,Be(Y.p[z],S,N,_,f,C,M,O,U,Ae),N=ue.c,_=ue.lc;break}}if(z==Y.lit)throw"hufDecode issues"}}var ie=8-E&7;for(N>>=ie,_-=ie;_>0;){var Y=h[N<<14-_&16383];if(Y.len)_-=Y.len,Be(Y.lit,S,N,_,f,C,M,O,U,Ae),N=ue.c,_=ue.lc;else throw"hufDecode issues"}return!0}function Mr(i,h,f,C,M,E){var S={value:0},w=f.value,O=Fe(h,f),U=Fe(h,f);f.value+=4;var N=Fe(h,f);if(f.value+=4,O<0||O>=65537||U<0||U>=65537)throw"Something wrong with HUF_ENCSIZE";var _=new Array(65537),Ae=new Array(16384);j(Ae);var K=C-(f.value-w);if(Z(i,h,f,K,O,U,_),N>8*(C-(f.value-w)))throw"Something wrong with hufUncompress";Ee(_,O,U,Ae),bn(_,Ae,i,h,f,N,U,E,M,S)}function In(i,h,f){for(var C=0;C<f;++C)h[C]=i[h[C]]}function Er(i){for(var h=1;h<i.length;h++){var f=i[h-1]+i[h]-128;i[h]=f}}function Fr(i,h){for(var f=0,C=Math.floor((i.length+1)/2),M=0,E=i.length-1;!(M>E||(h[M++]=i[f++],M>E));)h[M++]=i[C++]}function br(i){for(var h=i.byteLength,f=new Array,C=0,M=new DataView(i);h>0;){var E=M.getInt8(C++);if(E<0){var S=-E;h-=S+1;for(var w=0;w<S;w++)f.push(M.getUint8(C++))}else{var S=E;h-=2;for(var O=M.getUint8(C++),w=0;w<S+1;w++)f.push(O)}}return f}function xn(i,h,f,C,M,E){var ce=new DataView(E.buffer),S=f[i.idx[0]].width,w=f[i.idx[0]].height,O=3,U=Math.floor(S/8),N=Math.ceil(S/8),_=Math.ceil(w/8),Ae=S-(N-1)*8,K=w-(_-1)*8,Q={value:0},Y=new Array(O),z=new Array(O),se=new Array(O),ie=new Array(O),me=new Array(O);for(let ae=0;ae<O;++ae)me[ae]=h[i.idx[ae]],Y[ae]=ae<1?0:Y[ae-1]+N*_,z[ae]=new Float32Array(64),se[ae]=new Uint16Array(64),ie[ae]=new Uint16Array(N*64);for(let ae=0;ae<_;++ae){var Me=8;ae==_-1&&(Me=K);var oe=8;for(let he=0;he<N;++he){he==N-1&&(oe=Ae);for(let te=0;te<O;++te)se[te].fill(0),se[te][0]=M[Y[te]++],Rn(Q,C,se[te]),Tn(se[te],z[te]),Dn(z[te]);yn(z);for(let te=0;te<O;++te)Gn(z[te],ie[te],he*64)}let ge=0;for(let he=0;he<O;++he){const te=f[i.idx[he]].type;for(let ye=8*ae;ye<8*ae+Me;++ye){ge=me[he][ye];for(let et=0;et<U;++et){const be=et*64+(ye&7)*8;ce.setUint16(ge+0*te,ie[he][be+0],!0),ce.setUint16(ge+2*te,ie[he][be+1],!0),ce.setUint16(ge+4*te,ie[he][be+2],!0),ce.setUint16(ge+6*te,ie[he][be+3],!0),ce.setUint16(ge+8*te,ie[he][be+4],!0),ce.setUint16(ge+10*te,ie[he][be+5],!0),ce.setUint16(ge+12*te,ie[he][be+6],!0),ce.setUint16(ge+14*te,ie[he][be+7],!0),ge+=16*te}}if(U!=N)for(let ye=8*ae;ye<8*ae+Me;++ye){const et=me[he][ye]+8*U*2*te,be=U*64+(ye&7)*8;for(let Ze=0;Ze<oe;++Ze)ce.setUint16(et+Ze*2*te,ie[he][be+Ze],!0)}}}for(var Ue=new Uint16Array(S),ce=new DataView(E.buffer),fe=0;fe<O;++fe){f[i.idx[fe]].decoded=!0;var Pe=f[i.idx[fe]].type;if(f[fe].type==2)for(var gt=0;gt<w;++gt){const ae=me[fe][gt];for(var De=0;De<S;++De)Ue[De]=ce.getUint16(ae+De*2*Pe,!0);for(var De=0;De<S;++De)ce.setFloat32(ae+De*2*Pe,J(Ue[De]),!0)}}}function Rn(i,h,f){for(var C,M=1;M<64;)C=h[i.value],C==65280?M=64:C>>8==255?M+=C&255:(f[M]=C,M++),i.value++}function Tn(i,h){h[0]=J(i[0]),h[1]=J(i[1]),h[2]=J(i[5]),h[3]=J(i[6]),h[4]=J(i[14]),h[5]=J(i[15]),h[6]=J(i[27]),h[7]=J(i[28]),h[8]=J(i[2]),h[9]=J(i[4]),h[10]=J(i[7]),h[11]=J(i[13]),h[12]=J(i[16]),h[13]=J(i[26]),h[14]=J(i[29]),h[15]=J(i[42]),h[16]=J(i[3]),h[17]=J(i[8]),h[18]=J(i[12]),h[19]=J(i[17]),h[20]=J(i[25]),h[21]=J(i[30]),h[22]=J(i[41]),h[23]=J(i[43]),h[24]=J(i[9]),h[25]=J(i[11]),h[26]=J(i[18]),h[27]=J(i[24]),h[28]=J(i[31]),h[29]=J(i[40]),h[30]=J(i[44]),h[31]=J(i[53]),h[32]=J(i[10]),h[33]=J(i[19]),h[34]=J(i[23]),h[35]=J(i[32]),h[36]=J(i[39]),h[37]=J(i[45]),h[38]=J(i[52]),h[39]=J(i[54]),h[40]=J(i[20]),h[41]=J(i[22]),h[42]=J(i[33]),h[43]=J(i[38]),h[44]=J(i[46]),h[45]=J(i[51]),h[46]=J(i[55]),h[47]=J(i[60]),h[48]=J(i[21]),h[49]=J(i[34]),h[50]=J(i[37]),h[51]=J(i[47]),h[52]=J(i[50]),h[53]=J(i[56]),h[54]=J(i[59]),h[55]=J(i[61]),h[56]=J(i[35]),h[57]=J(i[36]),h[58]=J(i[48]),h[59]=J(i[49]),h[60]=J(i[57]),h[61]=J(i[58]),h[62]=J(i[62]),h[63]=J(i[63])}function Dn(i){const h=.5*Math.cos(.7853975),f=.5*Math.cos(3.14159/16),C=.5*Math.cos(3.14159/8),M=.5*Math.cos(3*3.14159/16),E=.5*Math.cos(5*3.14159/16),S=.5*Math.cos(3*3.14159/8),w=.5*Math.cos(7*3.14159/16);for(var O=new Array(4),U=new Array(4),N=new Array(4),_=new Array(4),Ae=0;Ae<8;++Ae){var K=Ae*8;O[0]=C*i[K+2],O[1]=S*i[K+2],O[2]=C*i[K+6],O[3]=S*i[K+6],U[0]=f*i[K+1]+M*i[K+3]+E*i[K+5]+w*i[K+7],U[1]=M*i[K+1]-w*i[K+3]-f*i[K+5]-E*i[K+7],U[2]=E*i[K+1]-f*i[K+3]+w*i[K+5]+M*i[K+7],U[3]=w*i[K+1]-E*i[K+3]+M*i[K+5]-f*i[K+7],N[0]=h*(i[K+0]+i[K+4]),N[3]=h*(i[K+0]-i[K+4]),N[1]=O[0]+O[3],N[2]=O[1]-O[2],_[0]=N[0]+N[1],_[1]=N[3]+N[2],_[2]=N[3]-N[2],_[3]=N[0]-N[1],i[K+0]=_[0]+U[0],i[K+1]=_[1]+U[1],i[K+2]=_[2]+U[2],i[K+3]=_[3]+U[3],i[K+4]=_[3]-U[3],i[K+5]=_[2]-U[2],i[K+6]=_[1]-U[1],i[K+7]=_[0]-U[0]}for(var Q=0;Q<8;++Q)O[0]=C*i[16+Q],O[1]=S*i[16+Q],O[2]=C*i[48+Q],O[3]=S*i[48+Q],U[0]=f*i[8+Q]+M*i[24+Q]+E*i[40+Q]+w*i[56+Q],U[1]=M*i[8+Q]-w*i[24+Q]-f*i[40+Q]-E*i[56+Q],U[2]=E*i[8+Q]-f*i[24+Q]+w*i[40+Q]+M*i[56+Q],U[3]=w*i[8+Q]-E*i[24+Q]+M*i[40+Q]-f*i[56+Q],N[0]=h*(i[Q]+i[32+Q]),N[3]=h*(i[Q]-i[32+Q]),N[1]=O[0]+O[3],N[2]=O[1]-O[2],_[0]=N[0]+N[1],_[1]=N[3]+N[2],_[2]=N[3]-N[2],_[3]=N[0]-N[1],i[0+Q]=_[0]+U[0],i[8+Q]=_[1]+U[1],i[16+Q]=_[2]+U[2],i[24+Q]=_[3]+U[3],i[32+Q]=_[3]-U[3],i[40+Q]=_[2]-U[2],i[48+Q]=_[1]-U[1],i[56+Q]=_[0]-U[0]}function yn(i){for(var h=0;h<64;++h){var f=i[0][h],C=i[1][h],M=i[2][h];i[0][h]=f+1.5747*M,i[1][h]=f-.1873*C-.4682*M,i[2][h]=f+1.8556*C}}function Gn(i,h,f){for(var C=0;C<64;++C)h[f+C]=ct.toHalfFloat(wn(i[C]))}function wn(i){return i<=1?Math.sign(i)*Math.pow(Math.abs(i),2.2):Math.sign(i)*Math.pow(G,Math.abs(i)-1)}function Ir(i){return new DataView(i.array.buffer,i.offset.value,i.size)}function Sn(i){var h=i.viewer.buffer.slice(i.offset.value,i.offset.value+i.size),f=new Uint8Array(br(h)),C=new Uint8Array(f.length);return Er(f),Fr(f,C),new DataView(C.buffer)}function Qt(i){var h=i.array.slice(i.offset.value,i.offset.value+i.size),f=Lt(h),C=new Uint8Array(f.length);return Er(f),Fr(f,C),new DataView(C.buffer)}function Hn(i){for(var h=i.viewer,f={value:i.offset.value},C=new Uint16Array(i.width*i.scanlineBlockSize*(i.channels*i.type)),M=new Uint8Array(8192),E=0,S=new Array(i.channels),w=0;w<i.channels;w++)S[w]={},S[w].start=E,S[w].end=S[w].start,S[w].nx=i.width,S[w].ny=i.lines,S[w].size=i.type,E+=S[w].nx*S[w].ny*S[w].size;var O=ft(h,f),U=ft(h,f);if(U>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(O<=U)for(var w=0;w<U-O+1;w++)M[w+O]=at(h,f);var N=new Uint16Array(65536),_=k(M,N),Ae=Fe(h,f);Mr(i.array,h,f,Ae,C,E);for(var w=0;w<i.channels;++w)for(var K=S[w],Q=0;Q<S[w].size;++Q)Fn(C,K.start+Q,K.nx,K.size,K.ny,K.nx*K.size,_);In(N,C,E);for(var Y=0,z=new Uint8Array(C.buffer.byteLength),se=0;se<i.lines;se++)for(var ie=0;ie<i.channels;ie++){var K=S[ie],me=K.nx*K.size,Me=new Uint8Array(C.buffer,K.end*2,me*2);z.set(Me,Y),Y+=me*2,K.end+=me}return new DataView(z.buffer)}function _n(i){var h=i.array.slice(i.offset.value,i.offset.value+i.size),f=Lt(h);const C=i.lines*i.channels*i.width,M=i.type==1?new Uint16Array(C):new Uint32Array(C);let E=0,S=0;const w=new Array(4);for(let O=0;O<i.lines;O++)for(let U=0;U<i.channels;U++){let N=0;switch(i.type){case 1:w[0]=E,w[1]=w[0]+i.width,E=w[1]+i.width;for(let _=0;_<i.width;++_){const Ae=f[w[0]++]<<8|f[w[1]++];N+=Ae,M[S]=N,S++}break;case 2:w[0]=E,w[1]=w[0]+i.width,w[2]=w[1]+i.width,E=w[2]+i.width;for(let _=0;_<i.width;++_){const Ae=f[w[0]++]<<24|f[w[1]++]<<16|f[w[2]++]<<8;N+=Ae,M[S]=N,S++}break}}return new DataView(M.buffer)}function xr(i){var h=i.viewer,f={value:i.offset.value},C=new Uint8Array(i.width*i.lines*(i.channels*i.type*2)),M={version:Te(h,f),unknownUncompressedSize:Te(h,f),unknownCompressedSize:Te(h,f),acCompressedSize:Te(h,f),dcCompressedSize:Te(h,f),rleCompressedSize:Te(h,f),rleUncompressedSize:Te(h,f),rleRawSize:Te(h,f),totalAcUncompressedCount:Te(h,f),totalDcUncompressedCount:Te(h,f),acCompression:Te(h,f)};if(M.version<2)throw"EXRLoader.parse: "+pt.compression+" version "+M.version+" is unsupported";for(var E=new Array,S=ft(h,f)-2;S>0;){var w=Ht(h.buffer,f),O=at(h,f),U=O>>2&3,N=(O>>4)-1,_=new Int8Array([N])[0],Ae=at(h,f);E.push({name:w,index:_,type:Ae,compression:U}),S-=w.length+3}for(var K=pt.channels,Q=new Array(i.channels),Y=0;Y<i.channels;++Y){var z=Q[Y]={},se=K[Y];z.name=se.name,z.compression=0,z.decoded=!1,z.type=se.pixelType,z.pLinear=se.pLinear,z.width=i.width,z.height=i.lines}for(var ie={idx:new Array(3)},me=0;me<i.channels;++me)for(var z=Q[me],Y=0;Y<E.length;++Y){var Me=E[Y];z.name==Me.name&&(z.compression=Me.compression,Me.index>=0&&(ie.idx[Me.index]=me),z.offset=me)}if(M.acCompressedSize>0)switch(M.acCompression){case 0:var ce=new Uint16Array(M.totalAcUncompressedCount);Mr(i.array,h,f,M.acCompressedSize,ce,M.totalAcUncompressedCount);break;case 1:var oe=i.array.slice(f.value,f.value+M.totalAcUncompressedCount),Ue=Lt(oe),ce=new Uint16Array(Ue.buffer);f.value+=M.totalAcUncompressedCount;break}if(M.dcCompressedSize>0){var fe={array:i.array,offset:f,size:M.dcCompressedSize},Pe=new Uint16Array(Qt(fe).buffer);f.value+=M.dcCompressedSize}if(M.rleRawSize>0){var oe=i.array.slice(f.value,f.value+M.rleCompressedSize),Ue=Lt(oe),gt=br(Ue.buffer);f.value+=M.rleCompressedSize}for(var De=0,ae=new Array(Q.length),Y=0;Y<ae.length;++Y)ae[Y]=new Array;for(var ge=0;ge<i.lines;++ge)for(var he=0;he<Q.length;++he)ae[he].push(De),De+=Q[he].width*i.type*2;xn(ie,ae,Q,ce,Pe,C);for(var Y=0;Y<Q.length;++Y){var z=Q[Y];if(!z.decoded)switch(z.compression){case 2:for(var te=0,ye=0,ge=0;ge<i.lines;++ge){for(var et=ae[Y][te],be=0;be<z.width;++be){for(var Ze=0;Ze<2*z.type;++Ze)C[et++]=gt[ye+Ze*z.width*z.height];ye++}te++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(C.buffer)}function Ht(i,h){for(var f=new Uint8Array(i),C=0;f[h.value+C]!=0;)C+=1;var M=new TextDecoder().decode(f.slice(h.value,h.value+C));return h.value=h.value+C+1,M}function Ln(i,h,f){var C=new TextDecoder().decode(new Uint8Array(i).slice(h.value,h.value+f));return h.value=h.value+f,C}function Un(i,h){var f=mt(i,h),C=Fe(i,h);return[f,C]}function On(i,h){var f=Fe(i,h),C=Fe(i,h);return[f,C]}function mt(i,h){var f=i.getInt32(h.value,!0);return h.value=h.value+4,f}function Fe(i,h){var f=i.getUint32(h.value,!0);return h.value=h.value+4,f}function Rr(i,h){var f=i[h.value];return h.value=h.value+1,f}function at(i,h){var f=i.getUint8(h.value);return h.value=h.value+1,f}const Te=function(i,h){let f;return"getBigInt64"in DataView.prototype?f=Number(i.getBigInt64(h.value,!0)):f=i.getUint32(h.value+4,!0)+Number(i.getUint32(h.value,!0)<<32),h.value+=8,f};function pe(i,h){var f=i.getFloat32(h.value,!0);return h.value+=4,f}function Nn(i,h){return ct.toHalfFloat(pe(i,h))}function J(i){var h=(i&31744)>>10,f=i&1023;return(i>>15?-1:1)*(h?h===31?f?NaN:1/0:Math.pow(2,h-15)*(1+f/1024):6103515625e-14*(f/1024))}function ft(i,h){var f=i.getUint16(h.value,!0);return h.value+=2,f}function Jn(i,h){return J(ft(i,h))}function kn(i,h,f,C){for(var M=f.value,E=[];f.value<M+C-1;){var S=Ht(h,f),w=mt(i,f),O=at(i,f);f.value+=3;var U=mt(i,f),N=mt(i,f);E.push({name:S,pixelType:w,pLinear:O,xSampling:U,ySampling:N})}return f.value+=1,E}function Pn(i,h){var f=pe(i,h),C=pe(i,h),M=pe(i,h),E=pe(i,h),S=pe(i,h),w=pe(i,h),O=pe(i,h),U=pe(i,h);return{redX:f,redY:C,greenX:M,greenY:E,blueX:S,blueY:w,whiteX:O,whiteY:U}}function Kn(i,h){var f=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],C=at(i,h);return f[C]}function Qn(i,h){var f=Fe(i,h),C=Fe(i,h),M=Fe(i,h),E=Fe(i,h);return{xMin:f,yMin:C,xMax:M,yMax:E}}function jn(i,h){var f=["INCREASING_Y"],C=at(i,h);return f[C]}function Xn(i,h){var f=pe(i,h),C=pe(i,h);return[f,C]}function Zn(i,h){var f=pe(i,h),C=pe(i,h),M=pe(i,h);return[f,C,M]}function Yn(i,h,f,C,M){if(C==="string"||C==="stringvector"||C==="iccProfile")return Ln(h,f,M);if(C==="chlist")return kn(i,h,f,M);if(C==="chromaticities")return Pn(i,f);if(C==="compression")return Kn(i,f);if(C==="box2i")return Qn(i,f);if(C==="lineOrder")return jn(i,f);if(C==="float")return pe(i,f);if(C==="v2f")return Xn(i,f);if(C==="v3f")return Zn(i,f);if(C==="int")return mt(i,f);if(C==="rational")return Un(i,f);if(C==="timecode")return On(i,f);if(C==="preview")return f.value+=M,"skipped";f.value+=M}function Wn(i,h,f){const C={};if(i.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";C.version=i.getUint8(4);const M=i.getUint8(5);C.spec={singleTile:!!(M&2),longName:!!(M&4),deepFormat:!!(M&8),multiPart:!!(M&16)},f.value=8;for(var E=!0;E;){var S=Ht(h,f);if(S==0)E=!1;else{var w=Ht(h,f),O=Fe(i,f),U=Yn(i,h,f,w,O);U===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${w}'.`):C[S]=U}}if((M&-5)!=0)throw console.error("EXRHeader:",C),"THREE.EXRLoader: provided file is currently unsupported.";return C}function zn(i,h,f,C,M){const E={size:0,viewer:h,array:f,offset:C,width:i.dataWindow.xMax-i.dataWindow.xMin+1,height:i.dataWindow.yMax-i.dataWindow.yMin+1,channels:i.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:i.channels[0].pixelType,uncompress:null,getter:null,format:null,[vt?"colorSpace":"encoding"]:null};switch(i.compression){case"NO_COMPRESSION":E.lines=1,E.uncompress=Ir;break;case"RLE_COMPRESSION":E.lines=1,E.uncompress=Sn;break;case"ZIPS_COMPRESSION":E.lines=1,E.uncompress=Qt;break;case"ZIP_COMPRESSION":E.lines=16,E.uncompress=Qt;break;case"PIZ_COMPRESSION":E.lines=32,E.uncompress=Hn;break;case"PXR24_COMPRESSION":E.lines=16,E.uncompress=_n;break;case"DWAA_COMPRESSION":E.lines=32,E.uncompress=xr;break;case"DWAB_COMPRESSION":E.lines=256,E.uncompress=xr;break;default:throw"EXRLoader.parse: "+i.compression+" is unsupported"}if(E.scanlineBlockSize=E.lines,E.type==1)switch(M){case je:E.getter=Jn,E.inputSize=2;break;case Ie:E.getter=ft,E.inputSize=2;break}else if(E.type==2)switch(M){case je:E.getter=pe,E.inputSize=4;break;case Ie:E.getter=Nn,E.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+E.type+" for "+i.compression+".";E.blockCount=(i.dataWindow.yMax+1)/E.scanlineBlockSize;for(var S=0;S<E.blockCount;S++)Te(h,C);E.outputChannels=E.channels==3?4:E.channels;const w=E.width*E.height*E.outputChannels;switch(M){case je:E.byteArray=new Float32Array(w),E.channels<E.outputChannels&&E.byteArray.fill(1,0,w);break;case Ie:E.byteArray=new Uint16Array(w),E.channels<E.outputChannels&&E.byteArray.fill(15360,0,w);break;default:console.error("THREE.EXRLoader: unsupported type: ",M);break}return E.bytesPerLine=E.width*E.inputSize*E.channels,E.outputChannels==4?E.format=Dt:E.format=Ss,vt?E.colorSpace="srgb-linear":E.encoding=3e3,E}const _t=new DataView(e),Vn=new Uint8Array(e),Bt={value:0},pt=Wn(_t,e,Bt),q=zn(pt,_t,Vn,Bt,this.type),Tr={value:0},qn={R:0,G:1,B:2,A:3,Y:0};for(let i=0;i<q.height/q.scanlineBlockSize;i++){const h=Fe(_t,Bt);q.size=Fe(_t,Bt),q.lines=h+q.scanlineBlockSize>q.height?q.height-h:q.scanlineBlockSize;const C=q.size<q.lines*q.bytesPerLine?q.uncompress(q):Ir(q);Bt.value+=q.size;for(let M=0;M<q.scanlineBlockSize;M++){const E=M+i*q.scanlineBlockSize;if(E>=q.height)break;for(let S=0;S<q.channels;S++){const w=qn[pt.channels[S].name];for(let O=0;O<q.width;O++){Tr.value=(M*(q.channels*q.width)+S*q.width+O)*q.inputSize;const U=(q.height-1-E)*(q.width*q.outputChannels)+O*q.outputChannels+w;q.byteArray[U]=q.getter(C,Tr)}}}}return{header:pt,width:q.width,height:q.height,data:q.byteArray,format:q.format,[vt?"colorSpace":"encoding"]:q[vt?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,r){function a(s,u){vt?s.colorSpace=u.colorSpace:s.encoding=u.encoding,s.minFilter=He,s.magFilter=He,s.generateMipmaps=!1,s.flipY=!1,t&&t(s,u)}return super.load(e,a,n,r)}}const qt=new WeakMap;class di extends lr{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,r){const a=new $e(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,s=>{const u={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(s,u).then(t).catch(r)},n,r)}decodeDracoFile(e,t,n,r){const a={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,a).then(t)}decodeGeometry(e,t){for(const c in t.attributeTypes){const l=t.attributeTypes[c];l.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[c]=l.name)}const n=JSON.stringify(t);if(qt.has(e)){const c=qt.get(e);if(c.key===n)return c.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const a=this.workerNextTaskID++,s=e.byteLength,u=this._getWorker(a,s).then(c=>(r=c,new Promise((l,A)=>{r._callbacks[a]={resolve:l,reject:A},r.postMessage({type:"decode",id:a,taskConfig:t,buffer:e},[e])}))).then(c=>this._createGeometry(c.geometry));return u.catch(()=>!0).then(()=>{r&&a&&this._releaseTask(r,a)}),qt.set(e,{key:n,promise:u}),u}_createGeometry(e){const t=new Wr;e.index&&t.setIndex(new It(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const r=e.attributes[n],a=r.name,s=r.array,u=r.itemSize;t.setAttribute(a,new It(s,u))}return t}_loadLibrary(e,t){const n=new $e(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((r,a)=>{n.load(e,r,void 0,a)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const r=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const a=mi.toString(),s=["/* draco decoder */",r,"","/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(a){const s=a.data;switch(s.type){case"decode":r._callbacks[s.id].resolve(s);break;case"error":r._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,a){return r._taskLoad>a._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function mi(){let o,e;onmessage=function(s){const u=s.data;switch(u.type){case"init":o=u.decoderConfig,e=new Promise(function(A){o.onModuleLoaded=function(d){A({draco:d})},DracoDecoderModule(o)});break;case"decode":const c=u.buffer,l=u.taskConfig;e.then(A=>{const d=A.draco,m=new d.Decoder,B=new d.DecoderBuffer;B.Init(new Int8Array(c),c.byteLength);try{const p=t(d,m,B,l),g=p.attributes.map(v=>v.array.buffer);p.index&&g.push(p.index.array.buffer),self.postMessage({type:"decode",id:u.id,geometry:p},g)}catch(p){console.error(p),self.postMessage({type:"error",id:u.id,error:p.message})}finally{d.destroy(B),d.destroy(m)}});break}};function t(s,u,c,l){const A=l.attributeIDs,d=l.attributeTypes;let m,B;const p=u.GetEncodedGeometryType(c);if(p===s.TRIANGULAR_MESH)m=new s.Mesh,B=u.DecodeBufferToMesh(c,m);else if(p===s.POINT_CLOUD)m=new s.PointCloud,B=u.DecodeBufferToPointCloud(c,m);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!B.ok()||m.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+B.error_msg());const g={index:null,attributes:[]};for(const v in A){const x=self[d[v]];let F,H;if(l.useUniqueIDs)H=A[v],F=u.GetAttributeByUniqueId(m,H);else{if(H=u.GetAttributeId(m,s[A[v]]),H===-1)continue;F=u.GetAttribute(m,H)}g.attributes.push(r(s,u,m,v,x,F))}return p===s.TRIANGULAR_MESH&&(g.index=n(s,u,m)),s.destroy(m),g}function n(s,u,c){const A=c.num_faces()*3,d=A*4,m=s._malloc(d);u.GetTrianglesUInt32Array(c,d,m);const B=new Uint32Array(s.HEAPF32.buffer,m,A).slice();return s._free(m),{array:B,itemSize:1}}function r(s,u,c,l,A,d){const m=d.num_components(),p=c.num_points()*m,g=p*A.BYTES_PER_ELEMENT,v=a(s,A),x=s._malloc(g);u.GetAttributeDataArrayForAllPoints(c,d,v,g,x);const F=new A(s.HEAPF32.buffer,x,p).slice();return s._free(x),{name:l,array:F,itemSize:m}}function a(s,u){switch(u){case Float32Array:return s.DT_FLOAT32;case Int8Array:return s.DT_INT8;case Int16Array:return s.DT_INT16;case Int32Array:return s.DT_INT32;case Uint8Array:return s.DT_UINT8;case Uint16Array:return s.DT_UINT16;case Uint32Array:return s.DT_UINT32}}}let Ut;const $t=()=>{if(Ut)return Ut;const o="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",e="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),n=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let r=o;WebAssembly.validate(t)&&(r=e);let a;const s=WebAssembly.instantiate(u(r),{}).then(d=>{a=d.instance,a.exports.__wasm_call_ctors()});function u(d){const m=new Uint8Array(d.length);for(let p=0;p<d.length;++p){const g=d.charCodeAt(p);m[p]=g>96?g-71:g>64?g-65:g>47?g+4:g>46?63:62}let B=0;for(let p=0;p<d.length;++p)m[B++]=m[p]<60?n[m[p]]:(m[p]-60)*64+m[++p];return m.buffer.slice(0,B)}function c(d,m,B,p,g,v){const x=a.exports.sbrk,F=B+3&-4,H=x(F*p),L=x(g.length),y=new Uint8Array(a.exports.memory.buffer);y.set(g,L);const b=d(H,B,p,L,g.length);if(b===0&&v&&v(H,F,p),m.set(y.subarray(H,H+B*p)),x(H-x(0)),b!==0)throw new Error(`Malformed buffer data: ${b}`)}const l={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},A={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return Ut={ready:s,supported:!0,decodeVertexBuffer(d,m,B,p,g){c(a.exports.meshopt_decodeVertexBuffer,d,m,B,p,a.exports[l[g]])},decodeIndexBuffer(d,m,B,p){c(a.exports.meshopt_decodeIndexBuffer,d,m,B,p)},decodeIndexSequence(d,m,B,p){c(a.exports.meshopt_decodeIndexSequence,d,m,B,p)},decodeGltfBuffer(d,m,B,p,g,v){c(a.exports[A[g]],d,m,B,p,a.exports[l[v]])}},Ut};function An(o,e,t,n){var r;return r=class extends ht{constructor(a){super({vertexShader:e,fragmentShader:t,...a});for(const s in o)this.uniforms[s]=new Hs(o[s]),Object.defineProperty(this,s,{get(){return this.uniforms[s].value},set(u){this.uniforms[s].value=u}});this.uniforms=_s.clone(this.uniforms)}},r.key=xt.generateUUID(),r}let Ot=null,dn="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function mn(o=!0,e=!0,t){return n=>{t&&t(n),o&&(Ot||(Ot=new di),Ot.setDecoderPath(typeof o=="string"?o:dn),n.setDRACOLoader(Ot)),e&&n.setMeshoptDecoder(typeof $t=="function"?$t():$t)}}const Pt=(o,e,t,n)=>st(dr,o,mn(e,t,n));Pt.preload=(o,e,t,n)=>st.preload(dr,o,mn(e,t,n));Pt.clear=o=>st.clear(dr,o);Pt.setDecoderPath=o=>{dn=o};const fi=R.forwardRef(function({children:e,object:t,disable:n,disableX:r,disableY:a,disableZ:s,left:u,right:c,top:l,bottom:A,front:d,back:m,onCentered:B,precise:p=!0,cacheKey:g=0,...v},x){const F=R.useRef(null),H=R.useRef(null),L=R.useRef(null),[y]=R.useState(()=>new ur),[b]=R.useState(()=>new ee),[T]=R.useState(()=>new qr);return R.useLayoutEffect(()=>{H.current.matrixWorld.identity(),y.setFromObject(t??L.current,p);const I=y.max.x-y.min.x,G=y.max.y-y.min.y,k=y.max.z-y.min.z;y.getCenter(b),y.getBoundingSphere(T);const j=l?G/2:A?-G/2:0,X=u?-I/2:c?I/2:0,W=d?k/2:m?-k/2:0;H.current.position.set(n||r?0:-b.x+X,n||a?0:-b.y+j,n||s?0:-b.z+W),B==null||B({parent:F.current.parent,container:F.current,width:I,height:G,depth:k,boundingBox:y,boundingSphere:T,center:b,verticalAlignment:j,horizontalAlignment:X,depthAlignment:W})},[g,B,l,u,d,n,r,a,s,t,p,c,A,m,y,b,T]),R.useImperativeHandle(x,()=>F.current,[]),R.createElement("group",Ve({ref:F},v),R.createElement("group",{ref:H},R.createElement("group",{ref:L},e)))}),Bi=An({},"void main() { }","void main() { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0); discard;  }");var Ge=(function(o){return o[o.NONE=0]="NONE",o[o.START=1]="START",o[o.ACTIVE=2]="ACTIVE",o})(Ge||{});const it=o=>o&&o.isOrthographicCamera,pi=o=>o&&o.isBox3,gi=o=>1-Math.exp(-5*o)+.007*o,fn=R.createContext(null);function Ci({children:o,maxDuration:e=1,margin:t=1.2,observe:n,fit:r,clip:a,interpolateFunc:s=gi,onFit:u}){const c=R.useRef(null),{camera:l,size:A,invalidate:d}=xe(),m=xe(y=>y.controls),B=R.useRef(u);B.current=u;const p=R.useRef({camPos:new ee,camRot:new bt,camZoom:1}),g=R.useRef({camPos:void 0,camRot:void 0,camZoom:void 0,camUp:void 0,target:void 0}),v=R.useRef(Ge.NONE),x=R.useRef(0),[F]=R.useState(()=>new ur),H=R.useMemo(()=>{function y(){const b=F.getSize(new ee),T=F.getCenter(new ee),I=Math.max(b.x,b.y,b.z),G=it(l)?I*4:I/(2*Math.atan(Math.PI*l.fov/360)),k=it(l)?I*4:G/l.aspect,j=t*Math.max(G,k);return{box:F,size:b,center:T,distance:j}}return{getSize:y,refresh(b){if(pi(b))F.copy(b);else{const T=b||c.current;if(!T)return this;T.updateWorldMatrix(!0,!0),F.setFromObject(T)}if(F.isEmpty()){const T=l.position.length()||10;F.setFromCenterAndSize(new ee,new ee(T,T,T))}return p.current.camPos.copy(l.position),p.current.camRot.copy(l.quaternion),it(l)&&(p.current.camZoom=l.zoom),g.current.camPos=void 0,g.current.camRot=void 0,g.current.camZoom=void 0,g.current.camUp=void 0,g.current.target=void 0,this},reset(){const{center:b,distance:T}=y(),I=l.position.clone().sub(b).normalize();g.current.camPos=b.clone().addScaledVector(I,T),g.current.target=b.clone();const G=new nt().lookAt(g.current.camPos,g.current.target,l.up);return g.current.camRot=new bt().setFromRotationMatrix(G),v.current=Ge.START,x.current=0,this},moveTo(b){return g.current.camPos=Array.isArray(b)?new ee(...b):b.clone(),v.current=Ge.START,x.current=0,this},lookAt({target:b,up:T}){g.current.target=Array.isArray(b)?new ee(...b):b.clone(),T?g.current.camUp=Array.isArray(T)?new ee(...T):T.clone():g.current.camUp=l.up.clone();const I=new nt().lookAt(g.current.camPos||l.position,g.current.target,g.current.camUp);return g.current.camRot=new bt().setFromRotationMatrix(I),v.current=Ge.START,x.current=0,this},to({position:b,target:T}){return this.moveTo(b).lookAt({target:T})},fit(){if(!it(l))return this.reset();let b=0,T=0;const I=[new ee(F.min.x,F.min.y,F.min.z),new ee(F.min.x,F.max.y,F.min.z),new ee(F.min.x,F.min.y,F.max.z),new ee(F.min.x,F.max.y,F.max.z),new ee(F.max.x,F.max.y,F.max.z),new ee(F.max.x,F.max.y,F.min.z),new ee(F.max.x,F.min.y,F.max.z),new ee(F.max.x,F.min.y,F.min.z)],G=g.current.camPos||l.position,k=g.current.target||(m==null?void 0:m.target),j=g.current.camUp||l.up,X=k?new nt().lookAt(G,k,j).setPosition(G).invert():l.matrixWorldInverse;for(const $ of I)$.applyMatrix4(X),b=Math.max(b,Math.abs($.y)),T=Math.max(T,Math.abs($.x));b*=2,T*=2;const W=(l.top-l.bottom)/b,P=(l.right-l.left)/T;return g.current.camZoom=Math.min(W,P)/t,v.current=Ge.START,x.current=0,B.current&&B.current(this.getSize()),this},clip(){const{distance:b}=y();return l.near=b/100,l.far=b*100,l.updateProjectionMatrix(),m&&(m.maxDistance=b*10,m.update()),d(),this}}},[F,l,m,t,d]);R.useLayoutEffect(()=>{if(m){const y=()=>{if(m&&g.current.target&&v.current!==Ge.NONE){const b=new ee().setFromMatrixColumn(l.matrix,2),T=p.current.camPos.distanceTo(m.target),I=(g.current.camPos||p.current.camPos).distanceTo(g.current.target),G=(1-x.current)*T+x.current*I;m.target.copy(l.position).addScaledVector(b,-G),m.update()}v.current=Ge.NONE};return m.addEventListener("start",y),()=>m.removeEventListener("start",y)}},[m]);const L=R.useRef(0);return R.useLayoutEffect(()=>{(n||L.current++===0)&&(H.refresh(),r&&H.reset().fit(),a&&H.clip())},[A,a,r,n,l,m]),wt((y,b)=>{if(v.current===Ge.START)v.current=Ge.ACTIVE,d();else if(v.current===Ge.ACTIVE){if(x.current+=b/e,x.current>=1)g.current.camPos&&l.position.copy(g.current.camPos),g.current.camRot&&l.quaternion.copy(g.current.camRot),g.current.camUp&&l.up.copy(g.current.camUp),g.current.camZoom&&it(l)&&(l.zoom=g.current.camZoom),l.updateMatrixWorld(),l.updateProjectionMatrix(),m&&g.current.target&&(m.target.copy(g.current.target),m.update()),v.current=Ge.NONE;else{const T=s(x.current);g.current.camPos&&l.position.lerpVectors(p.current.camPos,g.current.camPos,T),g.current.camRot&&l.quaternion.slerpQuaternions(p.current.camRot,g.current.camRot,T),g.current.camUp&&l.up.set(0,1,0).applyQuaternion(l.quaternion),g.current.camZoom&&it(l)&&(l.zoom=(1-T)*p.current.camZoom+T*g.current.camZoom),l.updateMatrixWorld(),l.updateProjectionMatrix()}d()}}),R.createElement("group",{ref:c},R.createElement(fn.Provider,{value:H},o))}function vi(){return R.useContext(fn)}const Bn=(o,e,t)=>{let n;switch(o){case sr:n=new Uint8ClampedArray(e*t*4);break;case Ie:n=new Uint16Array(e*t*4);break;case ks:n=new Uint32Array(e*t*4);break;case Js:n=new Int8Array(e*t*4);break;case Ns:n=new Int16Array(e*t*4);break;case Os:n=new Int32Array(e*t*4);break;case je:n=new Float32Array(e*t*4);break;default:throw new Error("Unsupported data type")}return n};let Nt;const Mi=(o,e,t,n)=>{if(Nt!==void 0)return Nt;const r=new At(1,1,n);e.setRenderTarget(r);const a=new Gt(new hr,new ot({color:16777215}));e.render(a,t),e.setRenderTarget(null);const s=Bn(o,r.width,r.height);return e.readRenderTargetPixels(r,0,0,r.width,r.height,s),r.dispose(),a.geometry.dispose(),a.material.dispose(),Nt=s[0]!==0,Nt};class mr{constructor(e){de(this,"_renderer");de(this,"_rendererIsDisposable",!1);de(this,"_material");de(this,"_scene");de(this,"_camera");de(this,"_quad");de(this,"_renderTarget");de(this,"_width");de(this,"_height");de(this,"_type");de(this,"_colorSpace");de(this,"_supportsReadPixels",!0);de(this,"render",()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(e){throw this._renderer.setRenderTarget(null),e}this._renderer.setRenderTarget(null)});var n,r,a,s,u,c,l,A,d,m,B,p,g,v,x,F;this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const t={format:Dt,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((n=e.renderTargetOptions)==null?void 0:n.anisotropy)!==void 0?(r=e.renderTargetOptions)==null?void 0:r.anisotropy:1,generateMipmaps:((a=e.renderTargetOptions)==null?void 0:a.generateMipmaps)!==void 0?(s=e.renderTargetOptions)==null?void 0:s.generateMipmaps:!1,magFilter:((u=e.renderTargetOptions)==null?void 0:u.magFilter)!==void 0?(c=e.renderTargetOptions)==null?void 0:c.magFilter:He,minFilter:((l=e.renderTargetOptions)==null?void 0:l.minFilter)!==void 0?(A=e.renderTargetOptions)==null?void 0:A.minFilter:He,samples:((d=e.renderTargetOptions)==null?void 0:d.samples)!==void 0?(m=e.renderTargetOptions)==null?void 0:m.samples:void 0,wrapS:((B=e.renderTargetOptions)==null?void 0:B.wrapS)!==void 0?(p=e.renderTargetOptions)==null?void 0:p.wrapS:Qe,wrapT:((g=e.renderTargetOptions)==null?void 0:g.wrapT)!==void 0?(v=e.renderTargetOptions)==null?void 0:v.wrapT:Qe};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=mr.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new en,this._camera=new zr,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!Mi(this._type,this._renderer,this._camera,t)){let H;switch(this._type){case Ie:H=this._renderer.extensions.has("EXT_color_buffer_float")?je:void 0;break}H!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${je}`),this._type=H):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new Gt(new hr,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new At(this.width,this.height,t),this._renderTarget.texture.mapping=((x=e.renderTargetOptions)==null?void 0:x.mapping)!==void 0?(F=e.renderTargetOptions)==null?void 0:F.mapping:Jt}static instantiateRenderer(){const e=new Ls;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=Bn(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const t=new Us(this.toArray(),this.width,this.height,Dt,this._type,(e==null?void 0:e.mapping)||Jt,(e==null?void 0:e.wrapS)||Qe,(e==null?void 0:e.wrapT)||Qe,(e==null?void 0:e.magFilter)||He,(e==null?void 0:e.minFilter)||He,(e==null?void 0:e.anisotropy)||1,nr);return t.generateMipmaps=(e==null?void 0:e.generateMipmaps)!==void 0?e==null?void 0:e.generateMipmaps:!1,t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof ht&&Object.values(this.material.uniforms).forEach(t=>{t.value instanceof ze&&t.value.dispose()}),Object.values(this.material).forEach(t=>{t instanceof ze&&t.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class pn extends Error{}class gn extends Error{}const Mt=(o,e,t)=>{const n=new RegExp(`${e}="([^"]*)"`,"i").exec(o);if(n)return n[1];const r=new RegExp(`<${e}[^>]*>([\\s\\S]*?)</${e}>`,"i").exec(o);if(r){const a=r[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return a&&a.length===3?a.map(s=>s.replace(/<\/?rdf:li>/g,"")):r[1].trim()}if(t!==void 0)return t;throw new Error(`Can't find ${e} in gainmap metadata`)},Ei=o=>{let e;typeof TextDecoder<"u"?e=new TextDecoder().decode(o):e=o.toString();let t=e.indexOf("<x:xmpmeta");for(;t!==-1;){const n=e.indexOf("x:xmpmeta>",t),r=e.slice(t,n+10);try{const a=Mt(r,"hdrgm:GainMapMin","0"),s=Mt(r,"hdrgm:GainMapMax"),u=Mt(r,"hdrgm:Gamma","1"),c=Mt(r,"hdrgm:OffsetSDR","0.015625"),l=Mt(r,"hdrgm:OffsetHDR","0.015625"),A=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(r),d=A?A[1]:"0",m=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(r);if(!m)throw new Error("Incomplete gainmap metadata");const B=m[1];return{gainMapMin:Array.isArray(a)?a.map(p=>parseFloat(p)):[parseFloat(a),parseFloat(a),parseFloat(a)],gainMapMax:Array.isArray(s)?s.map(p=>parseFloat(p)):[parseFloat(s),parseFloat(s),parseFloat(s)],gamma:Array.isArray(u)?u.map(p=>parseFloat(p)):[parseFloat(u),parseFloat(u),parseFloat(u)],offsetSdr:Array.isArray(c)?c.map(p=>parseFloat(p)):[parseFloat(c),parseFloat(c),parseFloat(c)],offsetHdr:Array.isArray(l)?l.map(p=>parseFloat(p)):[parseFloat(l),parseFloat(l),parseFloat(l)],hdrCapacityMin:parseFloat(d),hdrCapacityMax:parseFloat(B)}}catch{}t=e.indexOf("<x:xmpmeta",n)}};class Fi{constructor(e){de(this,"options");this.options={debug:e&&e.debug!==void 0?e.debug:!1,extractFII:e&&e.extractFII!==void 0?e.extractFII:!0,extractNonFII:e&&e.extractNonFII!==void 0?e.extractNonFII:!0}}extract(e){return new Promise((t,n)=>{const r=this.options.debug,a=new DataView(e.buffer);if(a.getUint16(0)!==65496){n(new Error("Not a valid jpeg"));return}const s=a.byteLength;let u=2,c=0,l;for(;u<s;){if(++c>250){n(new Error(`Found no marker after ${c} loops 😵`));return}if(a.getUint8(u)!==255){n(new Error(`Not a valid marker at offset 0x${u.toString(16)}, found: 0x${a.getUint8(u).toString(16)}`));return}if(l=a.getUint8(u+1),r&&console.log(`Marker: ${l.toString(16)}`),l===226){r&&console.log("Found APP2 marker (0xffe2)");const A=u+4;if(a.getUint32(A)===1297106432){const d=A+4;let m;if(a.getUint16(d)===18761)m=!1;else if(a.getUint16(d)===19789)m=!0;else{n(new Error("No valid endianness marker found in TIFF header"));return}if(a.getUint16(d+2,!m)!==42){n(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const B=a.getUint32(d+4,!m);if(B<8){n(new Error("Not valid TIFF data! (First offset less than 8)"));return}const p=d+B,g=a.getUint16(p,!m),v=p+2;let x=0;for(let y=v;y<v+12*g;y+=12)a.getUint16(y,!m)===45057&&(x=a.getUint32(y+8,!m));const H=p+2+g*12+4,L=[];for(let y=H;y<H+x*16;y+=16){const b={MPType:a.getUint32(y,!m),size:a.getUint32(y+4,!m),dataOffset:a.getUint32(y+8,!m),dependantImages:a.getUint32(y+12,!m),start:-1,end:-1,isFII:!1};b.dataOffset?(b.start=d+b.dataOffset,b.isFII=!1):(b.start=0,b.isFII=!0),b.end=b.start+b.size,L.push(b)}if(this.options.extractNonFII&&L.length){const y=new Blob([a]),b=[];for(const T of L){if(T.isFII&&!this.options.extractFII)continue;const I=y.slice(T.start,T.end+1,"image/jpeg");b.push(I)}t(b)}}}u+=2+a.getUint16(u+2)}})}}const bi=async o=>{const e=Ei(o);if(!e)throw new gn("Gain map XMP metadata not found");const n=await new Fi({extractFII:!0,extractNonFII:!0}).extract(o);if(n.length!==2)throw new pn("Gain map recovery image not found");return{sdr:new Uint8Array(await n[0].arrayBuffer()),gainMap:new Uint8Array(await n[1].arrayBuffer()),metadata:e}},Pr=o=>new Promise((e,t)=>{const n=document.createElement("img");n.onload=()=>{e(n)},n.onerror=r=>{t(r)},n.src=URL.createObjectURL(o)});class Ii extends lr{constructor(t,n){super(n);de(this,"_renderer");de(this,"_renderTargetOptions");de(this,"_internalLoadingManager");de(this,"_config");this._config=t,t.renderer&&(this._renderer=t.renderer),this._internalLoadingManager=new Ps}setRenderer(t){return this._renderer=t,this}setRenderTargetOptions(t){return this._renderTargetOptions=t,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: A Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const t=this._config.createMaterial({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new ze,sdr:new ze});return this._config.createQuadRenderer({width:16,height:16,type:Ie,colorSpace:nr,material:t,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async processImages(t,n,r){const a=n?new Blob([n],{type:"image/jpeg"}):void 0,s=new Blob([t],{type:"image/jpeg"});let u,c,l=!1;if(typeof createImageBitmap>"u"){const A=await Promise.all([a?Pr(a):Promise.resolve(void 0),Pr(s)]);c=A[0],u=A[1],l=r==="flipY"}else{const A=await Promise.all([a?createImageBitmap(a,{imageOrientation:r||"flipY"}):Promise.resolve(void 0),createImageBitmap(s,{imageOrientation:r||"flipY"})]);c=A[0],u=A[1]}return{sdrImage:u,gainMapImage:c,needsFlip:l}}createTextures(t,n,r){const a=new ze(n||new ImageData(2,2),Jt,Qe,Qe,He,Sr,Dt,sr,1,nr);a.flipY=r,a.needsUpdate=!0;const s=new ze(t,Jt,Qe,Qe,He,Sr,Dt,sr,1,Ks);return s.flipY=r,s.needsUpdate=!0,{gainMap:a,sdr:s}}updateQuadRenderer(t,n,r,a,s){t.width=n.width,t.height=n.height,t.material.gainMap=r,t.material.sdr=a,t.material.gainMapMin=s.gainMapMin,t.material.gainMapMax=s.gainMapMax,t.material.offsetHdr=s.offsetHdr,t.material.offsetSdr=s.offsetSdr,t.material.gamma=s.gamma,t.material.hdrCapacityMin=s.hdrCapacityMin,t.material.hdrCapacityMax=s.hdrCapacityMax,t.material.maxDisplayBoost=Math.pow(2,s.hdrCapacityMax),t.material.needsUpdate=!0}}const xi=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,Ri=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class Ti extends ht{constructor({gamma:t,offsetHdr:n,offsetSdr:r,gainMapMin:a,gainMapMax:s,maxDisplayBoost:u,hdrCapacityMin:c,hdrCapacityMax:l,sdr:A,gainMap:d}){super({name:"GainMapDecoderMaterial",vertexShader:xi,fragmentShader:Ri,uniforms:{sdr:{value:A},gainMap:{value:d},gamma:{value:new ee(1/t[0],1/t[1],1/t[2])},offsetHdr:{value:new ee().fromArray(n)},offsetSdr:{value:new ee().fromArray(r)},gainMapMin:{value:new ee().fromArray(a)},gainMapMax:{value:new ee().fromArray(s)},weightFactor:{value:(Math.log2(u)-c)/(l-c)}},blending:Qs,depthTest:!1,depthWrite:!1});de(this,"_maxDisplayBoost");de(this,"_hdrCapacityMin");de(this,"_hdrCapacityMax");this._maxDisplayBoost=u,this._hdrCapacityMin=c,this._hdrCapacityMax=l,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(t){this.uniforms.sdr.value=t}get gainMap(){return this.uniforms.gainMap.value}set gainMap(t){this.uniforms.gainMap.value=t}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(t){this.uniforms.offsetHdr.value.fromArray(t)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(t){this.uniforms.offsetSdr.value.fromArray(t)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(t){this.uniforms.gainMapMin.value.fromArray(t)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(t){this.uniforms.gainMapMax.value.fromArray(t)}get gamma(){const t=this.uniforms.gamma.value;return[1/t.x,1/t.y,1/t.z]}set gamma(t){const n=this.uniforms.gamma.value;n.x=1/t[0],n.y=1/t[1],n.z=1/t[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(t){this._hdrCapacityMin=t,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(t){this._hdrCapacityMax=t,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(t){this._maxDisplayBoost=Math.max(1,Math.min(65504,t)),this.calculateWeight()}calculateWeight(){const t=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,t))}}class Cn extends Ii{constructor(e,t){super({renderer:e,createMaterial:n=>new Ti(n),createQuadRenderer:n=>new mr(n)},t)}async render(e,t,n,r){const{sdrImage:a,gainMapImage:s,needsFlip:u}=await this.processImages(n,r,"flipY"),{gainMap:c,sdr:l}=this.createTextures(a,s,u);this.updateQuadRenderer(e,a,c,l,t),e.render()}}class Di extends Cn{load([e,t,n],r,a,s){const u=this.prepareQuadRenderer();let c,l,A;const d=async()=>{if(c&&l&&A){try{await this.render(u,A,c,l)}catch(G){this.manager.itemError(e),this.manager.itemError(t),this.manager.itemError(n),typeof s=="function"&&s(G),u.disposeOnDemandRenderer();return}typeof r=="function"&&r(u),this.manager.itemEnd(e),this.manager.itemEnd(t),this.manager.itemEnd(n),u.disposeOnDemandRenderer()}};let m=!0,B=0,p=0,g=!0,v=0,x=0,F=!0,H=0,L=0;const y=()=>{if(typeof a=="function"){const G=B+v+H,k=p+x+L,j=m&&g&&F;a(new ProgressEvent("progress",{lengthComputable:j,loaded:k,total:G}))}};this.manager.itemStart(e),this.manager.itemStart(t),this.manager.itemStart(n);const b=new $e(this._internalLoadingManager);b.setResponseType("arraybuffer"),b.setRequestHeader(this.requestHeader),b.setPath(this.path),b.setWithCredentials(this.withCredentials),b.load(e,async G=>{if(typeof G=="string")throw new Error("Invalid sdr buffer");c=G,await d()},G=>{m=G.lengthComputable,p=G.loaded,B=G.total,y()},G=>{this.manager.itemError(e),typeof s=="function"&&s(G)});const T=new $e(this._internalLoadingManager);T.setResponseType("arraybuffer"),T.setRequestHeader(this.requestHeader),T.setPath(this.path),T.setWithCredentials(this.withCredentials),T.load(t,async G=>{if(typeof G=="string")throw new Error("Invalid gainmap buffer");l=G,await d()},G=>{g=G.lengthComputable,x=G.loaded,v=G.total,y()},G=>{this.manager.itemError(t),typeof s=="function"&&s(G)});const I=new $e(this._internalLoadingManager);return I.setRequestHeader(this.requestHeader),I.setPath(this.path),I.setWithCredentials(this.withCredentials),I.load(n,async G=>{if(typeof G!="string")throw new Error("Invalid metadata string");A=JSON.parse(G),await d()},G=>{F=G.lengthComputable,L=G.loaded,H=G.total,y()},G=>{this.manager.itemError(n),typeof s=="function"&&s(G)}),u}}class yi extends Cn{load(e,t,n,r){const a=this.prepareQuadRenderer(),s=new $e(this._internalLoadingManager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(this.withCredentials),this.manager.itemStart(e),s.load(e,async u=>{if(typeof u=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const c=new Uint8Array(u);let l,A,d;try{const m=await bi(c);l=m.sdr,A=m.gainMap,d=m.metadata}catch(m){if(m instanceof gn||m instanceof pn)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),d={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},l=c;else throw m}try{await this.render(a,d,l.buffer,A==null?void 0:A.buffer)}catch(m){this.manager.itemError(e),typeof r=="function"&&r(m),a.disposeOnDemandRenderer();return}typeof t=="function"&&t(a),this.manager.itemEnd(e),a.disposeOnDemandRenderer()},n,u=>{this.manager.itemError(e),typeof r=="function"&&r(u)}),a}}const yt={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},vn="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",ut=o=>Array.isArray(o),fr=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function Kt({files:o=fr,path:e="",preset:t=void 0,colorSpace:n=void 0,extensions:r}={}){t&&(Br(t),o=yt[t],e=vn);const a=ut(o),{extension:s,isCubemap:u}=pr(o),c=gr(s);if(!c)throw new Error("useEnvironment: Unrecognized file extension: "+o);const l=xe(B=>B.gl);R.useLayoutEffect(()=>{if(s!=="webp"&&s!=="jpg"&&s!=="jpeg")return;function B(){st.clear(c,a?[o]:o)}l.domElement.addEventListener("webglcontextlost",B,{once:!0})},[o,l.domElement]);const A=st(c,a?[o]:o,B=>{(s==="webp"||s==="jpg"||s==="jpeg")&&B.setRenderer(l),B.setPath==null||B.setPath(e),r&&r(B)});let d=a?A[0]:A;if(s==="jpg"||s==="jpeg"||s==="webp"){var m;d=(m=d.renderTarget)==null?void 0:m.texture}return d.mapping=u?js:Xs,d.colorSpace=n??(u?"srgb":"srgb-linear"),d}const Gi={files:fr,path:"",preset:void 0,extensions:void 0};Kt.preload=o=>{const e={...Gi,...o};let{files:t,path:n=""}=e;const{preset:r,extensions:a}=e;r&&(Br(r),t=yt[r],n=vn);const{extension:s}=pr(t);if(s==="webp"||s==="jpg"||s==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const u=gr(s);if(!u)throw new Error("useEnvironment: Unrecognized file extension: "+t);st.preload(u,ut(t)?[t]:t,c=>{c.setPath==null||c.setPath(n),a&&a(c)})};const wi={files:fr,preset:void 0};Kt.clear=o=>{const e={...wi,...o};let{files:t}=e;const{preset:n}=e;n&&(Br(n),t=yt[n]);const{extension:r}=pr(t),a=gr(r);if(!a)throw new Error("useEnvironment: Unrecognized file extension: "+t);st.clear(a,ut(t)?[t]:t)};function Br(o){if(!(o in yt))throw new Error("Preset must be one of: "+Object.keys(yt).join(", "))}function pr(o){var e;const t=ut(o)&&o.length===6,n=ut(o)&&o.length===3&&o.some(s=>s.endsWith("json")),r=ut(o)?o[0]:o;return{extension:t?"cube":n?"webp":r.startsWith("data:application/exr")?"exr":r.startsWith("data:application/hdr")?"hdr":r.startsWith("data:image/jpeg")?"jpg":(e=r.split(".").pop())==null||(e=e.split("?"))==null||(e=e.shift())==null?void 0:e.toLowerCase(),isCubemap:t,isGainmap:n}}function gr(o){return o==="cube"?Zs:o==="hdr"?hi:o==="exr"?Ai:o==="jpg"||o==="jpeg"?yi:o==="webp"?Di:null}const Si=o=>o.current&&o.current.isScene,Hi=o=>Si(o)?o.current:o;function Cr(o,e,t,n,r={}){var a,s,u,c;r={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...r};const l=Hi(e||t),A=l.background,d=l.environment,m={backgroundBlurriness:l.backgroundBlurriness,backgroundIntensity:l.backgroundIntensity,backgroundRotation:(a=(s=l.backgroundRotation)==null||s.clone==null?void 0:s.clone())!==null&&a!==void 0?a:[0,0,0],environmentIntensity:l.environmentIntensity,environmentRotation:(u=(c=l.environmentRotation)==null||c.clone==null?void 0:c.clone())!==null&&u!==void 0?u:[0,0,0]};return o!=="only"&&(l.environment=n),o&&(l.background=n),Hr(l,r),()=>{o!=="only"&&(l.environment=d),o&&(l.background=A),Hr(l,m)}}function vr({scene:o,background:e=!1,map:t,...n}){const r=xe(a=>a.scene);return R.useLayoutEffect(()=>{if(t)return Cr(e,o,r,t,n)}),null}function Mn({background:o=!1,scene:e,blur:t,backgroundBlurriness:n,backgroundIntensity:r,backgroundRotation:a,environmentIntensity:s,environmentRotation:u,...c}){const l=Kt(c),A=xe(d=>d.scene);return R.useLayoutEffect(()=>Cr(o,e,A,l,{backgroundBlurriness:t??n,backgroundIntensity:r,backgroundRotation:a,environmentIntensity:s,environmentRotation:u})),R.useEffect(()=>()=>{l.dispose()},[l]),null}function _i({children:o,near:e=.1,far:t=1e3,resolution:n=256,frames:r=1,map:a,background:s=!1,blur:u,backgroundBlurriness:c,backgroundIntensity:l,backgroundRotation:A,environmentIntensity:d,environmentRotation:m,scene:B,files:p,path:g,preset:v=void 0,extensions:x}){const F=xe(I=>I.gl),H=xe(I=>I.scene),L=R.useRef(null),[y]=R.useState(()=>new en),b=R.useMemo(()=>{const I=new Ys(n);return I.texture.type=Ie,I},[n]);R.useEffect(()=>()=>{b.dispose()},[b]),R.useLayoutEffect(()=>{if(r===1){const I=F.autoClear;F.autoClear=!0,L.current.update(F,y),F.autoClear=I}return Cr(s,B,H,b.texture,{backgroundBlurriness:u??c,backgroundIntensity:l,backgroundRotation:A,environmentIntensity:d,environmentRotation:m})},[o,y,b.texture,B,H,s,r,F]);let T=1;return wt(()=>{if(r===1/0||T<r){const I=F.autoClear;F.autoClear=!0,L.current.update(F,y),F.autoClear=I,T++}}),R.createElement(R.Fragment,null,Ws(R.createElement(R.Fragment,null,o,R.createElement("cubeCamera",{ref:L,args:[e,t,b]}),p||v?R.createElement(Mn,{background:!0,files:p,preset:v,path:g,extensions:x}):a?R.createElement(vr,{background:!0,map:a,extensions:x}):null),y))}function Li(o){var e,t,n,r;const a=Kt(o),s=o.map||a;R.useMemo(()=>tn({GroundProjectedEnvImpl:Ra}),[]),R.useEffect(()=>()=>{a.dispose()},[a]);const u=R.useMemo(()=>[s],[s]),c=(e=o.ground)==null?void 0:e.height,l=(t=o.ground)==null?void 0:t.radius,A=(n=(r=o.ground)==null?void 0:r.scale)!==null&&n!==void 0?n:1e3;return R.createElement(R.Fragment,null,R.createElement(vr,Ve({},o,{map:s})),R.createElement("groundProjectedEnvImpl",{args:u,scale:A,height:c,radius:l}))}function Ui(o){return o.ground?R.createElement(Li,o):o.map?R.createElement(vr,o):o.children?R.createElement(_i,o):R.createElement(Mn,o)}const Oi=R.forwardRef(({scale:o=10,frames:e=1/0,opacity:t=1,width:n=1,height:r=1,blur:a=1,near:s=0,far:u=10,resolution:c=512,smooth:l=!0,color:A="#000000",depthWrite:d=!1,renderOrder:m,...B},p)=>{const g=R.useRef(null),v=xe(P=>P.scene),x=xe(P=>P.gl),F=R.useRef(null);n=n*(Array.isArray(o)?o[0]:o||1),r=r*(Array.isArray(o)?o[1]:o||1);const[H,L,y,b,T,I,G]=R.useMemo(()=>{const P=new At(c,c),$=new At(c,c);$.texture.generateMipmaps=P.texture.generateMipmaps=!1;const Z=new hr(n,r).rotateX(Math.PI/2),Ce=new Gt(Z),Re=new zs;Re.depthTest=Re.depthWrite=!1,Re.onBeforeCompile=ve=>{ve.uniforms={...ve.uniforms,ucolor:{value:new Oe(A)}},ve.fragmentShader=ve.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
           void main() {
          `),ve.fragmentShader=ve.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};const Ee=new ht(li),re=new ht(ui);return re.depthTest=Ee.depthTest=!1,[P,Z,Re,Ce,Ee,re,$]},[c,n,r,o,A]),k=P=>{b.visible=!0,b.material=T,T.uniforms.tDiffuse.value=H.texture,T.uniforms.h.value=P*1/256,x.setRenderTarget(G),x.render(b,F.current),b.material=I,I.uniforms.tDiffuse.value=G.texture,I.uniforms.v.value=P*1/256,x.setRenderTarget(H),x.render(b,F.current),b.visible=!1};let j=0,X,W;return wt(()=>{F.current&&(e===1/0||j<e)&&(j++,X=v.background,W=v.overrideMaterial,g.current.visible=!1,v.background=null,v.overrideMaterial=y,x.setRenderTarget(H),x.render(v,F.current),k(a),l&&k(a*.4),x.setRenderTarget(null),g.current.visible=!0,v.overrideMaterial=W,v.background=X)}),R.useImperativeHandle(p,()=>g.current,[]),R.createElement("group",Ve({"rotation-x":Math.PI/2},B,{ref:g}),R.createElement("mesh",{renderOrder:m,geometry:L,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},R.createElement("meshBasicMaterial",{transparent:!0,map:H.texture,opacity:t,depthWrite:d})),R.createElement("orthographicCamera",{ref:F,args:[-n/2,n/2,r/2,-r/2,s,u]}))});function Ni(o){return o.isLight}function Ji(o){return!!o.geometry}const En=R.createContext(null),ki=An({color:new Oe,blend:2,alphaTest:.75,opacity:0,map:null},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vUv = uv;
   }`,`varying vec2 vUv;
   uniform sampler2D map;
   uniform vec3 color;
   uniform float opacity;
   uniform float alphaTest;
   uniform float blend;
   void main() {
     vec4 sampledDiffuseColor = texture2D(map, vUv);
     gl_FragColor = vec4(color * sampledDiffuseColor.r * blend, max(0.0, (1.0 - (sampledDiffuseColor.r + sampledDiffuseColor.g + sampledDiffuseColor.b) / alphaTest)) * opacity);
     #include <tonemapping_fragment>
     #include <${rn>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),Pi=R.forwardRef(({children:o,temporal:e,frames:t=40,limit:n=1/0,blend:r=20,scale:a=10,opacity:s=1,alphaTest:u=.75,color:c="black",colorBlend:l=2,resolution:A=1024,toneMapped:d=!0,...m},B)=>{tn({SoftShadowMaterial:ki});const p=xe(b=>b.gl),g=xe(b=>b.scene),v=xe(b=>b.camera),x=xe(b=>b.invalidate),F=R.useRef(null),H=R.useRef(null),[L]=R.useState(()=>new Qi(p,g,A));R.useLayoutEffect(()=>{L.configure(F.current)},[]);const y=R.useMemo(()=>({lights:new Map,temporal:!!e,frames:Math.max(2,t),blend:Math.max(2,t===1/0?r:t),count:0,getMesh:()=>F.current,reset:()=>{L.clear();const b=F.current.material;b.opacity=0,b.alphaTest=0,y.count=0},update:(b=1)=>{const T=F.current.material;y.temporal?(T.opacity=Math.min(s,T.opacity+s/y.blend),T.alphaTest=Math.min(u,T.alphaTest+u/y.blend)):(T.opacity=s,T.alphaTest=u),H.current.visible=!0,L.prepare();for(let I=0;I<b;I++)y.lights.forEach(G=>G.update()),L.update(v,y.blend);H.current.visible=!1,L.finish()}}),[L,v,g,e,t,r,s,u]);return R.useLayoutEffect(()=>{y.reset(),!y.temporal&&y.frames!==1/0&&y.update(y.blend)}),R.useImperativeHandle(B,()=>y,[y]),wt(()=>{(y.temporal||y.frames===1/0)&&y.count<y.frames&&y.count<n&&(x(),y.update(),y.count++)}),R.createElement("group",m,R.createElement("group",{traverse:()=>null,ref:H},R.createElement(En.Provider,{value:y},o)),R.createElement("mesh",{receiveShadow:!0,ref:F,scale:a,rotation:[-Math.PI/2,0,0]},R.createElement("planeGeometry",null),R.createElement("softShadowMaterial",{transparent:!0,depthWrite:!1,toneMapped:d,color:c,blend:l,map:L.progressiveLightMap2.texture})))}),Ki=R.forwardRef(({castShadow:o=!0,bias:e=.001,mapSize:t=512,size:n=5,near:r=.5,far:a=500,frames:s=1,position:u=[0,0,0],radius:c=1,amount:l=8,intensity:A=rn>=155?Math.PI:1,ambient:d=.5,...m},B)=>{const p=R.useRef(null),g=new ee(...u).length(),v=R.useContext(En),x=R.useCallback(()=>{let H;if(p.current)for(let L=0;L<p.current.children.length;L++)if(H=p.current.children[L],Math.random()>d)H.position.set(u[0]+xt.randFloatSpread(c),u[1]+xt.randFloatSpread(c),u[2]+xt.randFloatSpread(c));else{let y=Math.acos(2*Math.random()-1)-Math.PI/2,b=2*Math.PI*Math.random();H.position.set(Math.cos(y)*Math.cos(b)*g,Math.abs(Math.cos(y)*Math.sin(b)*g),Math.sin(y)*g)}},[c,d,g,...u]),F=R.useMemo(()=>({update:x}),[x]);return R.useImperativeHandle(B,()=>F,[F]),R.useLayoutEffect(()=>{var H;const L=p.current;return v&&((H=v.lights)==null||H.set(L.uuid,F)),()=>{var y;return void(v==null||(y=v.lights)==null?void 0:y.delete(L.uuid))}},[v,F]),R.createElement("group",Ve({ref:p},m),Array.from({length:l},(H,L)=>R.createElement("directionalLight",{key:L,castShadow:o,"shadow-bias":e,"shadow-mapSize":[t,t],intensity:A/l},R.createElement("orthographicCamera",{attach:"shadow-camera",args:[-n,n,n,-n,r,a]}))))});class Qi{constructor(e,t,n=1024){this.renderer=e,this.res=n,this.scene=t,this.buffer1Active=!1,this.lights=[],this.meshes=[],this.object=null,this.clearColor=new Oe,this.clearAlpha=0;const r={type:Ie,magFilter:tr,minFilter:tr};this.progressiveLightMap1=new At(this.res,this.res,r),this.progressiveLightMap2=new At(this.res,this.res,r),this.discardMat=new Bi,this.targetMat=new Vs({fog:!1}),this.previousShadowMap={value:this.progressiveLightMap1.texture},this.averagingWindow={value:100},this.targetMat.onBeforeCompile=a=>{a.vertexShader=`varying vec2 vUv;
`+a.vertexShader.slice(0,-1)+"vUv = uv; gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";const s=a.fragmentShader.indexOf("void main() {");a.fragmentShader=`varying vec2 vUv;
`+a.fragmentShader.slice(0,s)+`uniform sampler2D previousShadowMap;
	uniform float averagingWindow;
`+a.fragmentShader.slice(s-1,-1)+`
vec3 texelOld = texture2D(previousShadowMap, vUv).rgb;
        gl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/ averagingWindow);
      }`,a.uniforms.previousShadowMap=this.previousShadowMap,a.uniforms.averagingWindow=this.averagingWindow}}clear(){this.renderer.getClearColor(this.clearColor),this.clearAlpha=this.renderer.getClearAlpha(),this.renderer.setClearColor("black",1),this.renderer.setRenderTarget(this.progressiveLightMap1),this.renderer.clear(),this.renderer.setRenderTarget(this.progressiveLightMap2),this.renderer.clear(),this.renderer.setRenderTarget(null),this.renderer.setClearColor(this.clearColor,this.clearAlpha),this.lights=[],this.meshes=[],this.scene.traverse(e=>{Ji(e)?this.meshes.push({object:e,material:e.material}):Ni(e)&&this.lights.push({object:e,intensity:e.intensity})})}prepare(){this.lights.forEach(e=>e.object.intensity=0),this.meshes.forEach(e=>e.object.material=this.discardMat)}finish(){this.lights.forEach(e=>e.object.intensity=e.intensity),this.meshes.forEach(e=>e.object.material=e.material)}configure(e){this.object=e}update(e,t=100){if(!this.object)return;this.averagingWindow.value=t,this.object.material=this.targetMat;const n=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,r=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1,a=this.scene.background;this.scene.background=null,this.renderer.setRenderTarget(n),this.previousShadowMap.value=r.texture,this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.scene.background=a}}const ji={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};function Xi({radius:o,adjustCamera:e}){const t=vi();return R.useEffect(()=>{e&&t.refresh().clip().fit()},[o,e]),null}function Zi({children:o,center:e,adjustCamera:t=!0,intensity:n=.5,shadows:r="contact",environment:a="city",preset:s="rembrandt",...u}){var c,l,A,d,m,B,p,g;const v=typeof s=="string"?ji[s]:s,[{radius:x,height:F},H]=R.useState({radius:0,width:0,height:0,depth:0}),L=(c=r==null?void 0:r.bias)!==null&&c!==void 0?c:-1e-4,y=(l=r==null?void 0:r.normalBias)!==null&&l!==void 0?l:0,b=(A=r==null?void 0:r.size)!==null&&A!==void 0?A:1024,T=(d=r==null?void 0:r.offset)!==null&&d!==void 0?d:0,I=r==="contact"||(r==null?void 0:r.type)==="contact",G=r==="accumulative"||(r==null?void 0:r.type)==="accumulative",k={...typeof r=="object"?r:{}},j=a?typeof a=="string"?{preset:a}:a:null,X=R.useCallback(W=>{const{width:P,height:$,depth:Z,boundingSphere:Ce}=W;H({radius:Ce.radius,width:P,height:$,depth:Z}),e!=null&&e.onCentered&&e.onCentered(W)},[]);return R.createElement(R.Fragment,null,R.createElement("ambientLight",{intensity:n/3}),R.createElement("spotLight",{penumbra:1,position:[v.main[0]*x,v.main[1]*x,v.main[2]*x],intensity:n*2,castShadow:!!r,"shadow-bias":L,"shadow-normalBias":y,"shadow-mapSize":b}),R.createElement("pointLight",{position:[v.fill[0]*x,v.fill[1]*x,v.fill[2]*x],intensity:n}),R.createElement(Ci,Ve({fit:!!t,clip:!!t,margin:Number(t),observe:!0},u),R.createElement(Xi,{radius:x,adjustCamera:t}),R.createElement(fi,Ve({},e,{position:[0,T/2,0],onCentered:X}),o)),R.createElement("group",{position:[0,-F/2-T/2,0]},I&&R.createElement(Oi,Ve({scale:x*4,far:x,blur:2},k)),G&&R.createElement(Pi,Ve({temporal:!0,frames:100,alphaTest:.9,toneMapped:!0,scale:x*4},k),R.createElement(Ki,{amount:(m=k.amount)!==null&&m!==void 0?m:8,radius:(B=k.radius)!==null&&B!==void 0?B:x,ambient:(p=k.ambient)!==null&&p!==void 0?p:.5,intensity:(g=k.intensity)!==null&&g!==void 0?g:1,position:[v.main[0]*x,v.main[1]*x,v.main[2]*x],size:x*4,bias:-L,mapSize:b}))),a&&R.createElement(Ui,j))}const Yi="/Genius-kids/assets/mercury-BTRIHZfi.glb",Wi="/Genius-kids/assets/venus-CNSkvb5H.glb",zi="/Genius-kids/assets/earth-7DfeZlSY.glb",Vi="/Genius-kids/assets/mars-CwLZTnvW.glb",qi="/Genius-kids/assets/jupiter-f9899Ajr.glb",$i="/Genius-kids/assets/saturn-D0XQ6WXO.glb",eo="/Genius-kids/assets/uranus-12cW5MPs.glb",to="/Genius-kids/assets/neptune-BeoDdJWu.glb",ro="/Genius-kids/assets/sun-CO4HUDAr.glb",no={mercury:Yi,venus:Wi,earth:zi,mars:Vi,jupiter:qi,saturn:$i,uranus:eo,neptune:to,sun:ro};function so({planetId:o}){const e=no[o];if(!e)return null;const t=Pt(e),n=R.useRef(null);return wt((r,a)=>{n.current&&(n.current.rotation.y+=a*.2)}),D.jsx("primitive",{ref:n,object:t.scene,scale:2.5})}const ao=({planet:o})=>D.jsx("div",{className:"w-full h-full relative bg-black",children:D.jsx(qs,{shadows:!0,dpr:[1,2],camera:{fov:45},children:D.jsxs(R.Suspense,{fallback:null,children:[D.jsx(Zi,{environment:"city",intensity:.6,children:D.jsx(so,{planetId:o.id})}),D.jsx($s,{autoRotate:!0,autoRotateSpeed:.5,enableZoom:!0}),D.jsx(ea,{radius:100,depth:50,count:5e3,factor:4,saturation:0,fade:!0,speed:1})]})})}),io=({planet:o,onClose:e})=>{const[t,n]=Et.useState(!1),[r,a]=Et.useState(!1);Et.useEffect(()=>{const u=()=>{a(window.innerWidth<window.innerHeight)};return u(),window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]);const s=u=>`/Genius-kids/infographic/${{mercury:"Mercury.png",venus:"Vernus.png",earth:"Earth.png",mars:"Mars.png",jupiter:"Jupiter.png",saturn:"Sarturn.png",uranus:"Uranus.png",neptune:"Neptune.png",sun:"sun.png","asteroid-belt":"asteroidBelt.png"}[u]||"Earth.png"}`;return D.jsxs("div",{className:"relative w-full h-full flex items-center justify-center p-2 sm:p-6 md:p-12 animate-in fade-in zoom-in-95 duration-500",children:[D.jsxs("div",{className:"relative w-full max-w-6xl h-full max-h-[90vh] rounded-2xl overflow-hidden flex flex-col md:flex-row shadow-[0_0_100px_rgba(59,130,246,0.3)]",style:{background:"linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(30, 41, 59, 0.95) 100%)",border:"1px solid rgba(148, 163, 184, 0.2)"},children:[D.jsx("button",{onClick:e,className:"absolute top-3 right-3 z-50 p-2 bg-white/10 hover:bg-white/20 rounded-xl text-white transition-all backdrop-blur-sm border border-white/10",children:D.jsx(Dr,{size:20})}),D.jsxs("div",{className:"w-full md:w-1/2 h-64 md:h-full relative flex items-center justify-center overflow-hidden",children:[D.jsx(ao,{planet:o}),D.jsx("div",{className:"absolute inset-0 opacity-20 blur-3xl pointer-events-none",style:{background:`radial-gradient(circle at center, ${o.color}, transparent 70%)`}})]}),D.jsxs("div",{className:"w-full md:w-1/2 h-auto md:h-full p-4 sm:p-6 md:p-8 overflow-y-auto custom-scrollbar text-white flex flex-col",children:[D.jsxs("div",{className:"mb-4 md:mb-6",children:[D.jsx("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-black mb-1 text-transparent bg-clip-text bg-gradient-to-r from-blue-200 via-purple-200 to-pink-200",children:o.name}),D.jsx("div",{className:"h-1 w-24 bg-gradient-to-r from-blue-400 to-purple-600 rounded-full"})]}),D.jsx("p",{className:"text-sm sm:text-base text-slate-300 mb-4 md:mb-6 leading-relaxed",children:o.description}),D.jsx("div",{className:"mb-6",children:D.jsxs("button",{onClick:()=>n(!0),className:"w-full py-3 px-4 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-bold rounded-xl shadow-lg hover:shadow-blue-500/25 transition-all flex items-center justify-center gap-2 group",children:[D.jsx("span",{className:"text-xl",children:"📊"}),D.jsx("span",{children:"Xem Infographic"}),D.jsx(_r,{size:16,className:"group-hover:translate-x-1 transition-transform"})]})}),D.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-3 mb-4 md:mb-6",children:[D.jsxs("div",{className:"bg-gradient-to-br from-orange-500/10 to-red-500/10 p-3 rounded-xl border border-orange-500/20 backdrop-blur-sm",children:[D.jsxs("div",{className:"flex items-center gap-2 text-orange-300 mb-1",children:[D.jsx(sa,{size:14}),D.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:"Nhiệt độ"})]}),D.jsx("div",{className:"text-sm sm:text-base font-bold text-white",children:o.temperature})]}),D.jsxs("div",{className:"bg-gradient-to-br from-blue-500/10 to-cyan-500/10 p-3 rounded-xl border border-blue-500/20 backdrop-blur-sm",children:[D.jsxs("div",{className:"flex items-center gap-2 text-blue-300 mb-1",children:[D.jsx(_r,{size:14}),D.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:"Khoảng cách"})]}),D.jsx("div",{className:"text-sm sm:text-base font-bold text-white",children:o.distanceFromSun})]}),D.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-pink-500/10 p-3 rounded-xl border border-purple-500/20 backdrop-blur-sm",children:[D.jsxs("div",{className:"flex items-center gap-2 text-purple-300 mb-1",children:[D.jsx(ta,{size:14}),D.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:"Đường kính"})]}),D.jsx("div",{className:"text-sm sm:text-base font-bold text-white",children:o.diameter})]}),D.jsxs("div",{className:"bg-gradient-to-br from-green-500/10 to-emerald-500/10 p-3 rounded-xl border border-green-500/20 backdrop-blur-sm",children:[D.jsxs("div",{className:"flex items-center gap-2 text-green-300 mb-1",children:[D.jsx(aa,{size:14}),D.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:"Trọng lực"})]}),D.jsx("div",{className:"text-sm sm:text-base font-bold text-white",children:o.gravity})]})]}),D.jsxs("div",{className:"flex-1",children:[D.jsxs("h3",{className:"text-lg sm:text-xl font-bold mb-3 flex items-center gap-2",children:[D.jsx("span",{className:"text-2xl",children:"💡"}),D.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-yellow-200 to-yellow-400",children:"Sự thật thú vị"})]}),D.jsx("div",{className:"space-y-2",children:o.facts.map((u,c)=>D.jsxs("div",{className:"flex gap-2 p-2.5 sm:p-3 bg-yellow-400/5 rounded-lg border border-yellow-400/20 backdrop-blur-sm hover:bg-yellow-400/10 transition-colors",children:[D.jsxs("span",{className:"text-yellow-400 font-bold text-sm shrink-0",children:[c+1,"."]}),D.jsx("p",{className:"text-slate-200 text-xs sm:text-sm leading-relaxed",children:u})]},c))})]})]})]}),t&&D.jsxs("div",{className:"fixed inset-0 z-[200] bg-black/90 backdrop-blur-md animate-in fade-in duration-300",children:[D.jsx("div",{className:"absolute inset-0",onClick:()=>n(!1)}),D.jsx("button",{onClick:()=>n(!1),className:"absolute top-4 right-4 z-[210] p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-all backdrop-blur-sm border border-white/20",children:D.jsx(Dr,{size:24})}),D.jsx("div",{className:"absolute top-1/2 left-1/2 flex items-center justify-center pointer-events-none transition-all duration-500 ease-in-out origin-center",style:r?{width:"100vh",height:"100vw",transform:"translate(-50%, -50%) rotate(90deg)",maxWidth:"none",maxHeight:"none"}:{width:"100%",height:"100%",transform:"translate(-50%, -50%)",padding:"1rem"},children:D.jsx("img",{src:s(o.id),alt:`${o.name} Infographic`,className:"w-full h-full object-contain pointer-events-auto"})})]})]})},oo="/Genius-kids/assets/galaxy-DJwRzXuz.png";function vo(){const o=ts(),[e,t]=R.useState(null),[n,r]=R.useState(1),[a,s]=R.useState({x:0,y:0}),[u,c]=R.useState(!1),[l,A]=R.useState(!1),[d,m]=R.useState(null),B=T=>{if(T==="sun")t(la);else if(T==="asteroid-belt")t(ua);else{const I=Rt.find(G=>G.id===T);I&&t(I)}c(!1)},p=()=>{t(null)},g=()=>{r(T=>Math.min(T+.2,3))},v=()=>{r(T=>Math.max(T-.2,.5))},x=T=>{e||(A(!0),m({x:T.clientX-a.x,y:T.clientY-a.y}))},F=T=>{if(!l||!d)return;const I=T.clientX-d.x,G=T.clientY-d.y,k=1e3;s({x:Math.max(-k,Math.min(k,I)),y:Math.max(-k,Math.min(k,G))})},H=()=>{A(!1),m(null)},L=T=>{if(e)return;const I=T.touches[0];A(!0),m({x:I.clientX-a.x,y:I.clientY-a.y})},y=T=>{if(!l||!d)return;const I=T.touches[0],G=I.clientX-d.x,k=I.clientY-d.y,j=1e3;s({x:Math.max(-j,Math.min(j,G)),y:Math.max(-j,Math.min(j,k))})},b=()=>{A(!1),m(null)};return D.jsxs("div",{className:"w-full h-screen bg-black overflow-hidden relative",style:{cursor:l?"grabbing":n>1?"grab":"default"},onMouseDown:x,onMouseMove:F,onMouseUp:H,onMouseLeave:H,onTouchStart:L,onTouchMove:y,onTouchEnd:b,children:[D.jsx("img",{src:oo,alt:"Galaxy Background",className:"absolute inset-0 w-full h-full object-cover opacity-80 pointer-events-none"}),D.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/40 via-transparent to-black/40"}),D.jsxs("div",{className:"absolute top-4 left-4 z-50 flex gap-4",children:[D.jsx("button",{onClick:()=>o("/science"),className:"p-3 bg-white/10 backdrop-blur-md border border-white/20 rounded-full text-white hover:bg-white/20 transition-all",children:D.jsx(oa,{size:24})}),D.jsxs("div",{className:"relative",children:[D.jsxs("button",{onClick:()=>c(!u),className:"flex items-center gap-2 px-4 py-3 bg-white/10 backdrop-blur-md border border-white/20 rounded-full text-white hover:bg-white/20 transition-all",children:[D.jsx("span",{className:"text-sm font-semibold",children:"Chọn thiên thể"}),D.jsx(ca,{size:16,className:`transition-transform ${u?"rotate-180":""}`})]}),u&&D.jsxs("div",{className:"absolute top-full left-0 mt-2 w-64 bg-slate-900/95 backdrop-blur-md border border-white/20 rounded-2xl shadow-xl overflow-hidden max-h-96 overflow-y-auto",children:[D.jsxs("button",{onClick:()=>B("sun"),className:"w-full px-4 py-3 text-left text-white hover:bg-white/10 transition-colors flex items-center gap-3 border-b border-white/10",children:[D.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-400 shadow-[0_0_10px_rgba(251,191,36,0.6)]"}),D.jsx("span",{className:"font-semibold",children:"Mặt Trời"})]}),Rt.map(T=>D.jsxs("button",{onClick:()=>B(T.id),className:"w-full px-4 py-3 text-left text-white hover:bg-white/10 transition-colors flex items-center gap-3 border-b border-white/10",children:[D.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:T.color,boxShadow:`0 0 10px ${T.color}80`}}),D.jsx("span",{className:"text-sm",children:T.name})]},T.id)),D.jsxs("button",{onClick:()=>B("asteroid-belt"),className:"w-full px-4 py-3 text-left text-white hover:bg-white/10 transition-colors flex items-center gap-3",children:[D.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-700 shadow-[0_0_10px_rgba(180,83,9,0.6)]"}),D.jsx("span",{className:"text-sm",children:"Vành Đai Tiểu Hành Tinh"})]})]})]})]}),D.jsx("div",{className:"absolute top-4 right-4 z-50",children:D.jsx(ia,{})}),!e&&D.jsxs("div",{className:"absolute bottom-8 right-8 z-50 flex flex-col gap-2",children:[D.jsx("button",{onClick:g,className:"p-3 bg-white/10 backdrop-blur-md border border-white/20 rounded-full text-white hover:bg-white/20 transition-all",children:D.jsx(ra,{size:24})}),D.jsx("button",{onClick:v,className:"p-3 bg-white/10 backdrop-blur-md border border-white/20 rounded-full text-white hover:bg-white/20 transition-all",children:D.jsx(na,{size:24})})]}),D.jsx(Aa,{selectedPlanet:e,onPlanetSelect:B,zoomLevel:n,viewOffset:a}),e&&D.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:[D.jsx("div",{className:"absolute inset-0",onClick:p}),D.jsx("div",{className:"relative z-10 w-full h-full pointer-events-auto",children:D.jsx(io,{planet:e,onClose:p})})]})]})}export{vo as SolarSystemPage};
